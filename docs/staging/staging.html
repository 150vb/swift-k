<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article" style="max-width:750px">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_data_flow_and_staging_methods">Data flow and staging methods</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph"><p>The execution components involved in a Swift workflow are the client, the swift
service and the workers. The client is the program that executes the workflow
described in a swift script and is invoked by the swift command. The service
may be started separately or automatically by the swift client and is responsible
for provisioning resources from clouds, clusters or HPC systems. The workers are
launched by the swift-service and are responsible for controlling the execution
of the user&#8217;s application on the compute nodes.</p></div>
<div class="paragraph"><p>Different clusters, HPC systems, and cloud vendors may have shared file-systems,
varying network characteristics and local-disks available which can be utilized
differently to marshal data efficiently within a workflow. Data flow refers to
this movement of data within a workflow. On distributed systems with varying
levels of shared resources, the Swift client and service coordinates the flow of
data among the worker-nodes such that the data required for computation is available
to the worker prior to the execution of the users&#8217;s application as well as ensuring
that the computed results are captured once tasks run to completion.</p></div>
<div class="paragraph"><p>There are 6 different staging methods that are supported by Swift. They are:
 * Local
 * Direct
 * Wrapper
 * Swift
 * Shared-fs
 * Service-local</p></div>
<div class="paragraph"><p>These staging methods are explained in detail in the following sections.</p></div>
</div>
<div class="sect2">
<h3 id="_staging_method_local">Staging method : local</h3>
<div class="paragraph"><p><span class="image">
<img src="local_staging.pdf" alt="local_staging.pdf" />
</span></p></div>
<div class="sect3">
<h4 id="_summary">Summary</h4>
<div class="paragraph"><p>The local staging method is designed for shared-nothing architectures such as
clusters and clouds with no shared file-systems. The data originates on the
node where the client runs and all data transfers are done over the network.
The client and service need not be on the same machine, which allows a client
running on a local workstation to channel data through a service on the
headnode of a Cluster1 to compute nodes provisioned from Cluster1.
The is the default file staging method as this works on all computational
resources. Since all the data is transferred via the swift-service the network
bandwidth of the service could bottleneck the data flow. Similarly if the swift
client is running remotely, the network links between the client and the service
could potentially become a bottleneck for large volumes of data.</p></div>
</div>
<div class="sect3">
<h4 id="_when_to_use_this_mode">When to use this mode</h4>
<div class="paragraph"><p>The data volumes that need to be transferred to and from the workers to the client are</p></div>
</div>
<div class="sect3">
<h4 id="_example_configs">Example configs</h4>
<div class="listingblock">
<div class="content">
<pre><code>sites: midway
site.midway {
    execution {
        type: "coaster"
        URL: "swift.rcc.uchicago.edu"
        jobManager: "ssh-cl:slurm"  # Client connects remotely to the login node.
        options {
            nodeGranularity: 1
            maxNodesPerJob: 1
            jobQueue: "sandyb"
            maxJobs: 1
            tasksPerNode: 1
            maxJobTime: "00:08:20"
        }
    }
    staging: "local"
    workDirectory: "/tmp/"${env.USER}
    app.date {
        executable: "/bin/date"
        maxWallTime: "00:05:00"
    }
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_analysing_logs">Analysing logs</h4>
<div class="paragraph"><p>TODO</p></div>
</div>
<div class="sect3">
<h4 id="_performance">Performance</h4>
<div class="paragraph"><p>All data-flow is over the network in this staging method and as a result, larger
data volumes can impact performance adversely. The entire data flow must go through
the nodes on which the client and service are running and the bandwidth limitations
of that node must be taken into account.</p></div>
<div class="paragraph"><p>When several small files are involved, or with sufficiently large files, the
filesystem on the client node can become a bottleneck.</p></div>
</div>
<div class="sect3">
<h4 id="_notes">Notes:</h4>
<div class="paragraph"><p>When running using local coasters (local instead of ssh-cl), the client and service run on the same node.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_staging_method_direct">Staging method : Direct</h3>
<div class="paragraph"><p><span class="image">
<img src="figs/direct_staging.pdf" alt="figs/direct_staging.pdf" />
</span></p></div>
<div class="paragraph"><p><span class="image">
<img src="figs/direct_staging_scratch.pdf" alt="figs/direct_staging_scratch.pdf" />
</span></p></div>
<div class="sect3">
<h4 id="_summary_2">Summary</h4>
<div class="paragraph"><p>The direct staging mode is designed for computational resources with shared-filesystems.
This mode requires that a shared filesystem such as NFS, Lustre, or even FUSE-mounted-S3
is mounted across the nodes where the client, service, and the workers are executing.
While sandbox directories are created for the individual task executions, the tasks
themselves will receive absolute paths for the input and output files. For applications
that are IO bound, writing directly to the shared-filesystem can adversely affect the
shared filesystem performance. To avoid this there is an option to specify a “scratch”
folder on a local disk on the compute nodes.</p></div>
</div>
<div class="sect3">
<h4 id="_when_to_use_this_mode_2">When to use this mode</h4>
<div class="paragraph"><p>Large volumes of data are either consumed or generated by the application and a shared
-filesystem is available across the nodes. Given the volume of data and the network
capacity of the headnode, using the network to transfer data to the compute nodes might
be sub-optimal.</p></div>
<div class="paragraph"><p>Another scenario is when the shared-filesystem is sensitive to creation and deletion
of small files and directories. The swift workers create a sandbox directory for each
task, which is (3 : TODO:confirm this with Mihael) levels deep. Using the direct mode
with the workDirectory on a local disk (say /tmp) could avoid the overhead from swift&#8217;s
mechanisms for sandboxing tasks.</p></div>
</div>
<div class="sect3">
<h4 id="_example_configs_2">Example configs</h4>
<div class="paragraph"><p>The following is an example for the direct staging mode.
Staging method is set to “direct”
workDirectory may be set to the shared filesystem or a local filesystem.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>sites: midway

site.midway {
    execution {
        type: "coaster"
        URL: "swift.rcc.uchicago.edu"
        jobManager: "local:slurm"
        options {
            nodeGranularity: 1
            maxNodesPerJob: 1
            jobQueue: "sandyb"
            maxJobs: 1
            tasksPerNode: 1
            maxJobTime: "00:08:20"
        }
    }
    staging: direct
    workDirectory: "/tmp/"${env.USER}"/swiftwork"
    app.bash {
        executable: "/bin/bash"
        maxWallTime: "00:05:00"
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>The following is an example for the direct staging mode.
Staging method is set to “direct”
workDirectory may be set to the shared filesystem or a local filesystem.
Scratch is set to a directory on the local disks of the workers. The input/output files
are copied to this directory and the user tasks are presented with paths which point to
files in this directory. The workers will copy output files from the scratch directory to
the shared-filesystem paths for the outputs.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>sites: midway

site.midway {
    execution {
        type: "coaster"
        URL: "swift.rcc.uchicago.edu"
        jobManager: "local:slurm"
        options {
            nodeGranularity: 1
            maxNodesPerJob: 1
            jobQueue: "sandyb"
            maxJobs: 1
            tasksPerNode: 1
            maxJobTime: "00:08:20"
        }
    }
    staging: direct
    workDirectory: "/tmp/"${env.USER}"/swiftwork"
    scratch: "/scratch/local/"${env.USER}"/work/"
    app.bash {
        executable: "/bin/bash"
        maxWallTime: "00:05:00"
    }
}

TCPPortRange: "50000,51000"
lazyErrors: false
executionRetries: 0
keepSiteDir: true
providerStagingPinSwiftFiles: false
alwaysTransferWrapperLog: true</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_notes_2">Notes:</h4>
<div class="paragraph"><p>TODO : Details of the filename behavior in apps and within swiftscript body.</p></div>
<div class="paragraph"><p>When this configuration is used, the worker copies the input files from the shared-filesystem to the scratch directory, and the user application will get the path to the file on scratch when the filename(&lt;file_variable&gt;) and it&#8217;s shorthand @&lt;file_variable&gt; primitives are used in the app definition. The filename and @ primitives when used outside of the app definitions will point at the files on the shared-filesystem.</p></div>
</div>
<div class="sect3">
<h4 id="_analysing_logs_2">Analysing logs</h4>
</div>
<div class="sect3">
<h4 id="_performance_2">Performance</h4>
</div>
</div>
<div class="sect2">
<h3 id="_staging_method_swift">Staging method : Swift</h3>
<div class="paragraph"><p>image:figs/swift_staging.pdf</p></div>
<div class="sect3">
<h4 id="_summary_3">Summary</h4>
<div class="paragraph"><p>Swift staging, invovles the client accessing file over a supported method like
ssh or a local-filesystem access, and making the inputs available to the workers
over a work-directory on a shared filesystem.</p></div>
</div>
<div class="sect3">
<h4 id="_when_to_use_this_mode_3">When to use this mode</h4>
</div>
<div class="sect3">
<h4 id="_example_configs_3">Example configs</h4>
</div>
<div class="sect3">
<h4 id="_analysing_logs_3">Analysing logs</h4>
</div>
<div class="sect3">
<h4 id="_performance_3">Performance</h4>
</div>
</div>
<div class="sect2">
<h3 id="_staging_method_local_2">Staging method : local</h3>
<div class="sect3">
<h4 id="_summary_4">Summary</h4>
</div>
<div class="sect3">
<h4 id="_when_to_use_this_mode_4">When to use this mode</h4>
</div>
<div class="sect3">
<h4 id="_example_configs_4">Example configs</h4>
</div>
<div class="sect3">
<h4 id="_analysing_logs_4">Analysing logs</h4>
</div>
<div class="sect3">
<h4 id="_performance_4">Performance</h4>
<div class="paragraph"><p>This does not indicate that the data is unstructured; but it indicates
that the structure of the data is not exposed to Swift. Instead,
Swift will treat variables of this type as individual opaque files.</p></div>
<div class="paragraph"><p>With mechanisms to declare types, map variables to data files, and
declare and invoke procedures, we can build a complete (albeit simple)
script:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type image;
image photo &lt;"shane.jpg"&gt;;
image rotated &lt;"rotated.jpg"&gt;;

app (image output) rotate(image input, int angle) {
   convert "-rotate" angle @input @output;
}

rotated = rotate(photo, 180);</code></pre>
</div></div>
<div class="paragraph"><p>This script can be invoked from the command line:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  $ ls *.jpg
  shane.jpg
  $ swift example.swift
  ...
  $ ls *.jpg
  shane.jpg rotated.jpg</code></pre>
</div></div>
<div class="paragraph"><p>This executes a single convert command, hiding from the user features
such as remote multisite execution and fault tolerance that will be
discussed in a later section.</p></div>
<div class="paragraph"><div class="title">Figure 1. shane.jpg</div><p><span class="image">
<img src="userguide-shane.jpg" alt="userguide-shane.jpg" />
</span></p></div>
<div class="paragraph"><div class="title">Figure 2. rotated.jpg</div><p><span class="image">
<img src="userguide-rotated.jpg" alt="userguide-rotated.jpg" />
</span></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_arrays_and_parallel_execution">Arrays and Parallel Execution</h3>
<div class="paragraph"><p>Arrays of values can be declared using the [] suffix. Following is an example
of an array of strings:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string pets[] = ["shane", "noddy", "leo"];</code></pre>
</div></div>
<div class="paragraph"><p>An array may be mapped to a collection of files, one element per file, by using a
different form of mapping expression. For example, the filesys_mapper
maps all files matching a particular unix glob pattern into an array:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file frames[] &lt;filesys_mapper; pattern="*.jpg"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The foreach construct can be used to apply the same block of code to
each element of an array:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>foreach f,ix in frames {
  output[ix] = rotate(f, 180);</code></pre>
</div></div>
<div class="paragraph"><p>Sequential iteration can be expressed using the iterate construct:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>step[0] = initialCondition();
iterate ix {
  step[ix] = simulate(step[ix-1]);
}</code></pre>
</div></div>
<div class="paragraph"><p>This fragment will initialise the 0-th element of the step array to
some initial condition, and then repeatedly run the simulate
procedure, using each execution&#8217;s outputs as input to the next step.</p></div>
</div>
<div class="sect2">
<h3 id="_associative_arrays">Associative Arrays</h3>
<div class="paragraph"><p>By default, array keys are integers. However, other primitive types are also
allowed as array keys. The syntax for declaring an array with a key type different
than the default is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;valueType&gt;[&lt;keyType&gt;] array;</code></pre>
</div></div>
<div class="paragraph"><p>For example, the following code declares and assigns items to an array with string
keys and float values:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>float[string] a;
a["one"] = 0.2;
a["two"] = 0.4;</code></pre>
</div></div>
<div class="paragraph"><p>In addition to primitive types, a special type named <strong>auto</strong> can be used to
declare an array for which an additional <strong>append</strong> operation is available:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>int[auto] array;

foreach i in [1:100] {
  array &lt;&lt; (i*2) ;
}

foreach v in array {
  trace(v);
}</code></pre>
</div></div>
<div class="paragraph"><p>Items in an array with <strong>auto</strong> keys cannot be accessed directly using a primitive
type. The following example results in a compile-time error:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>int[auto] array;
array[0] = 1;</code></pre>
</div></div>
<div class="paragraph"><p>However, it is possible to use <strong>auto</strong> key values from one array to access another:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>int[auto] a;
int[auto] b;

a &lt;&lt; 1;
a &lt;&lt; 2;

foreach v, k in a {
  b[k] = a[k] * 2;
}</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_ordering_of_execution">Ordering of execution</h3>
<div class="paragraph"><p>Non-array variables are single-assignment, which means that they must
be assigned to exactly one value during execution. A procedure or
expression will be executed when all of its input parameters have been
assigned values. As a result of such execution, more variables may
become assigned, possibly allowing further parts of the script to execute.</p></div>
<div class="paragraph"><p>In this way, scripts are implicitly parallel. Aside from serialisation
implied by these dataflow dependencies, execution of component programs
can proceed in parallel.</p></div>
<div class="paragraph"><p>In this fragment, execution of procedures p and q can happen in
parallel:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>y=p(x);
z=q(x);</code></pre>
</div></div>
<div class="paragraph"><p>while in this fragment, execution is serialised by the variable y,
with procedure p executing before q.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>y=p(x);
z=q(y);</code></pre>
</div></div>
<div class="paragraph"><p>Arrays in Swift are more monotonic - a generalisation of being
assignment. Knowledge about the content of an array increases during
execution, but cannot otherwise change. Each element of the array is
itself single assignment or monotonic (depending on its type). During a
run all values for an array are eventually known, and that array is
regarded as closed.</p></div>
<div class="paragraph"><p>Statements which deal with the array as a whole will often wait for the
array to be closed before executing (thus, a closed array is the
equivalent of a non-array type being assigned). However, a foreach
statement will apply its body to elements of an array as they become
known. It will not wait until the array is closed.</p></div>
<div class="paragraph"><p>Consider this script:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file a[];
file b[];
foreach v,i in a {
  b[i] = p(v);
}
a[0] = r();
a[1] = s();</code></pre>
</div></div>
<div class="paragraph"><p>Initially, the foreach statement will have nothing to execute, as the
array a has not been assigned any values. The procedures r and s
will execute. As soon as either of them is finished, the corresponding
invocation of procedure p will occur. After both r and s have
completed, the array a will be closed since no other statements in the
script make an assignment to a.</p></div>
</div>
<div class="sect2">
<h3 id="_compound_procedures">Compound procedures</h3>
<div class="paragraph"><p>As with many other programming languages, procedures consisting of
Swift script can be defined. These differ from the previously
mentioned procedures declared with the app keyword, as they invoke
other Swift procedures rather than a component program.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(file output) process (file input) {
  file intermediate;
  intermediate = first(input);
  output = second(intermediate);
}

file x &lt;"x.txt"&gt;;
file y &lt;"y.txt"&gt;;
y = process(x);</code></pre>
</div></div>
<div class="paragraph"><p>This will invoke two procedures, with an intermediate data file named
anonymously connecting the first and second procedures.</p></div>
<div class="paragraph"><p>Ordering of execution is generally determined by execution of app
procedures, not by any containing compound procedures. In this code block:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(file a, file b) A() {
  a = A1();
  b = A2();
}
file x, y, s, t;
(x,y) = A();
s = S(x);
t = S(y);</code></pre>
</div></div>
<div class="paragraph"><p>then a valid execution order is: A1 S(x) A2 S(y). The compound
procedure A does not have to have fully completed for its return
values to be used by subsequent statements.</p></div>
</div>
<div class="sect2">
<h3 id="_more_about_types">More about types</h3>
<div class="paragraph"><p>Each variable and procedure parameter in Swift script is strongly typed.
Types are used to structure data, to aid in debugging and checking
program correctness and to influence how Swift interacts with data.</p></div>
<div class="paragraph"><p>The image type declared in previous examples is a marker type.
Marker types indicate that data for a variable is stored in a single
file with no further structure exposed at the Swift script level.</p></div>
<div class="paragraph"><p>Arrays have been mentioned above, in the arrays section. A code block
may be applied to each element of an array using foreach; or
individual elements may be references using [] notation.</p></div>
<div class="paragraph"><p>There are a number of primitive types:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">type    </th>
<th align="left" valign="top">contains</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">int</p></td>
<td align="left" valign="top"><p class="table">integers</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">strings of text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">float</p></td>
<td align="left" valign="top"><p class="table">floating point numbers, that behave the same as Java doubles</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">boolean</p></td>
<td align="left" valign="top"><p class="table">true/false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Complex types may be defined using the type keyword:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type headerfile;
type voxelfile;
type volume {
  headerfile h;
  voxelfile v;
}</code></pre>
</div></div>
<div class="paragraph"><p>Members of a complex type can be accessed using the . operator:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>volume brain;
o = p(brain.h);</code></pre>
</div></div>
<div class="paragraph"><p>Sometimes data may be stored in a form that does not fit with Swift&#8217;s
file-and-site model; for example, data might be stored in an RDBMS on
some database server. In that case, a variable can be declared to have
external type. This indicates that Swift should use the variable to
determine execution dependency, but should not attempt other data
management; for example, it will not perform any form of data stage-in
or stage-out it will not manage local data caches on sites; and it will
not enforce component program atomicity on data output. This can add
substantial responsibility to component programs, in exchange for
allowing arbitrary data storage and access methods to be plugged in to
scripts.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type file;

app (external o) populateDatabase() {
  populationProgram;
}

app (file o) analyseDatabase(external i) {
  analysisProgram @o;
}

external database;
file result &lt;"results.txt"&gt;;

database = populateDatabase();
result = analyseDatabase(database);</code></pre>
</div></div>
<div class="paragraph"><p>Some external database is represented by the database variable. The
populateDatabase procedure populates the database with some data, and
the analyseDatabase procedure performs some subsequent analysis on
that database. The declaration of database contains no mapping; and
the procedures which use database do not reference them in any way;
the description of database is entirely outside of the script. The
single assignment and execution ordering rules will still apply though;
populateDatabase will always be run before analyseDatabase.</p></div>
</div>
<div class="sect2">
<h3 id="_data_model">Data model</h3>
<div class="paragraph"><p>Data processed by Swift is strongly typed. It may be take the form of
values in memory or as out-of-core files on disk. Language constructs
called mappers specify how each piece of data is stored.</p></div>
</div>
<div class="sect2">
<h3 id="_more_technical_details_about_swift_script">More technical details about Swift script</h3>
<div class="paragraph"><p>The syntax of Swift script has a superficial resemblance to C and Java.
For example, { and } characters are used to enclose blocks of statements.</p></div>
<div class="paragraph"><p>A Swift script consists of a number of statements. Statements may
declare types, procedures and variables, assign values to variables, and
express operations over arrays.</p></div>
</div>
<div class="sect2">
<h3 id="_variables">Variables</h3>
<div class="paragraph"><p>Variables in Swift scripts are declared to be of a specific type.
Assignments to those variables must be data of that type. Swift script
variables are single-assignment - a value may be assigned to a variable
at most once. This assignment can happen at declaration time or later on
in execution. When an attempt to read from a variable that has not yet
been assigned is made, the code performing the read is suspended until
that variable has been written to. This forms the basis for Swift&#8217;s
ability to parallelise execution - all code will execute in parallel
unless there are variables shared between the code that cause sequencing.</p></div>
</div>
<div class="sect2">
<h3 id="_variable_declarations">Variable Declarations</h3>
<div class="paragraph"><p>Variable declaration statements declare new variables. They can
optionally assign a value to them or map those variables to on-disk files.</p></div>
<div class="paragraph"><p>Declaration statements have the general form:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>typename variablename (&lt;mapping&gt; | = initialValue ) ;</code></pre>
</div></div>
<div class="paragraph"><p>The format of the mapping expression is defined in the Mappers section.
initialValue may be either an expression or a procedure call that
returns a single value.</p></div>
<div class="paragraph"><p>Variables can also be declared in a multivalued-procedure statement,
described in another section.</p></div>
</div>
<div class="sect2">
<h3 id="_assignment_statements">Assignment Statements</h3>
<div class="paragraph"><p>Assignment statements assign values to previously declared variables.
Assignments may only be made to variables that have not already been
assigned. Assignment statements have the general form:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>variable = value;</code></pre>
</div></div>
<div class="paragraph"><p>where value can be either an expression or a procedure call that returns
a single value.</p></div>
<div class="paragraph"><p>Variables can also be assigned in a multivalued-procedure statement,
described in another section.</p></div>
</div>
<div class="sect2">
<h3 id="_procedures">Procedures</h3>
<div class="paragraph"><p>There are two kinds of procedure: An atomic procedure, which describes
how an external program can be executed; and compound procedures which
consist of a sequence of Swift script statements.</p></div>
<div class="paragraph"><p>A procedure declaration defines the name of a procedure and its input
and output parameters. Swift script procedures can take multiple inputs
and produce multiple outputs. Inputs are specified to the right of the
function name, and outputs are specified to the left. For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(type3 out1, type4 out2) myproc (type1 in1, type2 in2)</code></pre>
</div></div>
<div class="paragraph"><p>The above example declares a procedure called myproc, which has two
inputs in1 (of type type1) and in2 (of type type2) and two
outputs out1 (of type type3) and out2 (of type type4).</p></div>
<div class="paragraph"><p>A procedure input parameter can be an optional parameter in which case
it must be declared with a default value. When calling a procedure, both
positional parameter and named parameter passings can be passed,
provided that all optional parameters are declared after the required
parameters and any optional parameter is bound using keyword parameter
passing. For example, if myproc1 is defined as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(binaryfile bf) myproc1 (int i, string s="foo")</code></pre>
</div></div>
<div class="paragraph"><p>Then that procedure can be called like this, omitting the optional</p></div>
<div class="listingblock">
<div class="content">
<pre><code>parameter s:
binaryfile mybf = myproc1(1);</code></pre>
</div></div>
<div class="paragraph"><p>or like this supplying a value for the optional parameter s:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>binaryfile mybf = myproc1 (1, s="bar");</code></pre>
</div></div>
<div class="sect3">
<h4 id="_atomic_procedures">Atomic procedures</h4>
<div class="paragraph"><p>An atomic procedure specifies how to invoke an external executable
program, and how logical data types are mapped to command line arguments.</p></div>
<div class="paragraph"><p>Atomic procedures are defined with the app keyword:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>app (binaryfile bf) myproc (int i, string s="foo") {
    myapp i s @filename(bf);
}</code></pre>
</div></div>
<div class="paragraph"><p>which specifies that myproc invokes an executable called myapp,
passing the values of i, s and the filename of bf as command line
arguments.</p></div>
</div>
<div class="sect3">
<h4 id="_compound_procedures_2">Compound procedures</h4>
<div class="paragraph"><p>A compound procedure contains a set of Swift script statements:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(type2 b) foo_bar (type1 a) {
    type3 c;
    c = foo(a);    // c holds the result of foo
    b = bar(c);    // c is an input to bar
}</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_control_constructs">Control Constructs</h3>
<div class="paragraph"><p>Swift script provides if, switch, foreach, and iterate
constructs, with syntax and semantics similar to comparable constructs
in other high-level languages.</p></div>
<div class="sect3">
<h4 id="_foreach">foreach</h4>
<div class="paragraph"><p>The foreach construct is used to apply a block of statements to each
element in an array. For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>check_order (file a[]) {
    foreach f in a {
        compute(f);
    }
}</code></pre>
</div></div>
<div class="paragraph"><p>foreach statements have the general form:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>foreach controlvariable (,index) in expression {
    statements
}</code></pre>
</div></div>
<div class="paragraph"><p>The block of statements is evaluated once for each element in
expression which must be an array, with controlvariable set to the
corresponding element and index (if specified) set to the integer
position in the array that is being iterated over.</p></div>
</div>
<div class="sect3">
<h4 id="_if">if</h4>
<div class="paragraph"><p>The if statement allows one of two blocks of statements to be
executed, based on a boolean predicate. if statements generally have
the form:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>if(predicate) {
    statements
} else {
    statements
}</code></pre>
</div></div>
<div class="paragraph"><p>where predicate is a boolean expression.</p></div>
</div>
<div class="sect3">
<h4 id="_switch">switch</h4>
<div class="paragraph"><p>switch expressions allow one of a selection of blocks to be chosen
based on the value of a numerical control expression. switch
statements take the general form:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>switch(controlExpression) {
    case n1:
        statements2
    case n2:
        statements2
    [...]
    default:
        statements
}</code></pre>
</div></div>
<div class="paragraph"><p>The control expression is evaluated, the resulting numerical value used
to select a corresponding case, and the statements belonging to that
case block are evaluated. If no case corresponds, then the statements
belonging to the default block are evaluated.</p></div>
<div class="paragraph"><p>Unlike C or Java switch statements, execution does not fall through to
subsequent case blocks, and no break statement is necessary at the
end of each block.</p></div>
<div class="paragraph"><p>Following is an example of a switch expression in Swift:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>int score=60;
switch (score){
case 100:
    tracef("%s\n", "Bravo!");
case 90:
    tracef("%s\n", "very good");
case 80:
    tracef("%s\n", "good");
case 70:
    tracef("%s\n", "fair");
default:
    tracef("%s\n", "unknown grade");
    }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_iterate">iterate</h4>
<div class="paragraph"><p>iterate expressions allow a block of code to be evaluated repeatedly,
with an iteration variable being incremented after each iteration.</p></div>
<div class="paragraph"><p>The general form is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>iterate var {
    statements;
} until (terminationExpression);</code></pre>
</div></div>
<div class="paragraph"><p>Here <em>var</em> is the iteration variable. Its initial value is 0. After each iteration,
but before <em>terminationExpression</em> is evaluated, the iteration variable is incremented.
This means that if the termination expression is a function of only the iteration variable,
the body will never be executed while the termination expression is true.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>iterate i {
    trace(i); // will print 0, 1, and 2
} until (i == 3);</code></pre>
</div></div>
<div class="paragraph"><p>Variables declared inside the body of <em>iterate</em> can be used in the termination expression.
However, their values will reflect the values calculated as part of the last invocation
of the body, and may not reflect the incremented value of the iteration variable:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>iterate i {
    trace(i);
    int j = i; // will print 0, 1, 2, and 3
} until (j == 3);</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_operators">Operators</h3>
<div class="paragraph"><p>The following infix operators are available for use in Swift script
expressions.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">operator</th>
<th align="left" valign="top">purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">+</p></td>
<td align="left" valign="top"><p class="table">numeric addition; string concatenation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">numeric subtraction</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">*</p></td>
<td align="left" valign="top"><p class="table">numeric multiplication</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">/</p></td>
<td align="left" valign="top"><p class="table">floating point division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%/</p></td>
<td align="left" valign="top"><p class="table">integer division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%%</p></td>
<td align="left" valign="top"><p class="table">integer remainder of division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">== !=</p></td>
<td align="left" valign="top"><p class="table">comparison and not-equal-to</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&lt; &gt; &#8656; &gt;=</p></td>
<td align="left" valign="top"><p class="table">numerical ordering</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&amp;&amp; ||</p></td>
<td align="left" valign="top"><p class="table">boolean and, or</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">!</p></td>
<td align="left" valign="top"><p class="table">boolean not</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_global_constants">Global constants</h3>
<div class="paragraph"><p>At the top level of a Swift script program, the global modified may be
added to a declaration so that it is visible throughout the program,
rather than only at the top level of the program. This allows global
constants (of any type) to be defined.</p></div>
</div>
<div class="sect2">
<h3 id="_imports">Imports</h3>
<div class="paragraph"><p>The import directive can be used to import definitions from another
Swift file.</p></div>
<div class="paragraph"><p>For example, a Swift script might contain this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import "defs";
file f;</code></pre>
</div></div>
<div class="paragraph"><p>which would import the content of defs.swift:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type file;</code></pre>
</div></div>
<div class="paragraph"><p>Imported files are read from two places. They are either read from
the path that is specified from the import command, such as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import "definitions/file/defs";</code></pre>
</div></div>
<div class="paragraph"><p>or they are read from the environment variable SWIFT_LIB. This
environment variable is used just like the PATH environment
variable. For example, if the command below was issued to the bash
shell:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>export SWIFT_LIB=${HOME}/Swift/defs:${HOME}/Swift/functions</code></pre>
</div></div>
<div class="paragraph"><p>then the import command will check for the file defs.swift in both
"${HOME}/Swift/defs" and "${HOME}/Swift/functions" first before trying
the path that was specified in the import command.</p></div>
<div class="paragraph"><p>Other valid imports:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>import "../functions/func"
import "/home/user/Swift/definitions/defs"</code></pre>
</div></div>
<div class="paragraph"><p>There is no requirement that a module is imported only once. If a module
is imported multiple times, for example in different files, then Swift
will only process the imports once.</p></div>
<div class="paragraph"><p>Imports may contain anything that is valid in a Swift script,
including the code that causes remote execution.</p></div>
</div>
<div class="sect2">
<h3 id="_mappers">Mappers</h3>
<div class="paragraph"><p>Mappers provide a mechanism to specify the layout of mapped datasets on
disk. This is needed when Swift must access files to transfer them to
remote sites for execution or to pass to applications.</p></div>
<div class="paragraph"><p>Swift provides a number of mappers that are useful in common cases. This
section details those mappers. For more complex cases, it is
possible to write application-specific mappers in Java and use them
within a Swift script.</p></div>
<div class="sect3">
<h4 id="_the_single_file_mapper">The Single File Mapper</h4>
<div class="paragraph"><p>The single_file_mapper maps a single physical file to a dataset.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">myfile</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f [0]</p></td>
<td align="left" valign="top"><p class="table">INVALID</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f.bar</p></td>
<td align="left" valign="top"><p class="table">INVALID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">file</p></td>
<td align="left" valign="top"><p class="table">The location of the physical file including path and file name.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file f &lt;single_file_mapper;file="plot_outfile_param"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>There is a simplified syntax for this mapper:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file f &lt;"plot_outfile_param"&gt;;</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_simple_mapper">The Simple Mapper</h4>
<div class="paragraph"><p>The simple_mapper maps a file or a list of files into an array by
prefix, suffix, and pattern. If more than one file is matched, each of
the file names will be mapped as a subelement of the dataset.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">A directory that the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">padding</p></td>
<td align="left" valign="top"><p class="table">The number of digits used to uniquely identify the mapped file. This is an optional parameter which defaults to 4.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pattern</p></td>
<td align="left" valign="top"><p class="table">A UNIX glob style pattern, for instance: "*foo*" would match
all file names that contain foo. When this mapper is used to specify
output filenames, pattern is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre><code>type file;
file f &lt;simple_mapper;prefix="foo", suffix=".txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The above maps all filenames that start with foo and have an extension
.txt into file f.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">foo.txt</p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre><code>type messagefile;

(messagefile t) greeting(string m) {.
    app {
        echo m stdout=@filename(t);
    }
}

messagefile outfile &lt;simple_mapper;prefix="foo",suffix=".txt"&gt;;

outfile = greeting("hi");</code></pre>
</div></div>
<div class="paragraph"><p>This will output the string <em>hi</em> to the file foo.txt.</p></div>
<div class="paragraph"><p>The simple_mapper can be used to map arrays. It will map the array
index into the filename between the prefix and suffix.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type messagefile;

(messagefile t) greeting(string m) {
    app {
        echo m stdout=@filename(t);
    }
}

messagefile outfile[] &lt;simple_mapper;prefix="baz",suffix=".txt", padding=2&gt;;

outfile[0] = greeting("hello");
outfile[1] = greeting("middle");
outfile[2] = greeting("goodbye");</code></pre>
</div></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">outfile[0]</p></td>
<td align="left" valign="top"><p class="table">baz00.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">outfile[1]</p></td>
<td align="left" valign="top"><p class="table">baz01.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">outfile[2]</p></td>
<td align="left" valign="top"><p class="table">baz02.txt</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>simple_mapper can be used to map structures. It will map the name of
the structure member into the filename, between the prefix and the suffix.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type messagefile;

type mystruct {
  messagefile left;
  messagefile right;
};

(messagefile t) greeting(string m) {
    app {
        echo m stdout=@filename(t);
    }
}

mystruct out &lt;simple_mapper;prefix="qux",suffix=".txt"&gt;;

out.left = greeting("hello");
out.right = greeting("goodbye");</code></pre>
</div></div>
<div class="paragraph"><p>This will output the string "hello" into the file qux.left.txt and the
string "goodbye" into the file qux.right.txt.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">out.left</p></td>
<td align="left" valign="top"><p class="table">quxleft.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">out.right</p></td>
<td align="left" valign="top"><p class="table">quxright.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_concurrent_mapper">Concurrent Mapper</h4>
<div class="paragraph"><p>The concurrent_mapper is almost the same as the simple mapper, except that
it is used to map an output file, and the filename generated will
contain an extract sequence that is unique. This mapper is the default
mapper for variables when no mapper is specified.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">A directory that the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"
pattern A UNIX glob style pattern, for instance: "*foo*" would match
all file names that contain foo. When this mapper is used to specify
output filenames, pattern is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file f1;
file f2 &lt;concurrent_mapper;prefix="foo", suffix=".txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The above example would use concurrent mapper for f1 and f2, and
generate f2 filename with prefix "foo" and extension ".txt"</p></div>
</div>
<div class="sect3">
<h4 id="_filesystem_mapper">Filesystem Mapper</h4>
<div class="paragraph"><p>The filesys_mapper is similar to the simple mapper, but maps a file or a
list of files to an array. Each of the filename is mapped as an element
in the array. The order of files in the resulting array is not defined.</p></div>
<div class="paragraph"><p>TODO: note on difference between location as a relative vs absolute path
w.r.t. staging to remote location - as mihael said: It&#8217;s because you
specify that location in the mapper. Try location="." instead of
location="/sandbox/&#8230;"</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">The directory where the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pattern</p></td>
<td align="left" valign="top"><p class="table">A UNIX glob style pattern, for instance: "*foo*" would match
all file names that contain foo.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file texts[] &lt;filesys_mapper;prefix="foo", suffix=".txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The above example would map all filenames that start with "foo" and
have an extension ".txt" into the array texts. For example, if the
specified directory contains files: foo1.txt, footest.txt,
foo__1.txt, then the mapping might be:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">texts[0]</p></td>
<td align="left" valign="top"><p class="table">footest.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[1]</p></td>
<td align="left" valign="top"><p class="table">foo1.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[2]</p></td>
<td align="left" valign="top"><p class="table">foo__1.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_fixed_array_mapper">Fixed Array Mapper</h4>
<div class="paragraph"><p>The fixed_array_mapper maps from a string that contains a list of
filenames into a file array.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">files</p></td>
<td align="left" valign="top"><p class="table">A string that contains a list of filenames, separated by space,
comma or colon</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file texts[] &lt;fixed_array_mapper;files="file1.txt, fileB.txt, file3.txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>would cause a mapping like this:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">texts[0]</p></td>
<td align="left" valign="top"><p class="table">file1.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[1]</p></td>
<td align="left" valign="top"><p class="table">fileB.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[2]</p></td>
<td align="left" valign="top"><p class="table">file3.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_array_mapper">Array Mapper</h4>
<div class="paragraph"><p>The array_mapper maps from an array of strings into a file</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">files</p></td>
<td align="left" valign="top"><p class="table">An array of strings containing one filename per element</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string s[] = [ "a.txt", "b.txt", "c.txt" ];

file f[] &lt;array_mapper;files=s&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>This will establish the mapping:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f[0]</p></td>
<td align="left" valign="top"><p class="table">a.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f[1]</p></td>
<td align="left" valign="top"><p class="table">b.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f[2]</p></td>
<td align="left" valign="top"><p class="table">c.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression_mapper">Regular Expression Mapper</h4>
<div class="paragraph"><p>The regexp_mapper transforms one file name to another using regular
expression matching.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">source</p></td>
<td align="left" valign="top"><p class="table">The source file name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">match</p></td>
<td align="left" valign="top"><p class="table">Regular expression pattern to match, use</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">()</p></td>
<td align="left" valign="top"><p class="table">to match whatever
regular expression is inside the parentheses, and indicate the start and
end of a group; the contents of a group can be retrieved with the</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">\\number</p></td>
<td align="left" valign="top"><p class="table">special sequence (two backslashes are needed because the
backslash is an escape sequence introducer)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">transform</p></td>
<td align="left" valign="top"><p class="table">The pattern of the file name to transform to, use \number to
reference the group matched.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file s &lt;"picture.gif"&gt;;
file f &lt;regexp_mapper; source=s,
  match="(.*)gif", transform="\\1jpg"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>This example transforms a file ending gif into one ending jpg and
maps that to a file.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">picture.jpg</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_structured_regular_expression_mapper">Structured Regular Expression Mapper</h4>
<div class="paragraph"><p>The structured_regexp_mapper is similar to the regexp_mapper with the only
difference that it can be applied to arrays while the regexp_mapper cannot.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">source</p></td>
<td align="left" valign="top"><p class="table">The source file name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">match</p></td>
<td align="left" valign="top"><p class="table">Regular expression pattern to match, use</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">()</p></td>
<td align="left" valign="top"><p class="table">to match whatever
regular expression is inside the parentheses, and indicate the start and
end of a group; the contents of a group can be retrieved with the</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">\\number</p></td>
<td align="left" valign="top"><p class="table">special sequence (two backslashes are needed because the
backslash is an escape sequence introducer)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">transform</p></td>
<td align="left" valign="top"><p class="table">The pattern of the file name to transform to, use \number to
reference the group matched.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file s[] &lt;filesys_mapper; pattern="*.gif"&gt;;

file f[] &lt;structured_regexp_mapper; source=s,
          match="(.*)gif", transform="\\1jpg"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>This example transforms all files in a list that end in gif to end in jpg and maps
the list to those files.</p></div>
</div>
<div class="sect3">
<h4 id="_csv_mapper">CSV Mapper</h4>
<div class="paragraph"><p>The csv_mapper maps the content of a CSV (comma-separated value) file
into an array of structures. The dataset type needs to be correctly
defined to conform to the column names in the file. For instance, if the
file contains columns: name age GPA then the type needs to have member
elements like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type student {
  file name;
  file age;
  file GPA;
}</code></pre>
</div></div>
<div class="paragraph"><p>If the file does not contain a header with column info, then the column
names are assumed as column1, column2, etc.</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">file</p></td>
<td align="left" valign="top"><p class="table">The name of the CSV file to read mappings from.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">header</p></td>
<td align="left" valign="top"><p class="table">Whether the file has a line describing header info; default is</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">true</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">skip</p></td>
<td align="left" valign="top"><p class="table">The number of lines to skip at the beginning (after header line);
default is 0.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">hdelim</p></td>
<td align="left" valign="top"><p class="table">Header field delimiter; default is the value of the</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">delim</p></td>
<td align="left" valign="top"><p class="table">parameter</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">delim</p></td>
<td align="left" valign="top"><p class="table">Content field delimiters; defaults are space, tab and comma</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>student stus[] &lt;csv_mapper;file="stu_list.txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The above example would read a list of student info from file
"stu_list.txt" and map them into a student array. By default, the file
should contain a header line specifying the names of the columns. If
stu_list.txt contains the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>name,age,gpa
101-name.txt, 101-age.txt, 101-gpa.txt
name55.txt, age55.txt, age55.txt
q, r, s</code></pre>
</div></div>
<div class="paragraph"><p>then some of the mappings produced by this example would be:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">stus[0].name</th>
<th align="left" valign="top">101-name.txt</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">stus[0].age</p></td>
<td align="left" valign="top"><p class="table">101-age.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0].gpa</p></td>
<td align="left" valign="top"><p class="table">101-gpa.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].name</p></td>
<td align="left" valign="top"><p class="table">name55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].age</p></td>
<td align="left" valign="top"><p class="table">age55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].gpa</p></td>
<td align="left" valign="top"><p class="table">gpa55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].name</p></td>
<td align="left" valign="top"><p class="table">q</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].age</p></td>
<td align="left" valign="top"><p class="table">r</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].gpa</p></td>
<td align="left" valign="top"><p class="table">s</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_external_mapper">External Mapper</h4>
<div class="paragraph"><p>The external mapper, ext maps based on the output of a supplied Unix
executable.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">parameter</p></td>
<td align="left" valign="top"><p class="table">meaning</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">exec</p></td>
<td align="left" valign="top"><p class="table">The name of the executable (relative to the current directory, if
an absolute path is not specified)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">*</p></td>
<td align="left" valign="top"><p class="table">Other parameters are passed to the executable prefixed with a - symbol</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The output (stdout) of the executable should consist of two columns of data,
separated by a space. The first column should be the path of the mapped
variable, in Swift script syntax (for example [2] means the 2nd element of an
array) or the symbol $ to represent the root of the mapped variable. The
following table shows the symbols that should appear in the first column
corresponding to the mapping of different types of swift constructs such as
scalars, arrays and structs.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="33%" />
<col width="33%" />
<col width="33%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Swift construct</p></td>
<td align="left" valign="top"><p class="table">first column</p></td>
<td align="left" valign="top"><p class="table">second column</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">scalar</p></td>
<td align="left" valign="top"><p class="table">$</p></td>
<td align="left" valign="top"><p class="table">file_name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">anarray[]</p></td>
<td align="left" valign="top"><p class="table">[]</p></td>
<td align="left" valign="top"><p class="table">file_name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">2dimarray[][]</p></td>
<td align="left" valign="top"><p class="table">[][]</p></td>
<td align="left" valign="top"><p class="table">file_name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">astruct.fld</p></td>
<td align="left" valign="top"><p class="table">fld</p></td>
<td align="left" valign="top"><p class="table">file_name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">astructarray[].fldname</p></td>
<td align="left" valign="top"><p class="table">[].fldname</p></td>
<td align="left" valign="top"><p class="table">file_name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example: With the following in mapper.sh,</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/bin/bash
echo "[2] qux"
echo "[0] foo"
echo "[1] bar"</code></pre>
</div></div>
<div class="paragraph"><p>then a mapping statement:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>student stus[] &lt;ext;exec="mapper.sh"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>would map</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">stus[0]</p></td>
<td align="left" valign="top"><p class="table">foo</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1]</p></td>
<td align="left" valign="top"><p class="table">bar</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2]</p></td>
<td align="left" valign="top"><p class="table">qux</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Advanced Example: The following mapper.sh is an advanced example of an external
mapper that maps a two-dimensional array to a directory of files. The files in
the said directory are identified by their names appended by a number between
000 and 099. The first index of the array maps to the first part of the
filename while the second index of the array maps to the second part of the
filename.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>#!/bin/sh

#take care of the mapper args
while [ $# -gt 0 ]; do
  case $1 in
    -location)          location=$2;;
    -padding)           padding=$2;;
    -prefix)            prefix=$2;;
    -suffix)            suffix=$2;;
    -mod_index)         mod_index=$2;;
    -outer_index)       outer_index=$2;;
    *) echo "$0: bad mapper args" 1&gt;&amp;2
       exit 1;;
  esac
  shift 2
done

for i in `seq 0 ${outer_index}`
do
 for j in `seq -w 000 ${mod_index}`
 do
  fj=`echo ${j} | awk '{print $1 +0}'` #format j by removing leading zeros
  echo "["${i}"]["${fj}"]" ${location}"/"${prefix}${j}${suffix}
 done
done</code></pre>
</div></div>
<div class="paragraph"><p>The mapper definition is as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>file_dat dat_files[][] &lt; ext;
                              exec="mapper.sh",
                              padding=3,
                              location="output",
                              prefix=@strcat( str_root, "_" ),
                              suffix=".dat",
                              outer_index=pid,
                              mod_index=n &gt;;</code></pre>
</div></div>
<div class="paragraph"><p>Assuming there are 4 files with name aaa, bbb, ccc, ddd and a mod_index of 10,
we will have 4x10=40 files mapped to a two-dimensional array in the following
pattern:</p></div>
<div class="tableblock">
<table rules="all"
frame="border"
cellspacing="0" cellpadding="4">
<col />
<col />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">stus[0][0]</p></td>
<td align="left" valign="top"><p class="table">output/aaa_000.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0][1]</p></td>
<td align="left" valign="top"><p class="table">output/aaa_001.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0][2]</p></td>
<td align="left" valign="top"><p class="table">output/aaa_002.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0][3]</p></td>
<td align="left" valign="top"><p class="table">output/aaa_003.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0][9]</p></td>
<td align="left" valign="top"><p class="table">output/aaa_009.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1][0]</p></td>
<td align="left" valign="top"><p class="table">output/bbb_000.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1][1]</p></td>
<td align="left" valign="top"><p class="table">output/bbb_001.dat</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[3][9]</p></td>
<td align="left" valign="top"><p class="table">output/ddd_009.dat</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_executing_app_procedures">Executing app procedures</h3>
<div class="paragraph"><p>This section describes how Swift executes app procedures, and
requirements on the behaviour of application programs used in app
procedures. These requirements are primarily to ensure that the Swift
can run your application in different places and with the various fault
tolerance mechanisms in place.</p></div>
<div class="sect3">
<h4 id="_mapping_of_app_semantics_into_unix_process_execution_semantics">Mapping of app semantics into unix process execution semantics</h4>
<div class="paragraph"><p>This section describes how an app procedure invocation is translated
into a (remote) unix process execution. It does not describe the
mechanisms by which Swift performs that translation; that is described
in the next section.</p></div>
<div class="paragraph"><p>In this section, this example Swift script is used for reference:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type file;

app (file o) count(file i) {
  wc @i stdout=@o;
}

file q &lt;"input.txt"&gt;;
file r &lt;"output.txt"&gt;;</code></pre>
</div></div>
<div class="paragraph"><p>The executable for wc will be looked up in tc.data.</p></div>
<div class="paragraph"><p>This unix executable will then be executed in some application
procedure workspace. This means:</p></div>
<div class="paragraph"><p>Each application procedure workspace will have an application workspace
directory. (TODO: can collapse terms application procedure workspace
and application workspace directory ?</p></div>
<div class="paragraph"><p>This application workspace directory will not be shared with any other
application procedure execution attempt; all application procedure
execution attempts will run with distinct application procedure
workspaces. (for the avoidance of doubt: If a Swift script procedure
invocation is subject to multiple application procedure execution
attempts (due to Swift-level restarts, retries or replication) then each
of those application procedure execution attempts will be made in a
different application procedure workspace. )</p></div>
<div class="paragraph"><p>The application workspace directory will be a directory on a POSIX
filesystem accessible throughout the application execution by the
application executable.</p></div>
<div class="paragraph"><p>Before the application executable is executed:</p></div>
<div class="ulist"><ul>
<li>
<p>
The application workspace directory will exist.
</p>
</li>
<li>
<p>
The input files will exist inside the application workspace
      directory (but not necessarily as direct children; there may be
      subdirectories within the application workspace directory).
</p>
</li>
<li>
<p>
The input files will be those files mapped to input parameters
      of the application procedure invocation. (In the example, this
      means that the file input.txt will exist in the application
      workspace directory)
</p>
</li>
<li>
<p>
For each input file dataset, it will be the case that @filename
      or @filenames invoked with that dataset as a parameter will
      return the path relative to the application workspace directory
      for the file(s) that are associated with that dataset. (In the
      example, that means that @i will evaluate to the path input.txt)
</p>
</li>
<li>
<p>
For each file-bound parameter of the Swift procedure invocation,
      the associated files (determined by data type?) will always exist.
</p>
</li>
<li>
<p>
The input files must be treated as read only files. This may or
      may not be enforced by unix file system permissions. They may or
      may not be copies of the source file (conversely, they may be
      links to the actual source file).
</p>
</li>
</ul></div>
<div class="paragraph"><p>During/after the application executable execution, the following must
be true:</p></div>
<div class="ulist"><ul>
<li>
<p>
If the application executable execution was successful (in the
      opinion of the application executable), then the application
      executable should exit with unix return code 0; if the
      application executable execution was unsuccessful (in the opinion
      of the application executable), then the application executable
      should exit with unix return code not equal to 0.
</p>
</li>
<li>
<p>
Each file mapped from an output parameter of the Swift script
      procedure call must exist. Files will be mapped in the same way as
      for input files.
</p>
</li>
<li>
<p>
The output subdirectories will be precreated
      before execution by Swift if defined within a Swift script such as the
      location attribute of a mapper. App executables expect to make them if
      they are referred to in the wrapper scripts.
</p>
</li>
<li>
<p>
Output produced by running the application executable on some
      inputs should be the same no matter how many times, when or where
      that application executable is run. <em>The same</em> can vary depending
      on application (for example, in an application it might be
      acceptable for a PNG&#8594;JPEG conversion to produce different,
      similar looking, output jpegs depending on the environment)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Things to not assume:</p></div>
<div class="ulist"><ul>
<li>
<p>
Anything about the path of the application workspace directory
</p>
</li>
<li>
<p>
That either the application workspace directory will be deleted or
      will continue to exist or will remain unmodified after execution
      has finished
</p>
</li>
<li>
<p>
That files can be passed between application procedure
      invocations through any mechanism except through files known to
      Swift through the mapping mechanism (there is some exception here
      for external datasets - there are a separate set of assertions
      that hold for external datasets)
</p>
</li>
<li>
<p>
That application executables will run on any particular site of
      those available, or than any combination of applications will run
      on the same or different sites.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_how_swift_implements_the_site_execution_model">How Swift implements the site execution model</h3>
<div class="paragraph"><p>This section describes the implementation of the semantics described in
the previous section.</p></div>
<div class="paragraph"><p>Swift executes application procedures on one or more sites.</p></div>
<div class="paragraph"><p>Each site consists of:</p></div>
<div class="ulist"><ul>
<li>
<p>
worker nodes. There is some execution mechanism through which
      the Swift client side executable can execute its wrapper script
      on those worker nodes. This is commonly GRAM or Falkon or coasters.
</p>
</li>
<li>
<p>
a site-shared file system. This site shared filesystem is
      accessible through some file transfer mechanism from the Swift
      client side executable. This is commonly GridFTP or coasters. This
      site shared filesystem is also accessible through the posix file
      system on all worker nodes, mounted at the same location as seen
      through the file transfer mechanism. Swift is configured with the
      location of some site working directory on that site-shared file
      system.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There is no assumption that the site shared file system for one site is
accessible from another site.</p></div>
<div class="paragraph"><p>For each workflow run, on each site that is used by that run, a run
directory is created in the site working directory, by the Swift client
side.</p></div>
<div class="paragraph"><p>In that run directory are placed several subdirectories:</p></div>
<div class="ulist"><ul>
<li>
<p>
shared/ - site shared files cache
</p>
</li>
<li>
<p>
kickstart/ - when kickstart is used, kickstart record files for
      each job that has generated a kickstart record.
</p>
</li>
<li>
<p>
info/ - wrapper script log files
</p>
</li>
<li>
<p>
status/ - job status files
</p>
</li>
<li>
<p>
jobs/ - application workspace directories (optionally placed
      here - see below)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Application execution looks like this:</p></div>
<div class="paragraph"><p>For each application procedure call:</p></div>
<div class="paragraph"><p>The Swift client side selects a site; copies the input files for that
procedure call to the site shared file cache if they are not already in
the cache, using the file transfer mechanism; and then invokes the
wrapper script on that site using the execution mechanism.</p></div>
<div class="paragraph"><p>The wrapper script creates the application workspace directory; places
the input files for that job into the application workspace directory
using either cp or ln -s (depending on a configuration option);
executes the application unix executable; copies output files from the
application workspace directory to the site shared directory using cp;
creates a status file under the status/ directory; and exits,
returning control to the Swift client side. Logs created during the
execution of the wrapper script are stored under the info/ directory.</p></div>
<div class="paragraph"><p>The Swift client side then checks for the presence of and deletes a
status file indicating success; and copies files from the site shared
directory to the appropriate client side location.</p></div>
<div class="paragraph"><p>The job directory is created (in the default mode) under the jobs/
directory. However, it can be created under an arbitrary other path,
which allows it to be created on a different file system (such as a
worker node local file system in the case that the worker node has a
local file system).</p></div>
<div class="paragraph"><p><span class="image">
<img src="swift-site-model.png" alt="swift-site-model.png" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_technical_overview_of_the_swift_architecture">Technical overview of the Swift architecture</h3>
<div class="paragraph"><p>This section attempts to provide a technical overview of the Swift
architecture.</p></div>
<div class="sect3">
<h4 id="_execution_layer">Execution layer</h4>
<div class="paragraph"><p>The execution layer causes an application program (in the form of a unix
executable) to be executed either locally or remotely.</p></div>
<div class="paragraph"><p>The two main choices are local unix execution and execution through
GRAM. Other options are available, and user provided code can also be
plugged in.</p></div>
<div class="paragraph"><p>The kickstart utility can be used to capture environmental
information at execution time to aid in debugging and provenance capture.</p></div>
</div>
<div class="sect3">
<h4 id="_swift_script_language_compilation_layer">Swift script language compilation layer</h4>
<div class="paragraph"><p>Step i: text to XML intermediate form parser/processor. parser written
in ANTLR - see resources/VDL.g. The XML Schema Definition (XSD) for the
intermediate language is in resources/XDTM.xsd.</p></div>
<div class="paragraph"><p>Step ii: XML intermediate form to Karajan workflow. Karajan.java - reads
the XML intermediate form. compiles to karajan workflow language - for
example, expressions are converted from Swift script syntax into Karajan
syntax, and function invocations become karajan function invocations
with various modifications to parameters to accomodate return parameters
and dataset handling.</p></div>
</div>
<div class="sect3">
<h4 id="_swift_karajan_library_layer">Swift/karajan library layer</h4>
<div class="paragraph"><p>Some Swift functionality is provided in the form of Karajan libraries
that are used at runtime by the Karajan workflows that the Swift
compiler generates.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_function_reference">Function reference</h3>
<div class="paragraph"><p>This section details functions that are available for use in the
Swift language.</p></div>
<div class="sect3">
<h4 id="_arg">arg</h4>
<div class="paragraph"><p>Takes a command line parameter name as a string parameter and an
optional default value and returns the value of that string parameter
from the command line. If no default value is specified and the command
line parameter is missing, an error is generated. If a default value is
specified and the command line parameter is missing, @arg will return
the default value.</p></div>
<div class="paragraph"><p>Command line parameters recognized by @arg begin with exactly one
hyphen and need to be positioned after the script name.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>trace(arg("myparam"));
trace(arg("optionalparam", "defaultvalue"));</code></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><code>$ swift arg.swift -myparam=hello
Swift v0.3-dev r1674 (modified locally)

RunID: 20080220-1548-ylc4pmda
Swift trace: defaultvalue
Swift trace: hello</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_extractint">extractInt</h4>
<div class="paragraph"><p>extractInt(file) will read the specified file, parse an integer from
the file contents and return that integer.</p></div>
</div>
<div class="sect3">
<h4 id="_extractfloat">extractFloat</h4>
<div class="paragraph"><p>Similar to extractInt, extractFloat(file) will read the specified file, parse a float from
the file contents and return that float.</p></div>
</div>
<div class="sect3">
<h4 id="_filename">filename</h4>
<div class="paragraph"><p>filename(v) will return a string containing the filename(s) for the
file(s) mapped to the variable v. When more than one filename is
returned, the filenames will be space separated inside a single string
return value.</p></div>
</div>
<div class="sect3">
<h4 id="_filenames">filenames</h4>
<div class="paragraph"><p>filenames(v) will return multiple values containing the
filename(s) for the file(s) mapped to the variable v.</p></div>
</div>
<div class="sect3">
<h4 id="_length">length</h4>
<div class="paragraph"><p>length(array) will return the length of an array in Swift. This function will wait for all
elements in the array to be written before returning the length.</p></div>
</div>
<div class="sect3">
<h4 id="_readdata">readData</h4>
<div class="paragraph"><p>readData will read data from a specified file and assign it to Swift variable. The format of the input file is
controlled by the type of the return value. For scalar return types, such as
int, the specified file should contain a single value of that type. For arrays
of scalars, the specified file should contain one value per line.  For complex types
of scalars, the file should contain two rows. The first row should be structure
member names separated by whitespace. The second row should be the
corresponding values for each structure member, separated by whitespace, in the
same order as the header row.  For arrays of structs, the file should contain a
heading row listing structure member names separated by whitespace. There
should be one row for each element of the array, with structure member elements
listed in the same order as the header row and separated by whitespace. The following example shows how readData() can be used to populate an array of Swift struct-like complex type:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type Employee{
    string name;
    int id;
    string loc;
}

Employee emps[] = readData("emps.txt");</code></pre>
</div></div>
<div class="paragraph"><p>Where the contents of the "emps.txt" file are:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>name id loc
Thomas 2222 Chicago
Gina 3333 Boston
Anne 4444 Houston</code></pre>
</div></div>
<div class="paragraph"><p>This will result in the array "emps" with 3 members. This can be processed within a Swift script using the foreach construct as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>foreach emp in emps{
    tracef("Employee %s lives in %s and has id %d", emp.name, emp.loc, emp.id);
}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_readstructured">readStructured</h4>
<div class="paragraph"><p>readStructured will read data from a specified file, like readdata, but
using a different file format more closely related to that used by the
ext mapper.</p></div>
<div class="paragraph"><p>Input files should list, one per line, a path into a Swift structure,
and the value for that position in the structure:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>rows[0].columns[0] = 0
rows[0].columns[1] = 2
rows[0].columns[2] = 4
rows[1].columns[0] = 1
rows[1].columns[1] = 3
rows[1].columns[2] = 5</code></pre>
</div></div>
<div class="paragraph"><p>which can be read into a structure defined like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type vector {
        int columns[];
}

type matrix {
        vector rows[];
}

matrix m;

m = readStructured("readStructured.in");</code></pre>
</div></div>
<div class="paragraph"><p>(since Swift 0.7, was readData2(deprecated))</p></div>
</div>
<div class="sect3">
<h4 id="_regexp">regexp</h4>
<div class="paragraph"><p>regexp(input,pattern,replacement) will apply regular expression
substitution using the Java java.util.regexp API
<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html">http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html</a>.
For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string v =  regexp("abcdefghi", "c(def)g","monkey");</code></pre>
</div></div>
<div class="paragraph"><p>will assign the value "abmonkeyhi" to the variable v.</p></div>
</div>
<div class="sect3">
<h4 id="_sprintf">sprintf</h4>
<div class="paragraph"><p>sprintf(spec, variable list) will generate a string based on the specified format.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Example: string s = sprintf("\t%s\n", "hello");</code></pre>
</div></div>
<div class="paragraph"><p>Format specifiers</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">%%</p></td>
<td align="left" valign="top"><p class="table">% sign</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%M</p></td>
<td align="left" valign="top"><p class="table">Filename output (waits for close)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%p</p></td>
<td align="left" valign="top"><p class="table">Format variable according to an internal format</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%b</p></td>
<td align="left" valign="top"><p class="table">Boolean output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%f</p></td>
<td align="left" valign="top"><p class="table">Float output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%i</p></td>
<td align="left" valign="top"><p class="table">int output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%s</p></td>
<td align="left" valign="top"><p class="table">String output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%k</p></td>
<td align="left" valign="top"><p class="table">Variable sKipped, no output</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%q</p></td>
<td align="left" valign="top"><p class="table">Array output</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_strcat">strcat</h4>
<div class="paragraph"><p>strcat(a,b,c,d,&#8230;) will return a string containing all of the
strings passed as parameters joined into a single string. There may be
any number of parameters.</p></div>
<div class="paragraph"><p>The + operator concatenates two strings: strcat(a,b) is the same as
a + b</p></div>
</div>
<div class="sect3">
<h4 id="_strcut">strcut</h4>
<div class="paragraph"><p>strcut(input,pattern) will match the regular expression in the
pattern parameter against the supplied input string and return the
section that matches the first matching parenthesised group.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string t = "my name is John and i like puppies.";
string name = strcut(t, "my name is ([^ ]*) ");
string out = strcat("Your name is ",name);
trace(out);</code></pre>
</div></div>
<div class="paragraph"><p>This will output the message: Your name is John.</p></div>
</div>
<div class="sect3">
<h4 id="_strjoin">strjoin</h4>
<div class="paragraph"><p>strjoin(array, delimiter) will combine the elements of an array
into a single string separated by a given delimiter. The array
passed to strjoin must be of a primitive type (string, int, float,
or boolean). It will not join the contents of an array of files.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string test[] = ["this", "is", "a", "test" ];
string mystring = strjoin(test, " ");
tracef("%s\n", mystring);</code></pre>
</div></div>
<div class="paragraph"><p>This will print the string "this is a test".</p></div>
</div>
<div class="sect3">
<h4 id="_strsplit">strsplit</h4>
<div class="paragraph"><p>strsplit(input,pattern) will split the input string based on
separators that match the given pattern and return a string array.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>string t = "my name is John and i like puppies.";
string words[] = strsplit(t, "\\s");
foreach word in words {
    trace(word);
}</code></pre>
</div></div>
<div class="paragraph"><p>This will output one word of the sentence on each line (though not
necessarily in order, due to the fact that foreach iterations execute in
parallel).</p></div>
</div>
<div class="sect3">
<h4 id="_toint">toInt</h4>
<div class="paragraph"><p>toInt(input) will parse its input string into an integer. This can be
used with arg() to pass input parameters to a Swift script as
integers.</p></div>
</div>
<div class="sect3">
<h4 id="_tofloat">toFloat</h4>
<div class="paragraph"><p>toFloat(input) will parse its input string into a floating point number. This can be
used with arg() to pass input parameters to a Swift script as
floating point numbers.</p></div>
</div>
<div class="sect3">
<h4 id="_tostring">toString</h4>
<div class="paragraph"><p>toString(input) will parse its input into a string. Input can be an int, float, string,
or boolean.</p></div>
</div>
<div class="sect3">
<h4 id="_trace">trace</h4>
<div class="paragraph"><p>trace will log its parameters. By default these will appear on both
stdout and in the run log file. Some formatting occurs to produce the
log message. The particular output format should not be relied upon.</p></div>
</div>
<div class="sect3">
<h4 id="_tracef">tracef</h4>
<div class="paragraph"><p><code>tracef(<em>spec</em>, <em>variable list</em>)</code> will log its parameters as formatted
by the formatter <em>spec</em>.  <em>spec</em> must be a string. Checks the type of
the specifiers arguments against the variable list and allows for
certain escape characters.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>int i = 3;
tracef("%s: %i\n", "the value is", i);</code></pre>
</div></div>
<div class="paragraph"><p>Specifiers:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>%s</code>
</dt>
<dd>
<p>
Format a string.
</p>
</dd>
<dt class="hdlist1">
<code>%b</code>
</dt>
<dd>
<p>
Format a boolean.
</p>
</dd>
<dt class="hdlist1">
<code>%i</code>
</dt>
<dd>
<p>
Format a number as an integer.
</p>
</dd>
<dt class="hdlist1">
<code>%f</code>
</dt>
<dd>
<p>
Format a number as a floating point number.
</p>
</dd>
<dt class="hdlist1">
<code>%q</code>
</dt>
<dd>
<p>
Format an array.
</p>
</dd>
<dt class="hdlist1">
<code>%M</code>
</dt>
<dd>
<p>
Format a mapped variable&#8217;s filename.
</p>
</dd>
<dt class="hdlist1">
<code>%k</code>
</dt>
<dd>
<p>
Wait for the given variable but do not format it.
</p>
</dd>
<dt class="hdlist1">
<code>%p</code>
</dt>
<dd>
<p>
Format variable according to an internal format.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Escape sequences:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>\n</code>
</dt>
<dd>
<p>
Produce a newline.
</p>
</dd>
<dt class="hdlist1">
<code>\t</code>
</dt>
<dd>
<p>
Produce a tab.
</p>
</dd>
<dt class="hdlist1">
Known issues: 
</dt>
<dd>
<p>
Swift does not correctly scan certain backslash
sequences such as <code>\\</code>.
</p>
</dd>
</dl></div>
</div>
<div class="sect3">
<h4 id="_java">java</h4>
<div class="paragraph"><p>java(class_name, static_method, method_arg) will call a java static method of the class class_name.</p></div>
</div>
<div class="sect3">
<h4 id="_writedata">writeData</h4>
<div class="paragraph"><p>writeData will write out data structures in the format described for
readData. The following example demonstrates how one can write a string "foo" into a file "writeDataPrimitive.out":</p></div>
<div class="listingblock">
<div class="content">
<pre><code>type file;

string s = "foo";

file f &lt;"writeDataPrimitive.out"&gt;;

f=writeData(s);</code></pre>
</div></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-12-05 17:15:13 CST
</div>
</div>
</body>
</html>
