<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.4" />
<title>A Swift Tutorial</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>A Swift Tutorial</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_abstract">1. Abstract</h2>
<div class="sectionbody">
<div class="paragraph"><p>This is an introductory tutorial on the use of Swift and its programming
language SwiftScript.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">2. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>This tutorial is intended to introduce new users to the basics of Swift.
It is structured as a series of small exercise/examples which you can
try for yourself as you read along. After the first <em>hello world</em>
example, there are two tracks - the language track (which introduces
features of the SwiftScript language) and the runtime track (which
introduces features of the Swift runtime environment, such as running
jobs on different sites).</p></div>
<div class="paragraph"><p>For information on getting an installation of Swift running, consult the
Swift Quickstart Guide <a href="http://www.ci.uchicago.edu/swift/guides/quickstartguide.php">http://www.ci.uchicago.edu/swift/guides/quickstartguide.php</a>, and
return to this document when you have successfully run the test
SwiftScript program mentioned there.</p></div>
<div class="paragraph"><p>There is also a Swift User&#8217;s Guide
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php">http://www.ci.uchicago.edu/swift/guides/userguide.php</a> which contains
more detailed reference material on topics covered in this manual. All
of the programs included in this tutorial can be found in your Swift
distribution in the examples/swift directory.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_hello_world">3. Hello World</h2>
<div class="sectionbody">
<div class="paragraph"><p>The first example program, first.swift, outputs a hello world message
into a file called hello.txt.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">first.swift</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #FF0000">"Hello, world!"</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"hello.txt"</span><span style="color: #990000">&gt;;</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">();</span></tt></pre></div></div>
</div></div>
<div class="paragraph"><p>We can run this program as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">cd</span> examples<span style="color: #990000">/</span>swift<span style="color: #990000">/</span>
$ <span style="color: #008080">swift</span> first<span style="color: #990000">.</span>swift
Swift <span style="color: #008080">svn</span> swift<span style="color: #990000">-</span><span style="font-weight: bold"><span style="color: #000000">r3334</span></span> <span style="color: #990000">(</span>swift <span style="color: #008080">modified</span> locally<span style="color: #990000">)</span> cog<span style="color: #990000">-</span>r2752

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1925</span><span style="color: #990000">-</span>8zjupq1b
Progress<span style="color: #990000">:</span>
<span style="color: #008080">Final</span> status<span style="color: #990000">:</span>  <span style="color: #008080">Finished</span> successfully<span style="color: #990000">:</span><span style="color: #993399">1</span>
$ <span style="color: #008080">cat</span> hello<span style="color: #990000">.</span>txt
Hello<span style="color: #990000">,</span> world<span style="color: #990000">!</span></tt></pre></div></div>
<div class="paragraph"><p>The basic structure of this program is a type definition, an
application procedure definition, a variable definition and then a
call to the procedure:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>First we define a new type, called messagefile. In this example, we will
use this messagefile type as the type for our output message.</p></div>
<div class="paragraph"><p>All data in SwiftScript must be typed, whether it is stored in memory or
on disk. This example defines a very simple type. Later on we will see
more complex type examples.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #FF0000">"Hello, world!"</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Next we define a procedure called greeting. This procedure will write
out the "hello world" message to a file.</p></div>
<div class="paragraph"><p>To achieve this, it executes the unix utility <em>echo</em> with a parameter
"Hello, world!" and directs the standard output into the output file.</p></div>
<div class="paragraph"><p>The actual file to use is specified by the return parameter, t.</p></div>
<div class="paragraph"><p>messagefile outfile &lt;"hello.txt"&gt;;</p></div>
<div class="paragraph"><p>Here we define a variable called outfile. The type of this variable is
messagefile, and we specify that the contents of this variable will be
stored on disk in a file called hello.txt</p></div>
<div class="paragraph"><p>outfile = greeting();</p></div>
<div class="paragraph"><p>Now we call the greeting procedure, with its output going to the outfile
variable and therefore to hello.txt on disk.</p></div>
<div class="paragraph"><p>Over the following exercises, we&#8217;ll extend this simple hello world
program to demonstrate various features of Swift.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_language_features">4. Language features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_parameters">4.1. Parameters</h3>
<div class="paragraph"><p>Procedures can have parameters. Input parameters specify inputs to the
procedure and output parameters specify outputs. Our helloworld greeting
procedure already uses an output parameter, t, which indicates where the
greeting output will go. In this section, we will add an input parameter
to the greeting function.</p></div>
<div class="paragraph"><p>The code changes from first.swift are highlighted below.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">string</span> s<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #008080">s</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"hello2.txt"</span><span style="color: #990000">&gt;;</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hello world"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>We have modified the signature of the greeting procedure to indicate
that it takes a single parameter, s, of type <em>string</em>.</p></div>
<div class="paragraph"><p>We have modified the invocation of the <em>echo</em> utility so that it takes
the value of s as a parameter, instead of the string literal "Hello,
world!".</p></div>
<div class="paragraph"><p>We have modified the output file definition to point to a different file
on disk.</p></div>
<div class="paragraph"><p>We have modified the invocation of greeting so that a greeting string is
supplied.</p></div>
<div class="paragraph"><p>The code for this section can be found in parameter.swift. It can be
invoked using the swift command, with output appearing in hello2.txt:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> parameter<span style="color: #990000">.</span>swift</tt></pre></div></div>
<div class="paragraph"><p>Now that we can choose our greeting text, we can call the same procedure
with different parameters to generate several output files with
different greetings. The code is in manyparam.swift and can be run as
before using the swift command.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">string</span> s<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #008080">s</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> english <span style="color: #990000">&lt;</span><span style="color: #FF0000">"english.txt"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">messagefile</span> french <span style="color: #990000">&lt;</span><span style="color: #FF0000">"francais.txt"</span><span style="color: #990000">&gt;;</span>
english <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hello"</span><span style="color: #990000">);</span>
french <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"bonjour"</span><span style="color: #990000">);</span>

<span style="color: #008080">messagefile</span> japanese <span style="color: #990000">&lt;</span><span style="color: #FF0000">"nihongo.txt"</span><span style="color: #990000">&gt;;</span>
japanese <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"konnichiwa"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Note that we can intermingle definitions of variables with invocations
of procedures.</p></div>
<div class="paragraph"><p>When this program has been run, there should be three new files in the
working directory (english.txt, francais.txt and nihongo.txt) each
containing a greeting in a different language.</p></div>
<div class="paragraph"><p>In addition to specifying parameters positionally, parameters can be
named, and if desired a default value can be specified - see <a href="#named_parameters">Named and Optional Parameters</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_adding_another_application">4.2. Adding another application</h3>
<div class="paragraph"><p>Now we&#8217;ll define a new application procedure. The procedure we define
will capitalise all the words in the input file.</p></div>
<div class="paragraph"><p>To do this, we&#8217;ll use the unix tr (translate) utility. Here is an
example of using tr on the unix command line, not using Swift:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">echo</span> hello <span style="color: #990000">|</span> tr <span style="color: #FF0000">'[a-z]'</span> <span style="color: #FF0000">'[A-Z]'</span>
HELLO</tt></pre></div></div>
<div class="ulist"><div class="title">There are several steps</div><ul>
<li>
<p>
transformation catalog
</p>
</li>
<li>
<p>
application block
</p>
</li>
</ul></div>
<div class="paragraph"><p>First we need to modify the transformation catalog to define a logical
transformation for the tc utility. The transformation catalog can be
found in etc/tc.data. There are already several entries specifying
where programs can be found. Add a new line to the file, specifying
where <strong>tr</strong> can be found (usually in /usr/bin/tr but it may differ on
your system), like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">localhost</span>       tr      <span style="color: #990000">/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>tr     <span style="color: #008080">INSTALLED</span>       INTEL32<span style="color: #990000">::</span>LINUX  <span style="font-weight: bold"><span style="color: #0000FF">null</span></span></tt></pre></div></div>
<div class="paragraph"><p>For now, ignore all of the fields except the second and the third. The
second field tr specifies a logical application name and the third
specifies the location of the application executable.</p></div>
<div class="paragraph"><p>Now that we have defined where to find tr, we can use it in SwiftScript.</p></div>
<div class="paragraph"><p>We can define a new procedure, capitalise, which calls tr.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">messagefile</span> o<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">capitalise</span></span><span style="color: #990000">(</span><span style="color: #008080">messagefile</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        tr <span style="color: #FF0000">"[a-z]"</span> <span style="color: #FF0000">"[A-Z]"</span> stdin<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>o<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>We can call capitalise like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #990000">&lt;</span><span style="color: #FF0000">"capitals.txt"</span><span style="color: #990000">&gt;;</span>
<span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">capitalise</span></span><span style="color: #990000">(</span>hellofile<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>So a full program based on the first exercise might look like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">string</span> s<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #008080">s</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> o<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">capitalise</span></span><span style="color: #990000">(</span><span style="color: #008080">messagefile</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    tr <span style="color: #FF0000">"[a-z]"</span> <span style="color: #FF0000">"[A-Z]"</span> stdin<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>o<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> hellofile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"hello.txt"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">messagefile</span> <span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #990000">&lt;</span><span style="color: #FF0000">"capitals.txt"</span><span style="color: #990000">&gt;;</span>

hellofile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hello from Swift"</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">final</span></span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">capitalise</span></span><span style="color: #990000">(</span>hellofile<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>We can use the swift command to run it like this.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> second_procedure<span style="color: #990000">.</span>swift
<span style="color: #990000">...</span>
$ <span style="color: #008080">cat</span> capitals<span style="color: #990000">.</span>txt
HELLO FROM SWIFT</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_anonymous_files">4.3. Anonymous files</h3>
<div class="paragraph"><p>In the previous section, the file greeting.txt is used only to store
an intermediate result. We don&#8217;t really care about which name is used
for the file, and we can let Swift choose the name.</p></div>
<div class="paragraph"><p>To do that, omit the mapping entirely when declaring outfile:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> outfile<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>Swift will choose a filename, which in the present version will be in a
subdirectory called _concurrent.</p></div>
</div>
<div class="sect2">
<h3 id="_datatypes">4.4. Datatypes</h3>
<div class="paragraph"><p>All data in variables and files has a data type. So far, we&#8217;ve seen two
types:</p></div>
<div class="ulist"><ul>
<li>
<p>
string - this is a built-in type for storing strings of text in
      memory, much like in other programming languages
</p>
</li>
<li>
<p>
messagefile - this is a user-defined type used to mark files as
      containing messages
</p>
</li>
</ul></div>
<div class="paragraph"><p>SwiftScript has the additional built-in types: boolean, integer and
float that function much like their counterparts in other programming
languages.</p></div>
<div class="paragraph"><p>It is also possible to create user defined types with more structure,
for example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> details <span style="color: #FF0000">{</span>
    <span style="color: #008080">string</span> name<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> pies<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Each element of the structured type can be accessed using a . like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>person<span style="color: #990000">.</span>name <span style="color: #990000">=</span> <span style="color: #FF0000">"john"</span><span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>The following complete program, types.swift, outputs a greeting using a
user-defined structure type to hold parameters for the message:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="color: #008080">type</span> details <span style="color: #FF0000">{</span>
    <span style="color: #008080">string</span> name<span style="color: #990000">;</span>
    <span style="color: #009900">int</span> pies<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">details</span> d<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #FF0000">"Hello. Your name is"</span> d<span style="color: #990000">.</span>name <span style="color: #FF0000">"and you have eaten"</span> d<span style="color: #990000">.</span>pies <span style="color: #FF0000">"pies."</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">details</span> person<span style="color: #990000">;</span>

person<span style="color: #990000">.</span>name <span style="color: #990000">=</span> <span style="color: #FF0000">"John"</span><span style="color: #990000">;</span>
person<span style="color: #990000">.</span>pies <span style="color: #990000">=</span> <span style="color: #993399">3</span><span style="color: #990000">;</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"q15.txt"</span><span style="color: #990000">&gt;;</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span>person<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Structured types can be comprised of marker types for files. See the
later section on mappers for more information about this.</p></div>
</div>
<div class="sect2">
<h3 id="_arrays">4.5. Arrays</h3>
<div class="paragraph"><p>We can define arrays using the [] suffix in a variable declaration:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> m<span style="color: #990000">[];</span></tt></pre></div></div>
<div class="paragraph"><p>This program, q5.swift, will declare an array of message files.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">string</span> s<span style="color: #990000">[])</span> <span style="color: #FF0000">{</span>
     <span style="color: #008080">echo</span> s<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> s<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> s<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"q5out.txt"</span><span style="color: #990000">&gt;;</span>

<span style="color: #008080">string</span> words<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #990000">[</span><span style="color: #FF0000">"how"</span><span style="color: #990000">,</span><span style="color: #FF0000">"are"</span><span style="color: #990000">,</span><span style="color: #FF0000">"you"</span><span style="color: #990000">];</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span>words<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Observe that the type of the parameter to greeting is now an array of
strings, string s[], instead of a single string, string s, that
elements of the array can be referenced numerically, for example s[0],
and that the array is initialised using an array literal,
["how","are","you"].</p></div>
</div>
<div class="sect2">
<h3 id="_mappers">4.6. Mappers</h3>
<div class="paragraph"><p>A significant difference between SwiftScript and other languages is that
data can be referred to on disk through variables in a very similar
fashion to data in memory. For example, in the above examples we have
seen a variable definition like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"q13greeting.txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>This means that outfile is a dataset variable, which is mapped to a
file on disk called g13greeting.txt. This variable can be assigned to
using = in a similar fashion to an in-memory variable. We can say that
outfile is mapped onto the disk file q13greeting.txt by a mapper.</p></div>
<div class="paragraph"><p>There are various ways of mapping in SwiftScript. Two forms have already
been seen in this tutorial. Later exercises will introduce more forms.</p></div>
<div class="paragraph"><p>The two forms of mapping seen so far are:</p></div>
<div class="paragraph"><p>simple named mapping - the name of the file that a variable is mapped to
is explictly listed. Like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"greeting.txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>This is useful when you want to explicitly name input and output files
for your program. For example, outfile in exercise HELLOWORLD.</p></div>
<div class="paragraph"><p>anonymous mapping - no name is specified in the source code. A name is
automatically generated for the file. This is useful for intermediate
files that are only referenced through SwiftScript, such as outfile in
exercise ANONYMOUSFILE. A variable declaration is mapped anonymously by
ommitting any mapper definition, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> outfile<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>Later exercises will introduce other ways of mapping from disk files to
SwiftScript variables.</p></div>
<div class="paragraph"><p>TODO: introduce @v syntax.</p></div>
<div class="sect3">
<h4 id="_the_regexp_mapper">4.6.1. The Regexp Mapper</h4>
<div class="paragraph"><p>In this exercise, we introduce the regexp mapper. This mapper
transforms a string expression using a regular expression, and uses the
result of that transformation as the filename to map.</p></div>
<div class="paragraph"><p>regexp.swift demonstrates the use of this by placing output into a
file that is based on the name of the input file: our input file is
mapped to the inputfile variable using the simple named mapper, and then
we use the regular expression mapper to map the output file. Then we use
the countwords() procedure to count the works in the input file and
store the result in the output file. In order for the countwords()
procedure to work correctly, add the wc utility (usually found in
/usr/bin/wc) to tc.data.</p></div>
<div class="paragraph"><p>The important bit of regexp.swift is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">messagefile</span> inputfile <span style="color: #990000">&lt;</span><span style="color: #FF0000">"q16.txt"</span><span style="color: #990000">&gt;;</span>

<span style="color: #008080">countfile</span> c <span style="color: #990000">&lt;</span>regexp_mapper<span style="color: #990000">;</span>
             source<span style="color: #990000">=</span>@inputfile<span style="color: #990000">,</span>
             match<span style="color: #990000">=</span><span style="color: #FF0000">"(.*)txt"</span><span style="color: #990000">,</span>
             transform<span style="color: #990000">=</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">1count"</span>
            <span style="color: #990000">&gt;;</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_fixed_array_mapper">4.6.2. fixed_array_mapper</h4>
<div class="paragraph"><p>The fixed array mapper maps a list of files into an array - each
element of the array is mapped into one file in the specified directory.
See fixedarray.swift.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile <span style="color: #FF0000">{}</span>
<span style="color: #008080">type</span> countfile <span style="color: #FF0000">{}</span>

<span style="color: #990000">(</span><span style="color: #008080">countfile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> f<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        wc <span style="color: #FF0000">"-w"</span> @<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>f<span style="color: #990000">)</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">string</span> inputNames <span style="color: #990000">=</span> <span style="color: #FF0000">"one.txt two.txt three.txt"</span><span style="color: #990000">;</span>
<span style="color: #008080">string</span> outputNames <span style="color: #990000">=</span> <span style="color: #FF0000">"one.count two.count three.count"</span><span style="color: #990000">;</span>

<span style="color: #008080">messagefile</span> inputfiles<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>fixed_array_mapper<span style="color: #990000">;</span>files<span style="color: #990000">=</span>inputNames<span style="color: #990000">&gt;;</span>
<span style="color: #008080">countfile</span> outputfiles<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>fixed_array_mapper<span style="color: #990000">;</span>files<span style="color: #990000">=</span>outputNames<span style="color: #990000">&gt;;</span>

outputfiles<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span><span style="color: #990000">(</span>inputfiles<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span>
outputfiles<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span><span style="color: #990000">(</span>inputfiles<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
outputfiles<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span><span style="color: #990000">(</span>inputfiles<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]);</span></tt></pre></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_foreach">4.7. foreach</h3>
<div class="paragraph"><p>SwiftScript provides a control structure, foreach, to operate on each
element of an array.</p></div>
<div class="paragraph"><p>In this example, we will run the previous word counting example over
each file in an array without having to explicitly list the array
elements. The source code for this example is in foreach.swift. The
three input files: one.txt, two.txt and three.txt are supplied.
After you have run the workflow, you should see that there are three
output files: one.count, two.count and three.count, each
containing the word count for the corresponding input file. We combine
the use of the fixed_array_mapper and the regexp_mapper.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile <span style="color: #FF0000">{}</span>
<span style="color: #008080">type</span> countfile <span style="color: #FF0000">{}</span>

<span style="color: #990000">(</span><span style="color: #008080">countfile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span> <span style="color: #990000">(</span><span style="color: #008080">messagefile</span> f<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        wc <span style="color: #FF0000">"-w"</span> @<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>f<span style="color: #990000">)</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">string</span> inputNames <span style="color: #990000">=</span> <span style="color: #FF0000">"one.txt two.txt three.txt"</span><span style="color: #990000">;</span>

<span style="color: #008080">messagefile</span> inputfiles<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>fixed_array_mapper<span style="color: #990000">;</span>files<span style="color: #990000">=</span>inputNames<span style="color: #990000">&gt;;</span>


foreach f <span style="color: #008080">in</span> inputfiles <span style="color: #FF0000">{</span>
  <span style="color: #008080">countfile</span> c<span style="color: #990000">&lt;</span>regexp_mapper<span style="color: #990000">;</span>
            source<span style="color: #990000">=</span>@f<span style="color: #990000">,</span>
            match<span style="color: #990000">=</span><span style="color: #FF0000">"(.*)txt"</span><span style="color: #990000">,</span>
            transform<span style="color: #990000">=</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">1count"</span><span style="color: #990000">&gt;;</span>
  c <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">countwords</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_if">4.8. If</h3>
<div class="paragraph"><p>Decisions can be made using <em>if</em>, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>morning<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"good morning"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
  outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"good afternoon"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>if.swift contains a simple example of this. Compile and run if.swift
and see that it outputs "good morning". Changing the morning variable
from true to false will cause the program to output "good afternoon".</p></div>
</div>
<div class="sect2">
<h3 id="_sequential_iteration">4.9. Sequential iteration</h3>
<div class="paragraph"><p>A development version of Swift after 0.2 (revision 1230) introduces a
sequential iteration construct.</p></div>
<div class="paragraph"><p>The following example demonstrates a simple application: each step of
the iteration is a string representation of the byte count of the
previous step&#8217;s output, with iteration terminating when the byte count
reaches zero.</p></div>
<div class="paragraph"><p>Here&#8217;s the program:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> counterfile<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">counterfile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">echo</span></span><span style="color: #990000">(</span><span style="color: #008080">string</span> m<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #008080">m</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">counterfile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">countstep</span></span><span style="color: #990000">(</span><span style="color: #008080">counterfile</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    wcl @<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>i<span style="color: #990000">)</span> @<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">counterfile</span> a<span style="color: #990000">[]</span>  <span style="color: #990000">&lt;</span>simple_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"foldout"</span><span style="color: #990000">&gt;;</span>

a<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">echo</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"793578934574893"</span><span style="color: #990000">);</span>

<span style="color: #008080">iterate</span> v <span style="color: #FF0000">{</span>
  a<span style="color: #990000">[</span>v<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">countstep</span></span><span style="color: #990000">(</span>a<span style="color: #990000">[</span>v<span style="color: #990000">]);</span>
 <span style="font-weight: bold"><span style="color: #000000">trace</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"extract int value "</span><span style="color: #990000">,</span>@<span style="font-weight: bold"><span style="color: #000000">extractint</span></span><span style="color: #990000">(</span>a<span style="color: #990000">[</span>v<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">]));</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #000000">until</span></span> <span style="color: #990000">(</span>@<span style="font-weight: bold"><span style="color: #000000">extractint</span></span><span style="color: #990000">(</span>a<span style="color: #990000">[</span>v<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">])</span> <span style="color: #990000">&lt;=</span> <span style="color: #993399">1</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>echo is the standard unix echo.</p></div>
<div class="paragraph"><p>wcl is our application code - it counts the number of bytes in the one
file and writes that count out to another, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cat <span style="color: #990000">../</span>wcl
#<span style="color: #990000">!/</span>bin<span style="color: #990000">/</span>bash
echo <span style="color: #990000">-</span>n $<span style="color: #990000">(</span>wc <span style="color: #990000">-</span>c <span style="color: #990000">&lt;</span> $<span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">&gt;</span> $<span style="color: #993399">2</span>

$ echo <span style="color: #990000">-</span><span style="color: #008080">n</span> hello <span style="color: #990000">&gt;</span> a
$ wcl a b
$ cat b
<span style="color: #993399">5</span></tt></pre></div></div>
<div class="paragraph"><p>Install the above wcl script somewhere and add a transformation catalog
entry for it. Then run the example program like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> iterate<span style="color: #990000">.</span>swift
Swift <span style="color: #008080">svn</span> swift<span style="color: #990000">-</span><span style="color: #008080">r3334</span> cog<span style="color: #990000">-</span>r2752

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">2259</span><span style="color: #990000">-</span>gtlz8zf4
Progress<span style="color: #990000">:</span>
<span style="color: #008080">SwiftScript</span> trace<span style="color: #990000">:</span> extract <span style="color: #008080">int</span> value <span style="color: #990000">,</span> <span style="color: #993399">16.0</span>
<span style="color: #008080">SwiftScript</span> trace<span style="color: #990000">:</span> extract <span style="color: #008080">int</span> value <span style="color: #990000">,</span> <span style="color: #993399">2.0</span>
<span style="color: #008080">SwiftScript</span> trace<span style="color: #990000">:</span> extract <span style="color: #008080">int</span> value <span style="color: #990000">,</span> <span style="color: #993399">1.0</span>
<span style="color: #008080">Final</span> status<span style="color: #990000">:</span>  <span style="color: #008080">Finished</span> successfully<span style="color: #990000">:</span><span style="color: #993399">4</span>

$ <span style="color: #008080">ls</span> foldout<span style="color: #990000">*</span>
foldout0000  foldout0001  foldout0002  foldout0003</tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_runtime_features">5. Runtime features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_visualising_the_workflow_as_a_graph">5.1. Visualising the workflow as a graph</h3>
<div class="paragraph"><p>When running a workflow, its possible to generate a provenance graph at
the same time:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ swift <span style="color: #990000">-</span><span style="color: #008080">pgraph</span> graph<span style="color: #990000">.</span><span style="color: #008080">dot</span> first<span style="color: #990000">.</span>swift
$ dot <span style="color: #990000">-</span>ograph<span style="color: #990000">.</span>png <span style="color: #990000">-</span><span style="color: #008080">Tpng</span> graph<span style="color: #990000">.</span>dot</tt></pre></div></div>
<div class="paragraph"><p>graph.png can then be viewed using your favourite image viewer. The dot application is part of the graphViz project. More information can be found at <a href="http://www.graphviz.org">http://www.graphviz.org</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_running_on_a_remote_site">5.2. Running on a remote site</h3>
<div class="paragraph"><p>As configured by default, all jobs are run locally. In the previous
examples, we&#8217;ve invoked echo and tr executables from our SwiftScript
program. These have been run on the local system (the same computer on
which you ran swift). We can also make our computations run on a
remote resource.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning" />
</td>
<td class="content">This example is necessarily more vague than previous examples,
because its requires access to remote resources. You should ensure that
you can submit a job using the globus-job-run (or globusrun-ws?)
command(s).</td>
</tr></table>
</div>
<div class="paragraph"><p>We do not need to modify any SwiftScript code to run on another
resource. Instead, we must modify another catalog, the site catalog.
This catalog provides details of the location that applications will be
run, with the default settings referring to the local machine. We will
modify it to refer to a remote resource - the UC Teraport cluster. If
you are not a UC Teraport user, you should use details of a different
resource that you do have access to.</p></div>
<div class="paragraph"><p>The site catalog is located in etc/sites.xml and is a relatively
straightforward XML format file. We must modify each of the following
three settings: gridftp (which indicates how and where data can be
transferred to the remote resource), jobmanager (which indicates how
applications can be run on the remote resource) and workdirectory (which
indicates where working storage can be found on the remote resource).</p></div>
</div>
<div class="sect2">
<h3 id="_writing_a_mapper">5.3. Writing a mapper</h3>
<div class="paragraph"><p>This section will introduce writing a custom mapper so that Swift is
able to access data files laid out in application-specific ways.</p></div>
<div class="paragraph"><p>An application-specific mapper must take the form of a Java class that
implements the Mapper
<a href="http://www.ci.uchicago.edu/swift/javadoc/vdsk/org/griphyn/vdl/mapping/Mapper.html">http://www.ci.uchicago.edu/swift/javadoc/vdsk/org/griphyn/vdl/mapping/Mapper.html</a>
interface.</p></div>
<div class="paragraph"><p>Usually you don&#8217;t need to implement this interface directly, because
Swift provides a number of more concrete classes with some functionality
already implemented.</p></div>
<div class="paragraph"><p>The hierarchy of helper classes is:</p></div>
<div class="paragraph"><p><a href="http://www.ci.uchicago.edu/swift/javadoc/vdsk/org/griphyn/vdl/mapping/Mapper.html">Mapper</a></p></div>
<div class="paragraph"><p>This is the abstract interface for mappers in Swift. You must
implement methods to provide access to mapper properties, to map from a
SwiftScript dataset path (such as foo[1].bar) to a file name, to check
whether a file exists. None of the default Swift mappers implement this
interface directly - instead they use one of the following helper classes.</p></div>
<div class="paragraph"><p><a href="http://www.ci.uchicago.edu/swift/javadoc/vdsk/org/griphyn/vdl/mapping/AbstractMapper.html">Abstract Mapper</a></p></div>
<div class="paragraph"><p>This provides helper methods to manage mapper properties and to handle
existance checking. Examples of mappers which use this class are:
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.array_mapper">Array Mapper</a>,
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.csv_mapper">CSV Mapper</a>,
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.fixed_array_mapper">Fixed Array Mapper</a>,
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.regexp_mapper">Regexp Mapper</a>,
and <a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.single_file_mapper">Single File Mapper</a>.</p></div>
<div class="paragraph"><p><a href="http://www.ci.uchicago.edu/swift/javadoc/vdsk/org/griphyn/vdl/mapping/file/AbstractFileMapper.html">AbstractFileMapper</a>
This provides a helper class for mappers which select files based on
selecting files from a directory listing. It is necessary to write some
helper methods that are different from the above mapper methods.
Examples of mappers which use this class are:
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.simple_mapper">simple_mapper</a>,
<a href="http://www.ci.uchicago.edu/swift/guides/userguide.php#mapper.filesys_mapper">filesys_mapper</a>,
and the (undocumented) StructuredRegularExpressionMapper.</p></div>
<div class="paragraph"><p>In general, to write a mapper, choose either the AbstractMapper or the
AbstractFileMapper and extend those. If your mapper will generally
select the files it returns based on a directory listing and will
convert paths to filenames using some regular conversion (for example,
in the way that simple_mapper maps files in a directory that match a
particular pattern), then you should probably use the
AbstractFileMapper. If your mapper will produce a list of files in some
other way (for example, in the way that csv_mapper maps based on
filenames given in a CSV file rather than looking at which files are in
a directory), then you should probably use the AbstractMapper.</p></div>
</div>
<div class="sect2">
<h3 id="_writing_a_very_basic_mapper">5.4. Writing a very basic mapper</h3>
<div class="paragraph"><p>In this section, we will write a very basic (almost useless) mapper that
will map a SwiftScript dataset into a hardcoded file called
myfile.txt, like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Swift variable                            Filename</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>var   &lt;-----------------------------&gt;    myfile.txt</tt></pre>
</div></div>
<div class="paragraph"><p>We should be able to use the mapper we write in a SwiftScript program
like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>
<span style="color: #008080">file</span> f <span style="color: #990000">&lt;</span>my_first_mapper<span style="color: #990000">;&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>First we must choose a base class - AbstractMapper or
AbstractFileMapper. We aren&#8217;t going to use a directory listing to decide
on our mapping - we are getting the mapping from some other source (in
fact, it will be hard coded). So we will use AbstractMapper.</p></div>
<div class="paragraph"><p>So now onto the source code. We must define a subclass of AbstractMapper
and implement several mapper methods: isStatic, existing, and map. These
methods are documented in the javadoc for the Mapper interface.</p></div>
<div class="paragraph"><p>Here is the code implementing this mapper. Put this in your source
vdsk directory, make a directory src/tutorial/|and put this file in
src/tutorial/MyFirstMapper.java.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">package</span></span> tutorial<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Arrays<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Collection<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> java<span style="color: #990000">.</span>util<span style="color: #990000">.</span>Collections<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000080">import</span></span> org<span style="color: #990000">.</span>griphyn<span style="color: #990000">.</span>vdl<span style="color: #990000">.</span>mapping<span style="color: #990000">.</span>AbsFile<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> org<span style="color: #990000">.</span>griphyn<span style="color: #990000">.</span>vdl<span style="color: #990000">.</span>mapping<span style="color: #990000">.</span>AbstractMapper<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> org<span style="color: #990000">.</span>griphyn<span style="color: #990000">.</span>vdl<span style="color: #990000">.</span>mapping<span style="color: #990000">.</span>Path<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> org<span style="color: #990000">.</span>griphyn<span style="color: #990000">.</span>vdl<span style="color: #990000">.</span>mapping<span style="color: #990000">.</span>PhysicalFormat<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MyFirstMapper</span> <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> AbstractMapper <span style="color: #FF0000">{</span>

  <span style="color: #008080">AbsFile</span> myfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">AbsFile</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"myfile.txt"</span><span style="color: #990000">);</span>

  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">isStatic</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Collection</span> <span style="font-weight: bold"><span style="color: #000000">existing</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>myfile<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">exists</span></span><span style="color: #990000">())</span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Arrays<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">asList</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> Path<span style="color: #990000">[]</span> <span style="color: #FF0000">{</span>Path<span style="color: #990000">.</span>EMPTY_PATH<span style="color: #FF0000">}</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> Collections<span style="color: #990000">.</span>EMPTY_LIST<span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>

  <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">PhysicalFormat</span> <span style="font-weight: bold"><span style="color: #000000">map</span></span><span style="color: #990000">(</span><span style="color: #008080">Path</span> p<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>p<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">equals</span></span><span style="color: #990000">(</span>Path<span style="color: #990000">.</span>EMPTY_PATH<span style="color: #990000">))</span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> myfile<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span>
      <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Now we need to inform the Swift engine about the existence of this
mapper. We do that by editing the MapperFactory class definition, in
src/org/griphyn/vdl/mapping/MapperFactory.java and adding a
registerMapper call alongside the existing registerMapper calls, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">registerMapper</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"my_first_mapper"</span><span style="color: #990000">,</span> tutorial<span style="color: #990000">.</span>MyFirstMapper<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">class</span></span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>The first parameter is the name of the mapper that will be used in
SwiftScript program. The second parameter is the new Mapper class that
we just wrote.</p></div>
<div class="paragraph"><p>Now rebuild Swift using the "ant redist" target.</p></div>
<div class="paragraph"><p>This new Swift build will be aware of your new mapper. We can test it
out with a hello world program:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        echo <span style="color: #FF0000">"hello"</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span>my_first_mapper<span style="color: #990000">;&gt;;</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><p>Run this program, and hopefully you will find the "hello" string has
been output into the hard coded output file myfile.txt:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">cat</span> myfile<span style="color: #990000">.</span>txt
hello</tt></pre></div></div>
<div class="paragraph"><p>So that&#8217;s a first very simple mapper implemented. Compare the source
code to the single_file_mapper in
<a href="http://www.ci.uchicago.edu/trac/swift/browser/trunk/src/org/griphyn/vdl/mapping/file/SingleFileMapper.java">SingleFileMapper.java</a>.
There is not much more code to the single_file_mapper - mostly code to
deal with the file parameter.</p></div>
</div>
<div class="sect2">
<h3 id="_starting_and_restarting">5.5. Starting and restarting</h3>
<div class="paragraph"><p>Now we&#8217;re going to try out the restart capabilities of Swift. We will
make a workflow that will deliberately fail, and then we will fix the
problem so that Swift can continue with the workflow.</p></div>
<div class="paragraph"><p>First we have the program in working form, restart.swift.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> f<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">touch</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    touch @f<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> f<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">processL</span></span><span style="color: #990000">(</span><span style="color: #008080">file</span> inp<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #FF0000">"processL"</span> stdout<span style="color: #990000">=</span>@f<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> f<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">processR</span></span><span style="color: #990000">(</span><span style="color: #008080">file</span> inp<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    broken <span style="color: #FF0000">"process"</span> stdout<span style="color: #990000">=</span>@f<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> f<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span><span style="color: #008080">file</span> left<span style="color: #990000">,</span> <span style="color: #008080">file</span> right<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    echo <span style="color: #FF0000">"join"</span> @left @<span style="color: #008080">right</span> stdout<span style="color: #990000">=</span>@f<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">file</span> f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">touch</span></span><span style="color: #990000">();</span>

<span style="color: #008080">file</span> g <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">processL</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>
<span style="color: #008080">file</span> h <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">processR</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>

<span style="color: #008080">file</span> i <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span>g<span style="color: #990000">,</span>h<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>We must define some transformation catalog entries:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">localhost</span>   touch   <span style="color: #990000">/</span>usr<span style="color: #990000">/</span>bin<span style="color: #990000">/</span>touch  <span style="color: #008080">INSTALLED</span>   INTEL32<span style="color: #990000">::</span>LINUX  <span style="font-weight: bold"><span style="color: #0000FF">null</span></span>
<span style="color: #008080">localhost</span>   broken  <span style="color: #990000">/</span>bin<span style="color: #990000">/</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span>   <span style="color: #008080">INSTALLED</span>   INTEL32<span style="color: #990000">::</span>LINUX  <span style="font-weight: bold"><span style="color: #0000FF">null</span></span></tt></pre></div></div>
<div class="paragraph"><p>Now we can run the program:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> restart<span style="color: #990000">.</span>swift
Swift <span style="color: #993399">0.9</span> swift<span style="color: #990000">-</span><span style="color: #008080">r2860</span> cog<span style="color: #990000">-</span>r2388

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1119</span><span style="color: #990000">-</span>3kgzzi15
Progress<span style="color: #990000">:</span>
<span style="color: #008080">Final</span> status<span style="color: #990000">:</span>  <span style="color: #008080">Finished</span> successfully<span style="color: #990000">:</span><span style="color: #993399">4</span></tt></pre></div></div>
<div class="paragraph"><p>Four jobs run - touch, echo, broken and a final echo. (note that broken
isn&#8217;t actually broken yet).</p></div>
<div class="paragraph"><p>Now we will break the broken job and see what happens. Replace the
definition in tc.data for broken with this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">localhost</span>    broken     <span style="color: #990000">/</span>bin<span style="color: #990000">/</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span>   <span style="color: #008080">INSTALLED</span>       INTEL32<span style="color: #990000">::</span>LINUX  <span style="font-weight: bold"><span style="color: #0000FF">null</span></span></tt></pre></div></div>
<div class="paragraph"><p>Now when we run the workflow, the broken task fails:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> restart<span style="color: #990000">.</span>swift

Swift <span style="color: #993399">0.9</span> swift<span style="color: #990000">-</span><span style="color: #008080">r2860</span> cog<span style="color: #990000">-</span>r2388

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg
Progress<span style="color: #990000">:</span>
Progress<span style="color: #990000">:</span>  <span style="color: #008080">Stage</span> in<span style="color: #990000">:</span><span style="color: #993399">1</span>  <span style="color: #008080">Finished</span> successfully<span style="color: #990000">:</span><span style="color: #993399">2</span>
<span style="color: #008080">Execution</span> failed<span style="color: #990000">:</span>
    Exception <span style="color: #008080">in</span> broken<span style="color: #990000">:</span>
Arguments<span style="color: #990000">:</span> <span style="color: #990000">[</span>process<span style="color: #990000">]</span>
Host<span style="color: #990000">:</span> localhost
Directory<span style="color: #990000">:</span> restart<span style="color: #990000">-</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg<span style="color: #990000">/</span>jobs<span style="color: #990000">/</span><span style="color: #993399">1</span><span style="color: #990000">/</span>broken<span style="color: #990000">-</span>1i6ufisj
stderr<span style="color: #990000">.</span>txt<span style="color: #990000">:</span>
stdout<span style="color: #990000">.</span>txt<span style="color: #990000">:</span></tt></pre></div></div>
<div class="paragraph"><p>From the output we can see that touch and the first echo completed, but
then broken failed and so swift did not attempt to execute the final echo.</p></div>
<div class="paragraph"><p>There will be a restart log with the same name as the RunID:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ ls <span style="color: #990000">*</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg<span style="color: #990000">*</span>rlog
restart<span style="color: #990000">-</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>rlog</tt></pre></div></div>
<div class="paragraph"><p>This restart log contains enough information for swift to know which
parts of the workflow were executed successfully.</p></div>
<div class="paragraph"><p>We can try to rerun it immediately, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ swift <span style="color: #990000">-</span><span style="color: #008080">resume</span> restart<span style="color: #990000">-</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span><span style="color: #008080">rlog</span> restart<span style="color: #990000">.</span>swift

Swift <span style="color: #993399">0.9</span> swift<span style="color: #990000">-</span><span style="color: #008080">r2860</span> cog<span style="color: #990000">-</span>r2388

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1125</span><span style="color: #990000">-</span>7yx0zi6d
Progress<span style="color: #990000">:</span>
<span style="color: #008080">Execution</span> failed<span style="color: #990000">:</span>
    Exception <span style="color: #008080">in</span> broken<span style="color: #990000">:</span>
Arguments<span style="color: #990000">:</span> <span style="color: #990000">[</span>process<span style="color: #990000">]</span>
Host<span style="color: #990000">:</span> localhost
Directory<span style="color: #990000">:</span> restart<span style="color: #990000">-</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1125</span><span style="color: #990000">-</span>7yx0zi6d<span style="color: #990000">/</span>jobs<span style="color: #990000">/</span>m<span style="color: #990000">/</span>broken<span style="color: #990000">-</span>msn1gisj
stderr<span style="color: #990000">.</span>txt<span style="color: #990000">:</span>
stdout<span style="color: #990000">.</span>txt<span style="color: #990000">:</span>

<span style="color: #990000">----</span>

<span style="color: #008080">Caused</span> by<span style="color: #990000">:</span>
    Exit code <span style="color: #993399">1</span></tt></pre></div></div>
<div class="paragraph"><p>Swift tried to resume the workflow by executing "broken" again. It did
not try to run the touch or first echo jobs, because the restart log
says that they do not need to be executed again.</p></div>
<div class="paragraph"><p>Broken failed again, leaving the original restart log in place.</p></div>
<div class="paragraph"><p>Now we will fix the problem with "broken" by restoring the original
tc.data line that works.</p></div>
<div class="paragraph"><p>Remove the existing "broken" line and replace it with the successful
tc.data entry above:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">localhost</span>       broken          <span style="color: #990000">/</span>bin<span style="color: #990000">/</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span>   <span style="color: #008080">INSTALLED</span>       INTEL32<span style="color: #990000">::</span>LINUX  <span style="font-weight: bold"><span style="color: #0000FF">null</span></span></tt></pre></div></div>
<div class="paragraph"><p>Now run again:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ swift <span style="color: #990000">-</span><span style="color: #008080">resume</span> restart<span style="color: #990000">-</span><span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1121</span><span style="color: #990000">-</span>tssdcljg<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span><span style="color: #008080">rlog</span> restart<span style="color: #990000">.</span>swift

Swift <span style="color: #993399">0.9</span> swift<span style="color: #990000">-</span><span style="color: #008080">r2860</span> cog<span style="color: #990000">-</span>r2388

RunID<span style="color: #990000">:</span> <span style="color: #993399">20100526</span><span style="color: #990000">-</span><span style="color: #993399">1128</span><span style="color: #990000">-</span>a2gfuxhg
Progress<span style="color: #990000">:</span>
<span style="color: #008080">Final</span> status<span style="color: #990000">:</span>  Initializing<span style="color: #990000">:</span><span style="color: #993399">2</span>  <span style="color: #008080">Finished</span> successfully<span style="color: #990000">:</span><span style="color: #993399">2</span></tt></pre></div></div>
<div class="paragraph"><p>Swift tries to run "broken" again. This time it works, and so Swift
continues on to execute the final piece of the workflow as if nothing
had ever gone wrong.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bits">6. bits</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_named_and_optional_parameters">6.1. Named and optional parameters</h3>
<div class="paragraph"><p>anchor:named_parameters
In addition to specifying parameters positionally, parameters can be
named, and if desired a default value can be specified:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span> <span style="color: #990000">(</span><span style="color: #008080">string</span> s<span style="color: #990000">=</span><span style="color: #FF0000">"hello"</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        echo <span style="color: #008080">s</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>When we invoke the procedure, we can specify values for the parameters
by name. The following code can be found in q21.swift.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>french <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span>s<span style="color: #990000">=</span><span style="color: #FF0000">"bonjour"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>or we can let the default value apply:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>english <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">();</span></tt></pre></div></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-05-16 14:03:54 CDT
</div>
</div>
</body>
</html>
