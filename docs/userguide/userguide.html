<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.4" />
<title>Swift User Guide</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Swift User Guide</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>This manual provides reference material for Swift: the SwiftScript
language and the Swift runtime system. For introductory material,
consult the Swift tutorial
<a href="http://www.ci.uchicago.edu/swift/guides/tutorial.php">http://www.ci.uchicago.edu/swift/guides/tutorial.php</a>.</p></div>
<div class="paragraph"><p>Swift is a data-oriented coarse grained scripting language that supports
dataset typing and mapping, dataset iteration, conditional branching,
and procedural composition.</p></div>
<div class="paragraph"><p>Swift programs (or workflows) are written in a language called
SwiftScript.</p></div>
<div class="paragraph"><p>SwiftScript programs are dataflow oriented - they are primarily
concerned with processing (possibly large) collections of data files, by
invoking programs to do that processing. Swift handles execution of such
programs on remote sites by choosing sites, handling the staging of
input and output files to and from the chosen sites and remote execution
of program code.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_the_swiftscript_language">2. The SwiftScript Language</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_language_basics">2.1. Language basics</h3>
<div class="paragraph"><p>A Swift script describes data, application components, invocations of
applications components, and the inter-relations (data flow) between
those invocations.</p></div>
<div class="paragraph"><p>Data is represented in a script by strongly-typed single-assignment
variables. The syntax superficially resembles C and Java. For example,
{ and } characters are used to enclose blocks of statements.</p></div>
<div class="paragraph"><p>Types in Swift can be atomic or composite. An atomic type can be
either a primitive type or a mapped type. Swift provides a fixed set
of primitive types, such as integer and string. A mapped type
indicates that the actual data does not reside in CPU addressable memory
(as it would in conventional programming languages), but in POSIX-like
files. Composite types are further subdivided into structures and
arrays. Structures are similar in most respects to structure types in
other languages. Arrays use numeric indices, but are sparse. They can
contain elements of any type, including other array types, but all
elements in an array must be of the same type. We often refer to
instances of composites of mapped types as datasets.</p></div>
<div class="paragraph"><p><span class="image">
<img src="type-hierarchy.png" alt="type-hierarchy.png" />
</span></p></div>
<div class="paragraph"><p>Mapped type and composite type variable declarations can be annotated
with a mapping descriptor indicating the file(s) that make up that
dataset. For example, the following line declares a variable named
photo with type image. It additionally declares that the data for
this variable is stored in a single file named shane.jpeg.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">image</span> photo <span style="color: #990000">&lt;</span><span style="color: #FF0000">"shane.jpeg"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>Component programs of scripts are declared in an app declaration, with
the description of the command line syntax for that program and a list
of input and output data. An app block describes a functional/dataflow
style interface to imperative components.</p></div>
<div class="paragraph"><p>For example, the following example lists a procedure which makes use of
the ImageMagick <a href="http://www.imagemagick.org/">http://www.imagemagick.org/</a> convert command to
rotate a supplied image by a specified angle:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">image</span> output<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span><span style="color: #008080">image</span> input<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  convert <span style="color: #FF0000">"-rotate"</span> angle @input @output<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>A procedure is invoked using the familiar syntax:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rotated <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span>photo<span style="color: #990000">,</span> <span style="color: #993399">180</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>While this looks like an assignment, the actual unix level execution
consists of invoking the command line specified in the app
declaration, with variables on the left of the assignment bound to the
output parameters, and variables to the right of the procedure
invocation passed as inputs.</p></div>
<div class="paragraph"><p>The examples above have used the type image without any definition of
that type. We can declare it as a marker type which has no structure
exposed to SwiftScript:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> image<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>This does not indicate that the data is unstructured; but it indicates
that the structure of the data is not exposed to SwiftScript. Instead,
SwiftScript will treat variables of this type as individual opaque files.</p></div>
<div class="paragraph"><p>With mechanisms to declare types, map variables to data files, and
declare and invoke procedures, we can build a complete (albeit simple)
script:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> image<span style="color: #990000">;</span>
<span style="color: #008080">image</span> photo <span style="color: #990000">&lt;</span><span style="color: #FF0000">"shane.jpeg"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">image</span> rotated <span style="color: #990000">&lt;</span><span style="color: #FF0000">"rotated.jpeg"</span><span style="color: #990000">&gt;;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">image</span> output<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span><span style="color: #008080">image</span> input<span style="color: #990000">,</span> <span style="color: #009900">int</span> angle<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
   convert <span style="color: #FF0000">"-rotate"</span> angle @input @output<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

rotated <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span>photo<span style="color: #990000">,</span> <span style="color: #993399">180</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This script can be invoked from the command line:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>  $ ls *.jpeg
  shane.jpeg
  $ swift example.swift
  ...
  $ ls *.jpeg
  shane.jpeg rotated.jpeg</tt></pre></div></div>
<div class="paragraph"><p>This executes a single convert command, hiding from the user features
such as remote multisite execution and fault tolerance that will be
discussed in a later section.</p></div>
<div class="paragraph"><div class="title">Figure 1. shane.jpeg</div><p><span class="image">
<img src="userguide-shane.jpeg" alt="userguide-shane.jpeg" />
</span></p></div>
<div class="paragraph"><div class="title">Figure 2. rotated.jpeg</div><p><span class="image">
<img src="userguide-rotated.jpeg" alt="userguide-rotated.jpeg" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_arrays_and_parallel_execution">2.2. Arrays and Parallel Execution</h3>
<div class="paragraph"><p>Arrays of values can be declared using the [] suffix. An array be
mapped to a collection of files, one element per file, by using a
different form of mapping expression. For example, the filesys_mapper
maps all files matching a particular unix glob pattern into an array:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> frames<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>filesys_mapper<span style="color: #990000">;</span> pattern<span style="color: #990000">=</span><span style="color: #FF0000">"*.jpeg"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The foreach construct can be used to apply the same block of code to
each element of an array:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">foreach</span> f<span style="color: #990000">,</span>ix <span style="color: #008080">in</span> frames <span style="color: #FF0000">{</span>
  output<span style="color: #990000">[</span>ix<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span>frames<span style="color: #990000">,</span> <span style="color: #993399">180</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Sequential iteration can be expressed using the iterate construct:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>step<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">initialCondition</span></span><span style="color: #990000">();</span>
<span style="color: #008080">iterate</span> ix <span style="color: #FF0000">{</span>
  step<span style="color: #990000">[</span>ix<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">simulate</span></span><span style="color: #990000">(</span>step<span style="color: #990000">[</span>ix<span style="color: #990000">-</span><span style="color: #993399">1</span><span style="color: #990000">]);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>This fragment will initialise the 0-th element of the step array to
some initial condition, and then repeatedly run the simulate
procedure, using each execution&#8217;s outputs as input to the next step.</p></div>
</div>
<div class="sect2">
<h3 id="_ordering_of_execution">2.3. Ordering of execution</h3>
<div class="paragraph"><p>Non-array variables are single-assignment, which means that they must
be assigned to exactly one value during execution. A procedure or
expression will be executed when all of its input parameters have been
assigned values. As a result of such execution, more variables may
become assigned, possibly allowing further parts of the script to execute.</p></div>
<div class="paragraph"><p>In this way, scripts are implicitly parallel. Aside from serialisation
implied by these dataflow dependencies, execution of component programs
can proceed in parallel.</p></div>
<div class="paragraph"><p>In this fragment, execution of procedures p and q can happen in
parallel:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>y<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span>
z<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #000000">q</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>while in this fragment, execution is serialised by the variable y,
with procedure p executing before q.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>y<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span>
z<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #000000">q</span></span><span style="color: #990000">(</span>y<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Arrays in SwiftScript are more monotonic - a generalisation of being
assignment. Knowledge about the content of an array increases during
execution, but cannot otherwise change. Each element of the array is
itself single assignment or monotonic (depending on its type). During a
run all values for an array are eventually known, and that array is
regarded as closed.</p></div>
<div class="paragraph"><p>Statements which deal with the array as a whole will often wait for the
array to be closed before executing (thus, a closed array is the
equivalent of a non-array type being assigned). However, a foreach
statement will apply its body to elements of an array as they become
known. It will not wait until the array is closed.</p></div>
<div class="paragraph"><p>Consider this script:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> a<span style="color: #990000">[];</span>
<span style="color: #008080">file</span> b<span style="color: #990000">[];</span>
<span style="color: #008080">foreach</span> v<span style="color: #990000">,</span>i <span style="color: #008080">in</span> a <span style="color: #FF0000">{</span>
  b<span style="color: #990000">[</span>i<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">(</span>v<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>
a<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">r</span></span><span style="color: #990000">();</span>
a<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">s</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><p>Initially, the foreach statement will have nothing to execute, as the
array a has not been assigned any values. The procedures r and s
will execute. As soon as either of them is finished, the corresponding
invocation of procedure p will occur. After both r and s have
completed, the array a will be closed since no other statements in the
script make an assignment to a.</p></div>
</div>
<div class="sect2">
<h3 id="_compound_procedures">2.4. Compound procedures</h3>
<div class="paragraph"><p>As with many other programming languages, procedures consisting of
SwiftScript code can be defined. These differ from the previously
mentioned procedures declared with the app keyword, as they invoke
other SwiftScript procedures rather than a component program.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">file</span> output<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">process</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> input<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="color: #008080">file</span> intermediate<span style="color: #990000">;</span>
  intermediate <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">first</span></span><span style="color: #990000">(</span>input<span style="color: #990000">);</span>
  output <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">second</span></span><span style="color: #990000">(</span>intermediate<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">file</span> x <span style="color: #990000">&lt;</span><span style="color: #FF0000">"x.txt"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">file</span> y <span style="color: #990000">&lt;</span><span style="color: #FF0000">"y.txt"</span><span style="color: #990000">&gt;;</span>
y <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">process</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This will invoke two procedures, with an intermediate data file named
anonymously connecting the first and second procedures.</p></div>
<div class="paragraph"><p>Ordering of execution is generally determined by execution of app
procedures, not by any containing compound procedures. In this code block:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">file</span> a<span style="color: #990000">,</span> <span style="color: #008080">file</span> b<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">A</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
  a <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">A1</span></span><span style="color: #990000">();</span>
  b <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">A2</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>
<span style="color: #008080">file</span> x<span style="color: #990000">,</span> y<span style="color: #990000">,</span> s<span style="color: #990000">,</span> t<span style="color: #990000">;</span>
<span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">)</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">A</span></span><span style="color: #990000">();</span>
s <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">S</span></span><span style="color: #990000">(</span>x<span style="color: #990000">);</span>
t <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">S</span></span><span style="color: #990000">(</span>y<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>then a valid execution order is: A1 S(x) A2 S(y). The compound
procedure A does not have to have fully completed for its return
values to be used by subsequent statements.</p></div>
</div>
<div class="sect2">
<h3 id="_more_about_types">2.5. More about types</h3>
<div class="paragraph"><p>Each variable and procedure parameter in SwiftScript is strongly typed.
Types are used to structure data, to aid in debugging and checking
program correctness and to influence how Swift interacts with data.</p></div>
<div class="paragraph"><p>The image type declared in previous examples is a marker type.
Marker types indicate that data for a variable is stored in a single
file with no further structure exposed at the SwiftScript level.</p></div>
<div class="paragraph"><p>Arrays have been mentioned above, in the arrays section. A code block
may be applied to each element of an array using foreach; or
individual elements may be references using [] notation.</p></div>
<div class="paragraph"><p>There are a number of primitive types:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">type    </th>
<th align="left" valign="top">contains</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">int</p></td>
<td align="left" valign="top"><p class="table">integers</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">string</p></td>
<td align="left" valign="top"><p class="table">strings of text</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">float</p></td>
<td align="left" valign="top"><p class="table">floating point numbers, that behave the same as Java doubles</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">boolean</p></td>
<td align="left" valign="top"><p class="table">true/false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Complex types may be defined using the type keyword:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> headerfile<span style="color: #990000">;</span>
<span style="color: #008080">type</span> voxelfile<span style="color: #990000">;</span>
<span style="color: #008080">type</span> volume <span style="color: #FF0000">{</span>
  <span style="color: #008080">headerfile</span> h<span style="color: #990000">;</span>
  <span style="color: #008080">voxelfile</span> v<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Members of a complex type can be accessed using the . operator:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">volume</span> brain<span style="color: #990000">;</span>
o <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">(</span>brain<span style="color: #990000">.</span>h<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Sometimes data may be stored in a form that does not fit with Swift&#8217;s
file-and-site model; for example, data might be stored in an RDBMS on
some database server. In that case, a variable can be declared to have
external type. This indicates that Swift should use the variable to
determine execution dependency, but should not attempt other data
management; for example, it will not perform any form of data stage-in
or stage-out it will not manage local data caches on sites; and it will
not enforce component program atomicity on data output. This can add
substantial responsibility to component programs, in exchange for
allowing arbitrary data storage and access methods to be plugged in to
scripts.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">external</span> o<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">populateDatabase</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
  populationProgram<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> o<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">analyseDatabase</span></span><span style="color: #990000">(</span><span style="color: #008080">external</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  analysisProgram @o<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">external</span> database<span style="color: #990000">;</span>
<span style="color: #008080">file</span> result <span style="color: #990000">&lt;</span><span style="color: #FF0000">"results.txt"</span><span style="color: #990000">&gt;;</span>

database <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">populateDatabase</span></span><span style="color: #990000">();</span>
result <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">analyseDatabase</span></span><span style="color: #990000">(</span>database<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>Some external database is represented by the database variable. The
populateDatabase procedure populates the database with some data, and
the analyseDatabase procedure performs some subsequent analysis on
that database. The declaration of database contains no mapping; and
the procedures which use database do not reference them in any way;
the description of database is entirely outside of the script. The
single assignment and execution ordering rules will still apply though;
populateDatabase will always be run before analyseDatabase.</p></div>
</div>
<div class="sect2">
<h3 id="_data_model">2.6. Data model</h3>
<div class="paragraph"><p>Data processed by Swift is strongly typed. It may be take the form of
values in memory or as out-of-core files on disk. Language constructs
called mappers specify how each piece of data is stored.</p></div>
</div>
<div class="sect2">
<h3 id="_mappers">2.7. Mappers</h3>
<div class="paragraph"><p>When a DSHandle represents a data file (or container of datafiles), it
is associated with a mapper. The mapper is used to identify which files
belong to that DSHandle.</p></div>
<div class="paragraph"><p>A dataset&#8217;s physical representation is declared by a mapping descriptor,
which defines how each element in the dataset&#8217;s logical schema is stored
in, and fetched from, physical structures such as directories, files,
and remote servers.</p></div>
<div class="paragraph"><p>Mappers are parameterized to take into account properties such as
varying dataset location. In order to access a dataset, we need to know
three things: its type, its mapping, and the value(s) of any
parameter(s) associated with the mapping descriptor. For example, if we
want to describe a dataset, of type imagefile, and whose physical
representation is a file called "file1.bin" located at
"/home/yongzh/data/", then the dataset might be declared as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">imagefile</span> f1<span style="color: #990000">&lt;</span>single_file_mapper<span style="color: #990000">;</span>file<span style="color: #990000">=</span><span style="color: #FF0000">"/home/yongzh/data/file1.bin"</span><span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>The above example declares a dataset called f1, which uses a single file
mapper to map a file from a specific location.</p></div>
<div class="paragraph"><p>SwiftScript has a simplified syntax for this case, since
single_file_mapper is frequently used:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">binaryfile</span> f1<span style="color: #990000">&lt;</span><span style="color: #FF0000">"/home/yongzh/data/file1.bin"</span><span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="paragraph"><p>Swift comes with a number of mappers that handle common mapping
patterns. These are documented in the mappers section of this
guide.</p></div>
</div>
<div class="sect2">
<h3 id="_more_technical_details_about_swiftscript">2.8. More technical details about SwiftScript</h3>
<div class="paragraph"><p>The syntax of SwiftScript has a superficial resemblance to C and Java.
For example, { and } characters are used to enclose blocks of statements.</p></div>
<div class="paragraph"><p>A SwiftScript program consists of a number of statements. Statements may
declare types, procedures and variables, assign values to variables, and
express operations over arrays.</p></div>
<div class="sect3">
<h4 id="_variables">2.8.1. Variables</h4>
<div class="paragraph"><p>Variables in SwiftScript are declared to be of a specific type.
Assignments to those variables must be data of that type. SwiftScript
variables are single-assignment - a value may be assigned to a variable
at most once. This assignment can happen at declaration time or later on
in execution. When an attempt to read from a variable that has not yet
been assigned is made, the code performing the read is suspended until
that variable has been written to. This forms the basis for Swift&#8217;s
ability to parallelise execution - all code will execute in parallel
unless there are variables shared between the code that cause sequencing.</p></div>
</div>
<div class="sect3">
<h4 id="_variable_declarations">2.8.2. Variable Declarations</h4>
<div class="paragraph"><p>Variable declaration statements declare new variables. They can
optionally assign a value to them or map those variables to on-disk files.</p></div>
<div class="paragraph"><p>Declaration statements have the general form:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">typename</span> <span style="font-weight: bold"><span style="color: #000000">variablename</span></span> <span style="color: #990000">(&lt;</span>mapping<span style="color: #990000">&gt;</span> <span style="color: #990000">|</span> <span style="color: #990000">=</span> initialValue <span style="color: #990000">)</span> <span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>The format of the mapping expression is defined in the Mappers section.
initialValue may be either an expression or a procedure call that
returns a single value.</p></div>
<div class="paragraph"><p>Variables can also be declared in a multivalued-procedure statement,
described in another section.</p></div>
</div>
<div class="sect3">
<h4 id="_assignment_statements">2.8.3. Assignment Statements</h4>
<div class="paragraph"><p>Assignment statements assign values to previously declared variables.
Assignments may only be made to variables that have not already been
assigned. Assignment statements have the general form:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>variable <span style="color: #990000">=</span> value<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>where value can be either an expression or a procedure call that returns
a single value.</p></div>
<div class="paragraph"><p>Variables can also be assigned in a multivalued-procedure statement,
described in another section.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_procedures">2.9. Procedures</h3>
<div class="paragraph"><p>There are two kinds of procedure: An atomic procedure, which describes
how an external program can be executed; and compound procedures which
consist of a sequence of SwiftScript statements.</p></div>
<div class="paragraph"><p>A procedure declaration defines the name of a procedure and its input
and output parameters. SwiftScript procedures can take multiple inputs
and produce multiple outputs. Inputs are specified to the right of the
function name, and outputs are specified to the left. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">type3</span> out1<span style="color: #990000">,</span> <span style="color: #008080">type4</span> out2<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">myproc</span></span> <span style="color: #990000">(</span><span style="color: #008080">type1</span> in1<span style="color: #990000">,</span> <span style="color: #008080">type2</span> in2<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The above example declares a procedure called myproc, which has two
inputs in1 (of type type1) and in2 (of type type2) and two
outputs out1 (of type type3) and out2 (of type type4).</p></div>
<div class="paragraph"><p>A procedure input parameter can be an optional parameter in which case
it must be declared with a default value. When calling a procedure, both
positional parameter and named parameter passings can be passed,
provided that all optional parameters are declared after the required
parameters and any optional parameter is bound using keyword parameter
passing. For example, if myproc1 is defined as:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">binaryfile</span> bf<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">myproc1</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #008080">string</span> s<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Then that procedure can be called like this, omitting the optional</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">parameter</span> s<span style="color: #990000">:</span>
<span style="color: #008080">binaryfile</span> mybf <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">myproc1</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>or like this supplying a value for the optional parameter s:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">binaryfile</span> mybf <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">myproc1</span></span> <span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> s<span style="color: #990000">=</span><span style="color: #FF0000">"bar"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="sect3">
<h4 id="_atomic_procedures">2.9.1. Atomic procedures</h4>
<div class="paragraph"><p>An atomic procedure specifies how to invoke an external executable
program, and how logical data types are mapped to command line arguments.</p></div>
<div class="paragraph"><p>Atomic procedures are defined with the app keyword:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">binaryfile</span> bf<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">myproc</span></span> <span style="color: #990000">(</span><span style="color: #009900">int</span> i<span style="color: #990000">,</span> <span style="color: #008080">string</span> s<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    myapp <span style="color: #008080">i</span> s @<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>bf<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>which specifies that myproc invokes an executable called myapp,
passing the values of i, s and the filename of bf as command line
arguments.</p></div>
</div>
<div class="sect3">
<h4 id="_compound_procedures_2">2.9.2. Compound procedures</h4>
<div class="paragraph"><p>A compound procedure contains a set of SwiftScript statements:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">(</span><span style="color: #008080">type2</span> b<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">foo_bar</span></span> <span style="color: #990000">(</span><span style="color: #008080">type1</span> a<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">type3</span> c<span style="color: #990000">;</span>
    c <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">foo</span></span><span style="color: #990000">(</span>a<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">// c holds the result of foo</span></span>
    b <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">bar</span></span><span style="color: #990000">(</span>c<span style="color: #990000">);</span>    <span style="font-style: italic"><span style="color: #9A1900">// c is an input to bar</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_control_constructs">2.10. Control Constructs</h3>
<div class="paragraph"><p>SwiftScript provides if, switch, foreach, and iterate
constructs, with syntax and semantics similar to comparable constructs
in other high-level languages.</p></div>
<div class="sect3">
<h4 id="_foreach">2.10.1. foreach</h4>
<div class="paragraph"><p>The foreach construct is used to apply a block of statements to each
element in an array. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">check_order</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> a<span style="color: #990000">[])</span> <span style="color: #FF0000">{</span>
    foreach f <span style="color: #008080">in</span> a <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">compute</span></span><span style="color: #990000">(</span>f<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>foreach statements have the general form:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">foreach</span> <span style="font-weight: bold"><span style="color: #000000">controlvariable</span></span> <span style="color: #990000">(,</span>index<span style="color: #990000">)</span> <span style="color: #008080">in</span> expression <span style="color: #FF0000">{</span>
    statements
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The block of statements is evaluated once for each element in
expression which must be an array, with controlvariable set to the
corresponding element and index (if specified) set to the integer
position in the array that is being iterated over.</p></div>
</div>
<div class="sect3">
<h4 id="_if">2.10.2. if</h4>
<div class="paragraph"><p>The if statement allows one of two blocks of statements to be
executed, based on a boolean predicate. if statements generally have
the form:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span>predicate<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    statements
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>
    statements
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>where predicate is a boolean expression.</p></div>
</div>
<div class="sect3">
<h4 id="_switch">2.10.3. switch</h4>
<div class="paragraph"><p>switch expressions allow one of a selection of blocks to be chosen
based on the value of a numerical control expression. switch
statements take the general form:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">switch</span></span><span style="color: #990000">(</span>controlExpression<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> n1<span style="color: #990000">:</span>
        statements2
    <span style="font-weight: bold"><span style="color: #0000FF">case</span></span> n2<span style="color: #990000">:</span>
        statements2
    <span style="color: #990000">[...]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">default</span></span><span style="color: #990000">:</span>
        statements
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The control expression is evaluated, the resulting numerical value used
to select a corresponding case, and the statements belonging to that
case block are evaluated. If no case corresponds, then the statements
belonging to the default block are evaluated.</p></div>
<div class="paragraph"><p>Unlike C or Java switch statements, execution does not fall through to
subsequent case blocks, and no break statement is necessary at the
end of each block.</p></div>
</div>
<div class="sect3">
<h4 id="_iterate">2.10.4. iterate</h4>
<div class="paragraph"><p>iterate expressions allow a block of code to be evaluated repeatedly,
with an integer parameter sweeping upwards from 0 until a termination
condition holds.</p></div>
<div class="paragraph"><p>The general form is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">iterate</span> var <span style="color: #FF0000">{</span>
    statements<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #000000">until</span></span> <span style="color: #990000">(</span>terminationExpression<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>with the variable var starting at 0 and increasing by one in each
iteration. That variable is in scope in the statements block and when
evaluating the termination expression.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_operators">2.11. Operators</h3>
<div class="paragraph"><p>The following infix operators are available for use in SwiftScript
expressions.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">operator</th>
<th align="left" valign="top">purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">+</p></td>
<td align="left" valign="top"><p class="table">numeric addition; string concatenation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">-</p></td>
<td align="left" valign="top"><p class="table">numeric subtraction</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">*</p></td>
<td align="left" valign="top"><p class="table">numeric multiplication</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">/</p></td>
<td align="left" valign="top"><p class="table">floating point division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%/</p></td>
<td align="left" valign="top"><p class="table">integer division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">%%</p></td>
<td align="left" valign="top"><p class="table">integer remainder of division</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">== !=</p></td>
<td align="left" valign="top"><p class="table">comparison and not-equal-to</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&lt; &gt; &#8656; &gt;=</p></td>
<td align="left" valign="top"><p class="table">numerical ordering</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&amp;&amp; ||</p></td>
<td align="left" valign="top"><p class="table">boolean and, or</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">!</p></td>
<td align="left" valign="top"><p class="table">boolean not</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_global_constants">2.12. Global constants</h3>
<div class="paragraph"><p>At the top level of a SwiftScript program, the global modified may be
added to a declaration so that it is visible throughout the program,
rather than only at the top level of the program. This allows global
constants (of any type) to be defined. (since Swift 0.10)</p></div>
</div>
<div class="sect2">
<h3 id="_imports">2.13. Imports</h3>
<div class="paragraph"><p>The import directive can be used to import definitions from another
SwiftScript file. (since Swift 0.10)</p></div>
<div class="paragraph"><p>For example, a SwiftScript program might contain this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> defs<span style="color: #990000">;</span>
<span style="color: #008080">file</span> f<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>which would import the content of defs.swift in the current directory:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span></tt></pre></div></div>
<div class="paragraph"><p>Imported files are read from the current working directory.</p></div>
<div class="paragraph"><p>There is no requirement that a module is imported only once. If a module
is imported multiple times, for example in different files, then Swift
will only process the imports once.</p></div>
<div class="paragraph"><p>Imports may contain anything that is valid in a SwiftScript program,
including code that causes remote execution.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mappers_2">3. Mappers</h2>
<div class="sectionbody">
<div class="paragraph"><p>Mappers provide a mechanism to specify the layout of mapped datasets on
disk. This is needed when Swift must access files to transfer them to
remote sites for execution or to pass to applications.</p></div>
<div class="paragraph"><p>Swift provides a number of mappers that are useful in common cases. This
section details those standard mappers. For more complex cases, it is
possible to write application-specific mappers in Java and use them
within a SwiftScript program.</p></div>
<div class="sect2">
<h3 id="_the_single_file_mapper">3.1. The single file mapper</h3>
<div class="paragraph"><p>The single_file_mapper maps a single physical file to a dataset.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">myfile</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f[0]</p></td>
<td align="left" valign="top"><p class="table">INVALID</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f.bar</p></td>
<td align="left" valign="top"><p class="table">INVALID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">file</p></td>
<td align="left" valign="top"><p class="table">The location of the physical file including path and file name.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> f <span style="color: #990000">&lt;</span>single_file_mapper<span style="color: #990000">;</span>file<span style="color: #990000">=</span><span style="color: #FF0000">"plot_outfile_param"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>There is a simplified syntax for this mapper:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> f <span style="color: #990000">&lt;</span><span style="color: #FF0000">"plot_outfile_param"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_the_simple_mapper">3.2. The simple mapper</h3>
<div class="paragraph"><p>The simple_mapper maps a file or a list of files into an array by
prefix, suffix, and pattern. If more than one file is matched, each of
the file names will be mapped as a subelement of the dataset.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">A directory that the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pattern</p></td>
<td align="left" valign="top"><p class="table">A UNIX glob style pattern, for instance: "<strong>foo</strong>" would match
all file names that contain foo. When this mapper is used to specify
output filenames, pattern is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>
<span style="color: #008080">file</span> f <span style="color: #990000">&lt;</span>simple_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">,</span> suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The above maps all filenames that start with foo and have an extension
.txt into file f.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">foo.txt</p></td>
</tr>
</tbody>
</table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #008080">string</span> m<span style="color: #990000">)</span> <span style="color: #FF0000">{</span><span style="color: #990000">.</span>
    app <span style="color: #FF0000">{</span>
        echo <span style="color: #008080">m</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile <span style="color: #990000">&lt;</span>simple_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">,</span>suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span>

outfile <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hi"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This will output the string <em>hi</em> to the file foo.txt.</p></div>
<div class="paragraph"><p>The simple_mapper can be used to map arrays. It will map the array
index into the filename between the prefix and suffix.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #008080">string</span> m<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        echo <span style="color: #008080">m</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">messagefile</span> outfile<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>simple_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"baz"</span><span style="color: #990000">,</span>suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span>

outfile<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hello"</span><span style="color: #990000">);</span>
outfile<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"middle"</span><span style="color: #990000">);</span>
outfile<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"goodbye"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">outfile[0]</p></td>
<td align="left" valign="top"><p class="table">baz0000.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">outfile[1]</p></td>
<td align="left" valign="top"><p class="table">baz0001.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">outfile[2]</p></td>
<td align="left" valign="top"><p class="table">baz0002.txt</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>simple_mapper can be used to map structures. It will map the name of
the structure member into the filename, between the prefix and the suffix.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> messagefile<span style="color: #990000">;</span>

<span style="color: #008080">type</span> mystruct <span style="color: #FF0000">{</span>
  <span style="color: #008080">messagefile</span> left<span style="color: #990000">;</span>
  <span style="color: #008080">messagefile</span> right<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="color: #990000">(</span><span style="color: #008080">messagefile</span> t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #008080">string</span> m<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        echo <span style="color: #008080">m</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>t<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">mystruct</span> out <span style="color: #990000">&lt;</span>simple_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"qux"</span><span style="color: #990000">,</span>suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span>

out<span style="color: #990000">.</span>left <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"hello"</span><span style="color: #990000">);</span>
out<span style="color: #990000">.</span>right <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">greeting</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"goodbye"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>This will output the string "hello" into the file qux.left.txt and the
string "goodbye" into the file qux.right.txt.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">out.left</p></td>
<td align="left" valign="top"><p class="table">quxleft.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">out.right</p></td>
<td align="left" valign="top"><p class="table">quxright.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_concurrent_mapper">3.3. concurrent mapper</h3>
<div class="paragraph"><p>concurrent_mapper is almost the same as the simple mapper, except that
it is used to map an output file, and the filename generated will
contain an extract sequence that is unique. This mapper is the default
mapper for variables when no mapper is specified.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">A directory that the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"
pattern A UNIX glob style pattern, for instance: "<strong>foo</strong>" would match
all file names that contain foo. When this mapper is used to specify
output filenames, pattern is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> f1<span style="color: #990000">;</span>
<span style="color: #008080">file</span> f2 <span style="color: #990000">&lt;</span>concurrent_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">,</span> suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The above example would use concurrent mapper for f1 and f2, and
generate f2 filename with prefix "foo" and extension ".txt"</p></div>
</div>
<div class="sect2">
<h3 id="_file_system_mapper">3.4. File system mapper</h3>
<div class="paragraph"><p>filesys_mapper is similar to the simple mapper, but maps a file or a
list of files to an array. Each of the filename is mapped as an element
in the array. The order of files in the resulting array is not defined.</p></div>
<div class="paragraph"><p>TODO: note on difference between location as a relative vs absolute path
wrt staging to remote location - as mihael said: It&#8217;s because you
specify that location in the mapper. Try location="." instead of
location="/sandbox/&#8230;"</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">location</p></td>
<td align="left" valign="top"><p class="table">The directory where the files are located.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">prefix</p></td>
<td align="left" valign="top"><p class="table">The prefix of the files</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">suffix</p></td>
<td align="left" valign="top"><p class="table">The suffix of the files, for instance: ".txt"</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">pattern</p></td>
<td align="left" valign="top"><p class="table">A UNIX glob style pattern, for instance: "<strong>foo</strong>" would match
all file names that contain foo.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> texts<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>filesys_mapper<span style="color: #990000">;</span>prefix<span style="color: #990000">=</span><span style="color: #FF0000">"foo"</span><span style="color: #990000">,</span> suffix<span style="color: #990000">=</span><span style="color: #FF0000">".txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The above example would map all filenames that start with "foo" and
have an extension ".txt" into the array texts. For example, if the
specified directory contains files: foo1.txt, footest.txt,
foo__1.txt, then the mapping might be:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">texts[0]</p></td>
<td align="left" valign="top"><p class="table">footest.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[1]</p></td>
<td align="left" valign="top"><p class="table">foo1.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[2]</p></td>
<td align="left" valign="top"><p class="table">foo__1.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fixed_array_mapper">3.5. fixed array mapper</h3>
<div class="paragraph"><p>The fixed_array_mapper maps from a string that contains a list of
filenames into a file array.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">files</p></td>
<td align="left" valign="top"><p class="table">A string that contains a list of filenames, separated by space,
comma or colon</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">file</span> texts<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>fixed_array_mapper<span style="color: #990000">;</span>files<span style="color: #990000">=</span><span style="color: #FF0000">"file1.txt, fileB.txt, file3.txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>would cause a mapping like this:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">texts[0]</p></td>
<td align="left" valign="top"><p class="table">file1.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[1]</p></td>
<td align="left" valign="top"><p class="table">fileB.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">texts[2]</p></td>
<td align="left" valign="top"><p class="table">file3.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_array_mapper">3.6. array mapper</h3>
<div class="paragraph"><p>The array_mapper maps from an array of strings into a file</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">files</p></td>
<td align="left" valign="top"><p class="table">An array of strings containing one filename per element</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">string</span> s<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #990000">[</span> <span style="color: #FF0000">"a.txt"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"b.txt"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"c.txt"</span> <span style="color: #990000">];</span>

<span style="color: #008080">file</span> f<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>array_mapper<span style="color: #990000">;</span>files<span style="color: #990000">=</span>s<span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>This will establish the mapping:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f[0]</p></td>
<td align="left" valign="top"><p class="table">a.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f[1]</p></td>
<td align="left" valign="top"><p class="table">b.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">f[2]</p></td>
<td align="left" valign="top"><p class="table">c.txt</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_regular_expression_mapper">3.7. regular expression mapper</h3>
<div class="paragraph"><p>The regexp_mapper transforms one file name to another using regular
expression matching.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">parameter</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">source</p></td>
<td align="left" valign="top"><p class="table">The source file name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">match</p></td>
<td align="left" valign="top"><p class="table">Regular expression pattern to match, use</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">()</p></td>
<td align="left" valign="top"><p class="table">to match whatever
regular expression is inside the parentheses, and indicate the start and
end of a group; the contents of a group can be retrieved with the</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">\\number</p></td>
<td align="left" valign="top"><p class="table">special sequence (two backslashes are needed because the
backslash is an escape sequence introducer)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">transform</p></td>
<td align="left" valign="top"><p class="table">The pattern of the file name to transform to, use \number to
reference the group matched.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">string</span> s <span style="color: #990000">=</span> <span style="color: #FF0000">"picture.gif"</span><span style="color: #990000">;</span>
<span style="color: #008080">file</span> f <span style="color: #990000">&lt;</span>regexp_mapper<span style="color: #990000">;</span>
  source<span style="color: #990000">=</span>s<span style="color: #990000">,</span>
  match<span style="color: #990000">=</span><span style="color: #FF0000">"(.*)gif"</span><span style="color: #990000">,</span>
  transform<span style="color: #990000">=</span><span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">1jpg"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>This example transforms a string ending gif into one ending jpg and
maps that to a file.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">f</p></td>
<td align="left" valign="top"><p class="table">picture.jpg</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_csv_mapper">3.8. csv mapper</h3>
<div class="paragraph"><p>The csv_mapper maps the content of a CSV (comma-separated value) file
into an array of structures. The dataset type needs to be correctly
defined to conform to the column names in the file. For instance, if the
file contains columns: name age GPA then the type needs to have member
elements like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> student <span style="color: #FF0000">{</span>
  <span style="color: #008080">file</span> name<span style="color: #990000">;</span>
  <span style="color: #008080">file</span> age<span style="color: #990000">;</span>
  <span style="color: #008080">file</span> GPA<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>If the file does not contain a header with column info, then the column
names are assumed as column1, column2, etc.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Parameter</th>
<th align="left" valign="top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">file</p></td>
<td align="left" valign="top"><p class="table">The name of the CSV file to read mappings from.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">header</p></td>
<td align="left" valign="top"><p class="table">Whether the file has a line describing header info; default is</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">true</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">skip</p></td>
<td align="left" valign="top"><p class="table">The number of lines to skip at the beginning (after header line);
default is 0.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">hdelim</p></td>
<td align="left" valign="top"><p class="table">Header field delimiter; default is the value of the</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">delim</p></td>
<td align="left" valign="top"><p class="table">parameter</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">delim</p></td>
<td align="left" valign="top"><p class="table">Content field delimiters; defaults are space, tab and comma</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">student</span> stus<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>csv_mapper<span style="color: #990000">;</span>file<span style="color: #990000">=</span><span style="color: #FF0000">"stu_list.txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The above example would read a list of student info from file
"stu_list.txt" and map them into a student array. By default, the file
should contain a header line specifying the names of the columns. If
stu_list.txt contains the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>name<span style="color: #990000">,</span>age<span style="color: #990000">,</span>gpa
<span style="color: #993399">101</span><span style="color: #990000">-</span>name<span style="color: #990000">.</span>txt<span style="color: #990000">,</span> <span style="color: #993399">101</span><span style="color: #990000">-</span>age<span style="color: #990000">.</span>txt<span style="color: #990000">,</span> <span style="color: #993399">101</span><span style="color: #990000">-</span>gpa<span style="color: #990000">.</span>txt
name55<span style="color: #990000">.</span>txt<span style="color: #990000">,</span> age55<span style="color: #990000">.</span>txt<span style="color: #990000">,</span> age55<span style="color: #990000">.</span>txt
q<span style="color: #990000">,</span> r<span style="color: #990000">,</span> s</tt></pre></div></div>
<div class="paragraph"><p>then some of the mappings produced by this example would be:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">stus[0].name</th>
<th align="left" valign="top">101-name.txt</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">stus[0].age</p></td>
<td align="left" valign="top"><p class="table">101-age.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[0].gpa</p></td>
<td align="left" valign="top"><p class="table">101-gpa.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].name</p></td>
<td align="left" valign="top"><p class="table">name55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].age</p></td>
<td align="left" valign="top"><p class="table">age55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1].gpa</p></td>
<td align="left" valign="top"><p class="table">gpa55.txt</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].name</p></td>
<td align="left" valign="top"><p class="table">q</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].age</p></td>
<td align="left" valign="top"><p class="table">r</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2].gpa</p></td>
<td align="left" valign="top"><p class="table">s</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_external_mapper">3.9. external mapper</h3>
<div class="paragraph"><p>The external mapper, ext maps based on the output of a supplied Unix
executable.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">parameter</p></td>
<td align="left" valign="top"><p class="table">meaning</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">exec</p></td>
<td align="left" valign="top"><p class="table">The name of the executable (relative to the current directory, if
an absolute path is not specified)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">*</p></td>
<td align="left" valign="top"><p class="table">Other parameters are passed to the executable prefixed with a - symbol</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The output of the executable should consist of two columns of data,
separated by a space. The first column should be the path of the mapped
variable, in SwiftScript syntax (for example [2] means the 2nd element
of an array) or the symbol $ to represent the root of the mapped
variable.</p></div>
<div class="paragraph"><p>Example: With the following in mapper.sh,</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/bash</span></span>
echo <span style="color: #FF0000">"[2] qux"</span>
echo <span style="color: #FF0000">"[0] foo"</span>
echo <span style="color: #FF0000">"[1] bar"</span></tt></pre></div></div>
<div class="paragraph"><p>then a mapping statement:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">student</span> stus<span style="color: #990000">[]</span> <span style="color: #990000">&lt;</span>ext<span style="color: #990000">;</span>exec<span style="color: #990000">=</span><span style="color: #FF0000">"mapper.sh"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>would map</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Swift variable</th>
<th align="left" valign="top">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">stus[0]</p></td>
<td align="left" valign="top"><p class="table">foo</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[1]</p></td>
<td align="left" valign="top"><p class="table">bar</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">stus[2]</p></td>
<td align="left" valign="top"><p class="table">qux</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commands">4. Commands</h2>
<div class="sectionbody">
<div class="paragraph"><p>The commands detailed in this section are available in the bin/
directory of a Swift installation and can by run from the commandline if
that directory is placed on the PATH.</p></div>
<div class="sect2">
<h3 id="_swift">4.1. swift</h3>
<div class="paragraph"><p>The swift command is the main command line tool for executing
SwiftScript programs.</p></div>
<div class="sect3">
<h4 id="_command_line_syntax">4.1.1. Command-line Syntax</h4>
<div class="paragraph"><p>The swift command is invoked as follows: swift [options]
SwiftScript-program [SwiftScript-arguments]* with options taken from the
following list, and SwiftScript-arguments made available to the
SwiftScript program through the @arg function.</p></div>
<div class="paragraph"><p>Swift command-line options</p></div>
<div class="paragraph"><p>-help or -h</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Display usage information</tt></pre>
</div></div>
<div class="paragraph"><p>-typecheck</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Does a typecheck of a SwiftScript program, instead of executing it.</tt></pre>
</div></div>
<div class="paragraph"><p>-dryrun</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Runs the SwiftScript program without submitting any jobs (can be
used to get a graph)</tt></pre>
</div></div>
<div class="paragraph"><p>-monitor</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Shows a graphical resource monitor</tt></pre>
</div></div>
<div class="paragraph"><p>-resume file</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Resumes the execution using a log file</tt></pre>
</div></div>
<div class="paragraph"><p>-config file</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Indicates the Swift configuration file to be used for this run.
Properties in this configuration file will override the default
properties. If individual command line arguments are used for
properties, they will override the contents of this file.</tt></pre>
</div></div>
<div class="paragraph"><p>-verbose | -v</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Increases the level of output that Swift produces on the console to
include more detail about the execution</tt></pre>
</div></div>
<div class="paragraph"><p>-debug | -d</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Increases the level of output that Swift produces on the console to
include lots of detail about the execution</tt></pre>
</div></div>
<div class="paragraph"><p>-logfile file</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Specifies a file where log messages should go to. By default Swift
uses the name of the program being run and a numeric index (e.g.
myworkflow.1.log)</tt></pre>
</div></div>
<div class="paragraph"><p>-runid identifier</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Specifies the run identifier. This must be unique for every
invocation and is used in several places to keep files from
different executions cleanly separated. By default, a datestamp and
random number are used to generate a run identifier. When using this
parameter, care should be taken to ensure that the run ID remains
unique with respect to all other run IDs that might be used,
irrespective of (at least) expected execution sites, program or user.</tt></pre>
</div></div>
<div class="paragraph"><p>-tui</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Displays an interactive text mode monitor during a run. (since Swift
0.9)</tt></pre>
</div></div>
<div class="paragraph"><p>In addition, the following Swift properties can be set on the command line:</p></div>
<div class="ulist"><ul>
<li>
<p>
caching.algorithm
</p>
</li>
<li>
<p>
clustering.enabled
</p>
</li>
<li>
<p>
clustering.min.time
</p>
</li>
<li>
<p>
clustering.queue.delay
</p>
</li>
<li>
<p>
ip.address
</p>
</li>
<li>
<p>
kickstart.always.transfer
</p>
</li>
<li>
<p>
kickstart.enabled
</p>
</li>
<li>
<p>
lazy.errors
</p>
</li>
<li>
<p>
pgraph
</p>
</li>
<li>
<p>
pgraph.graph.options
</p>
</li>
<li>
<p>
pgraph.node.options
</p>
</li>
<li>
<p>
sitedir.keep
</p>
</li>
<li>
<p>
sites.file
</p>
</li>
<li>
<p>
tc.file
</p>
</li>
<li>
<p>
tcp.port.range
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_return_codes">4.1.2. Return codes</h4>
<div class="paragraph"><p>The swift command may exit with the following return codes:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">value</th>
<th align="left" valign="top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">0</p></td>
<td align="left" valign="top"><p class="table">success</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">1</p></td>
<td align="left" valign="top"><p class="table">command line syntax error or missing project name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">2</p></td>
<td align="left" valign="top"><p class="table">error during execution</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3</p></td>
<td align="left" valign="top"><p class="table">error during compilation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">4</p></td>
<td align="left" valign="top"><p class="table">input file does not exist</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_environment_variables">4.1.3. Environment variables</h4>
<div class="paragraph"><p>The swift is influenced by the following environment variables:</p></div>
<div class="paragraph"><p>GLOBUS_HOSTNAME, GLOBUS_TCP_PORT_RANGE - set in the environment
before running Swift. These can be set to inform Swift of the
configuration of your local firewall. More information can be found in
the Globus firewall How-to <a href="http://dev.globus.org/wiki/FirewallHowTo">http://dev.globus.org/wiki/FirewallHowTo</a>.</p></div>
<div class="paragraph"><p>COG_OPTS - set in the environment before running Swift. Options set in
this variable will be passed as parameters to the Java Virtual Machine
which will run Swift. The parameters vary between virtual machine
imlementations, but can usually be used to alter settings such as
maximum heap size. Typing <em>java -help</em> will sometimes give a list of
commands. The Sun Java 1.4.2 command line options are documented here
<a href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/java.html">http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/java.html</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_swift_osg_ress_site_catalog">4.2. swift-osg-ress-site-catalog</h3>
<div class="paragraph"><p>The swift-osg-ress-site-catalog command generates a site catalog based
on OSG <a href="http://www.opensciencegrid.org/">http://www.opensciencegrid.org/</a>'s ReSS information system
(since Swift 0.9)</p></div>
<div class="paragraph"><p>Usage: <strong>swift-osg-ress-site-catalog [options]</strong></p></div>
<div class="paragraph"><p>--help</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Show help message</tt></pre>
</div></div>
<div class="paragraph"><p>--vo=[name]</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Set what VO to query ReSS for</tt></pre>
</div></div>
<div class="paragraph"><p>--engage-verified</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Only retrieve sites verified by the Engagement VO site verification
tests This can not be used together with |--vo|, as the query will
only work for sites advertising support for the Engagement VO.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This option means information will be retrieved from the Engagement
collector instead of the top-level ReSS collector.</tt></pre>
</div></div>
<div class="paragraph"><p>--out=[filename]</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Write to [filename] instead of stdout</tt></pre>
</div></div>
<div class="paragraph"><p>--condor-g</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Generates sites files which will submit jobs using a local Condor-G
installation rather than through direct GRAM2 submission. (since
Swift 0.10)</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_swift_plot_log">4.3. swift-plot-log</h3>
<div class="paragraph"><p>swift-plot-log generates summaries of Swift run log files.</p></div>
<div class="paragraph"><p>Usage: swift-plot-log [logfile] [targets]</p></div>
<div class="paragraph"><p>When no targets are specified, swift-plog-log will generate an HTML
report for the run. When targets are specified, only those named targets
will be generated.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_executing_app_procedures">5. Executing app procedures</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section describes how Swift executes app procedures, and
requirements on the behaviour of application programs used in app
procedures. These requirements are primarily to ensure that the Swift
can run your application in different places and with the various fault
tolerance mechanisms in place.</p></div>
<div class="sect2">
<h3 id="_mapping_of_app_semantics_into_unix_process_execution_semantics">5.1. Mapping of app semantics into unix process execution semantics</h3>
<div class="paragraph"><p>This section describes how an app procedure invocation is translated
into a (remote) unix process execution. It does not describe the
mechanisms by which Swift performs that translation; that is described
in the next section.</p></div>
<div class="paragraph"><p>In this section, this example SwiftScript program is used for reference:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">app</span></span> <span style="color: #990000">(</span><span style="color: #008080">file</span> o<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #008080">file</span> i<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  wc @<span style="color: #008080">i</span> stdout<span style="color: #990000">=</span>@o<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">file</span> q <span style="color: #990000">&lt;</span><span style="color: #FF0000">"input.txt"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">file</span> r <span style="color: #990000">&lt;</span><span style="color: #FF0000">"output.txt"</span><span style="color: #990000">&gt;;</span></tt></pre></div></div>
<div class="paragraph"><p>The executable for wc will be looked up in tc.data.</p></div>
<div class="paragraph"><p>This unix executable will then be executed in some application
procedure workspace. This means:</p></div>
<div class="paragraph"><p>Each application procedure workspace will have an application workspace
directory. (TODO: can collapse terms application procedure workspace
and application workspace directory ?</p></div>
<div class="paragraph"><p>This application workspace directory will not be shared with any other
application procedure execution attempt; all application procedure
execution attempts will run with distinct application procedure
workspaces. (for the avoidance of doubt: If a SwiftScript procedure
invocation is subject to multiple application procedure execution
attempts (due to Swift-level restarts, retries or replication) then each
of those application procedure execution attempts will be made in a
different application procedure workspace. )</p></div>
<div class="paragraph"><p>The application workspace directory will be a directory on a POSIX
filesystem accessible throughout the application execution by the
application executable.</p></div>
<div class="paragraph"><p>Before the application executable is executed:</p></div>
<div class="ulist"><ul>
<li>
<p>
The application workspace directory will exist.
</p>
</li>
<li>
<p>
The input files will exist inside the application workspace
      directory (but not necessarily as direct children; there may be
      subdirectories within the application workspace directory).
</p>
</li>
<li>
<p>
The input files will be those files mapped to input parameters
      of the application procedure invocation. (In the example, this
      means that the file input.txt will exist in the application
      workspace directory)
</p>
</li>
<li>
<p>
For each input file dataset, it will be the case that @filename
      or @filenames invoked with that dataset as a parameter will
      return the path relative to the application workspace directory
      for the file(s) that are associated with that dataset. (In the
      example, that means that @i will evaluate to the path input.txt)
</p>
</li>
<li>
<p>
For each file-bound parameter of the Swift procedure invocation,
      the associated files (determined by data type?) will always exist.
</p>
</li>
<li>
<p>
The input files must be treated as read only files. This may or
      may not be enforced by unix file system permissions. They may or
      may not be copies of the source file (conversely, they may be
      links to the actual source file).
</p>
</li>
</ul></div>
<div class="paragraph"><p>During/after the application executable execution, the following must
be true:</p></div>
<div class="ulist"><ul>
<li>
<p>
If the application executable execution was successful (in the
      opinion of the application executable), then the application
      executable should exit with unix return code 0; if the
      application executable execution was unsuccessful (in the opinion
      of the application executable), then the application executable
      should exit with unix return code not equal to 0.
</p>
</li>
<li>
<p>
Each file mapped from an output parameter of the SwiftScript
      procedure call must exist. Files will be mapped in the same way as
      for input files.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>(? Is it defined that output subdirectories will be precreated
before execution or should app executables expect to make them?
That's probably determined by the present behaviour of wrapper.sh)</tt></pre>
</div></div>
</li>
<li>
<p>
Output produced by running the application executable on some
      inputs should be the same no matter how many times, when or where
      that application executable is run. <em>The same</em> can vary depending
      on application (for example, in an application it might be
      acceptable for a PNG&#8594;JPEG conversion to produce different,
      similar looking, output jpegs depending on the environment)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Things to not assume:</p></div>
<div class="ulist"><ul>
<li>
<p>
anything about the path of the application workspace directory
</p>
</li>
<li>
<p>
that either the application workspace directory will be deleted or
      will continue to exist or will remain unmodified after execution
      has finished
</p>
</li>
<li>
<p>
that files can be passed(?def) between application procedure
      invocations through any mechanism except through files known to
      Swift through the mapping mechanism (there is some exception here
      for external datasets - there are a separate set of assertions
      that hold for external datasets)
</p>
</li>
<li>
<p>
that application executables will run on any particular site of
      those available, or than any combination of applications will run
      on the same or different sites.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_how_swift_implements_the_site_execution_model">5.2. How Swift implements the site execution model</h3>
<div class="paragraph"><p>This section describes the implementation of the semantics described in
the previous section.</p></div>
<div class="paragraph"><p>Swift executes application procedures on one or more sites.</p></div>
<div class="paragraph"><p>Each site consists of:</p></div>
<div class="ulist"><ul>
<li>
<p>
worker nodes. There is some execution mechanism through which
      the Swift client side executable can execute its wrapper script
      on those worker nodes. This is commonly GRAM or Falkon or coasters.
</p>
</li>
<li>
<p>
a site-shared file system. This site shared filesystem is
      accessible through some file transfer mechanism from the Swift
      client side executable. This is commonly GridFTP or coasters. This
      site shared filesystem is also accessible through the posix file
      system on all worker nodes, mounted at the same location as seen
      through the file transfer mechanism. Swift is configured with the
      location of some site working directory on that site-shared file
      system.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There is no assumption that the site shared file system for one site is
accessible from another site.</p></div>
<div class="paragraph"><p>For each workflow run, on each site that is used by that run, a run
directory is created in the site working directory, by the Swift client
side.</p></div>
<div class="paragraph"><p>In that run directory are placed several subdirectories:</p></div>
<div class="ulist"><ul>
<li>
<p>
shared/ - site shared files cache
</p>
</li>
<li>
<p>
kickstart/ - when kickstart is used, kickstart record files for
      each job that has generated a kickstart record.
</p>
</li>
<li>
<p>
info/ - wrapper script log files
</p>
</li>
<li>
<p>
status/ - job status files
</p>
</li>
<li>
<p>
jobs/ - application workspace directories (optionally placed
      here - see below)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Application execution looks like this:</p></div>
<div class="paragraph"><p>For each application procedure call:</p></div>
<div class="paragraph"><p>The Swift client side selects a site; copies the input files for that
procedure call to the site shared file cache if they are not already in
the cache, using the file transfer mechanism; and then invokes the
wrapper script on that site using the execution mechanism.</p></div>
<div class="paragraph"><p>The wrapper script creates the application workspace directory; places
the input files for that job into the application workspace directory
using either cp or ln -s (depending on a configuration option);
executes the application unix executable; copies output files from the
application workspace directory to the site shared directory using cp;
creates a status file under the status/ directory; and exits,
returning control to the Swift client side. Logs created during the
execution of the wrapper script are stored under the info/ directory.</p></div>
<div class="paragraph"><p>The Swift client side then checks for the presence of and deletes a
status file indicating success; and copies files from the site shared
directory to the appropriate client side location.</p></div>
<div class="paragraph"><p>The job directory is created (in the default mode) under the jobs/
directory. However, it can be created under an arbitrary other path,
which allows it to be created on a different file system (such as a
worker node local file system in the case that the worker node has a
local file system).</p></div>
<div class="paragraph"><p><span class="image">
<img src="swift-site-model.png" alt="swift-site-model.png" />
</span></p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_overview_of_the_swift_architecture">6. Technical overview of the Swift architecture</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section attempts to provide a technical overview of the Swift
architecture.</p></div>
<div class="sect2">
<h3 id="_execution_layer">6.1. Execution layer</h3>
<div class="paragraph"><p>The execution layer causes an application program (in the form of a unix
executable) to be executed either locally or remotely.</p></div>
<div class="paragraph"><p>The two main choices are local unix execution and execution through
GRAM. Other options are available, and user provided code can also be
plugged in.</p></div>
<div class="paragraph"><p>The kickstart utility can be used to capture environmental
information at execution time to aid in debugging and provenance capture.</p></div>
</div>
<div class="sect2">
<h3 id="_swiftscript_language_compilation_layer">6.2. SwiftScript language compilation layer</h3>
<div class="paragraph"><p>Step i: text to XML intermediate form parser/processor. parser written
in ANTLR - see resources/VDL.g. The XML Schema Definition (XSD) for the
intermediate language is in resources/XDTM.xsd.</p></div>
<div class="paragraph"><p>Step ii: XML intermediate form to Karajan workflow. Karajan.java - reads
the XML intermediate form. compiles to karajan workflow language - for
example, expressions are converted from SwiftScript syntax into Karajan
syntax, and function invocations become karajan function invocations
with various modifications to parameters to accomodate return parameters
and dataset handling.</p></div>
</div>
<div class="sect2">
<h3 id="_swift_karajan_library_layer">6.3. Swift/karajan library layer</h3>
<div class="paragraph"><p>Some Swift functionality is provided in the form of Karajan libraries
that are used at runtime by the Karajan workflows that the Swift
compiler generates.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ways_in_which_swift_can_be_extended">7. Ways in which Swift can be extended</h2>
<div class="sectionbody">
<div class="paragraph"><p>Swift is extensible in a number of ways. It is possible to add mappers
to accomodate different filesystem arrangements, site selectors to
change how Swift decides where to run each job, and job submission
interfaces to submit jobs through different mechanisms.</p></div>
<div class="paragraph"><p>A number of mappers are provided as part of the Swift release and
documented in the mappers section. New mappers can be
implemented in Java by implementing the org.griphyn.vdl.mapping.Mapper
interface. The Swift tutorial
<a href="http://www.ci.uchicago.edu/swift/guides/tutorial.php">http://www.ci.uchicago.edu/swift/guides/tutorial.php</a> contains a simple
example of this.</p></div>
<div class="paragraph"><p>Swift provides a default site selector, the Adaptive Scheduler. New site
selectors can be plugged in by implementing the
org.globus.cog.karajan.scheduler.Scheduler interface and modifying
libexec/scheduler.xml and etc/karajan.properties to refer to the new
scheduler.</p></div>
<div class="paragraph"><p>Execution providers and filesystem providers, which allow to Swift to
execute jobs and to stage files in and out through mechanisms such as
GRAM and GridFTP can be implemented as Java CoG kit providers.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_function_reference">8. Function reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section details functions that are available for use in the
SwiftScript language.</p></div>
<div class="sect2">
<h3 id="_arg">8.1. @arg</h3>
<div class="paragraph"><p>Takes a command line parameter name as a string parameter and an
optional default value and returns the value of that string parameter
from the command line. If no default value is specified and the command
line parameter is missing, an error is generated. If a default value is
specified and the command line parameter is missing, @arg will return
the default value.</p></div>
<div class="paragraph"><p>Command line parameters recognized by @arg begin with exactly one
hyphen and need to be positioned after the script name.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">trace</span></span><span style="color: #990000">(</span>@<span style="font-weight: bold"><span style="color: #000000">arg</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"myparam"</span><span style="color: #990000">));</span>
<span style="font-weight: bold"><span style="color: #000000">trace</span></span><span style="color: #990000">(</span>@<span style="font-weight: bold"><span style="color: #000000">arg</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"optionalparam"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"defaultvalue"</span><span style="color: #990000">));</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ <span style="color: #008080">swift</span> arg<span style="color: #990000">.</span>swift <span style="color: #990000">-</span>myparam<span style="color: #990000">=</span>hello
<span style="color: #008080">Swift</span> v0<span style="color: #990000">.</span><span style="color: #993399">3</span><span style="color: #990000">-</span><span style="color: #008080">dev</span> <span style="font-weight: bold"><span style="color: #000000">r1674</span></span> <span style="color: #990000">(</span><span style="color: #008080">modified</span> locally<span style="color: #990000">)</span>

RunID<span style="color: #990000">:</span> <span style="color: #993399">20080220</span><span style="color: #990000">-</span><span style="color: #993399">1548</span><span style="color: #990000">-</span>ylc4pmda
<span style="color: #008080">SwiftScript</span> trace<span style="color: #990000">:</span> defaultvalue
<span style="color: #008080">SwiftScript</span> trace<span style="color: #990000">:</span> hello</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_extractint">8.2. @extractint</h3>
<div class="paragraph"><p>@extractint(file) will read the specified file, parse an integer from
the file contents and return that integer.</p></div>
</div>
<div class="sect2">
<h3 id="_filename">8.3. @filename</h3>
<div class="paragraph"><p>@filename(v) will return a string containing the filename(s) for the
file(s) mapped to the variable v. When more than one filename is
returned, the filenames will be space separated inside a single string
return value.</p></div>
</div>
<div class="sect2">
<h3 id="_filenames">8.4. @filenames</h3>
<div class="paragraph"><p>@filenames(v) will return multiple values (!) containing the
filename(s) for the file(s) mapped to the variable v. (compare to
@filename)</p></div>
</div>
<div class="sect2">
<h3 id="_regexp">8.5. @regexp</h3>
<div class="paragraph"><p>@regexp(input,pattern,replacement) will apply regular expression
substitution using the Java java.util.regexp API
<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html">http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html</a>.
For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">string</span> v <span style="color: #990000">=</span>  @<span style="font-weight: bold"><span style="color: #000000">regexp</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"abcdefghi"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"c(def)g"</span><span style="color: #990000">,</span><span style="color: #FF0000">"monkey"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>will assign the value "abmonkeyhi" to the variable v.</p></div>
</div>
<div class="sect2">
<h3 id="_strcat">8.6. @strcat</h3>
<div class="paragraph"><p>@strcat(a,b,c,d,&#8230;) will return a string containing all of the
strings passed as parameters joined into a single string. There may be
any number of parameters.</p></div>
<div class="paragraph"><p>The + operator concatenates two strings: @strcat(a,b) is the same as
a + b</p></div>
</div>
<div class="sect2">
<h3 id="_strcut">8.7. @strcut</h3>
<div class="paragraph"><p>@strcut(input,pattern) will match the regular expression in the
pattern parameter against the supplied input string and return the
section that matches the first matching parenthesised group.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">string</span> t <span style="color: #990000">=</span> <span style="color: #FF0000">"my name is John and i like puppies."</span><span style="color: #990000">;</span>
<span style="color: #008080">string</span> name <span style="color: #990000">=</span> @<span style="font-weight: bold"><span style="color: #000000">strcut</span></span><span style="color: #990000">(</span>t<span style="color: #990000">,</span> <span style="color: #FF0000">"my name is ([^ ]*) "</span><span style="color: #990000">);</span>
<span style="color: #008080">string</span> out <span style="color: #990000">=</span> @<span style="font-weight: bold"><span style="color: #000000">strcat</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Your name is "</span><span style="color: #990000">,</span>name<span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">trace</span></span><span style="color: #990000">(</span>out<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>will output the message: Your name is John.</p></div>
</div>
<div class="sect2">
<h3 id="_strsplit">8.8. @strsplit</h3>
<div class="paragraph"><p>@strsplit(input,pattern) will split the input string based on
separators that match the given pattern and return a string array.
(since Swift 0.9)</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">string</span> t <span style="color: #990000">=</span> <span style="color: #FF0000">"my name is John and i like puppies."</span><span style="color: #990000">;</span>
<span style="color: #008080">string</span> words<span style="color: #990000">[]</span> <span style="color: #990000">=</span> @<span style="font-weight: bold"><span style="color: #000000">strsplit</span></span><span style="color: #990000">(</span>t<span style="color: #990000">,</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">s"</span><span style="color: #990000">);</span>
foreach word <span style="color: #008080">in</span> words <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">trace</span></span><span style="color: #990000">(</span>word<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>will output one word of the sentence on each line (though not
necessarily in order, due to the fact that foreach iterations execute in
parallel).</p></div>
</div>
<div class="sect2">
<h3 id="_toint">8.9. @toint</h3>
<div class="paragraph"><p>@toint(input) will parse its input string into an integer. This can be
used with @arg to pass input parameters to a SwiftScript program as
integers.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_in_procedure_reference">9. Built-in procedure reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section details built-in procedures that are available for use in
the SwiftScript language.</p></div>
<div class="sect2">
<h3 id="_readdata">9.1. readData</h3>
<div class="paragraph"><p>readData will read data from a specified file.</p></div>
<div class="paragraph"><p>The format of the input file is controlled by the type of the return value.</p></div>
<div class="paragraph"><p>For scalar return types, such as int, the specified file should contain
a single value of that type.</p></div>
<div class="paragraph"><p>For arrays of scalars, the specified file should contain one value per
line.</p></div>
<div class="paragraph"><p>For structs of scalars, the file should contain two rows. The first row
should be structure member names separated by whitespace. The second row
should be the corresponding values for each structure member, separated
by whitespace, in the same order as the header row.</p></div>
<div class="paragraph"><p>For arrays of structs, the file should contain a heading row listing
structure member names separated by whitespace. There should be one row
for each element of the array, with structure member elements listed in
the same order as the header row and separated by whitespace. (since
Swift 0.4)</p></div>
</div>
<div class="sect2">
<h3 id="_readdata2">9.2. readdata2</h3>
<div class="paragraph"><p>readdata2 will read data from a specified file, like readdata, but
using a different file format more closely related to that used by the
ext mapper.</p></div>
<div class="paragraph"><p>Input files should list, one per line, a path into a Swift structure,
and the value for that position in the structure:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rows<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">0</span>
rows<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">2</span>
rows<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">4</span>
rows<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">1</span>
rows<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">3</span>
rows<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">].</span>columns<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">5</span></tt></pre></div></div>
<div class="paragraph"><p>which can be read into a structure defined like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> vector <span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> columns<span style="color: #990000">[];</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">type</span> matrix <span style="color: #FF0000">{</span>
        <span style="color: #008080">vector</span> rows<span style="color: #990000">[];</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">matrix</span> m<span style="color: #990000">;</span>

m <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">readData2</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"readData2.in"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>(since Swift 0.7)</p></div>
</div>
<div class="sect2">
<h3 id="_trace">9.3. trace</h3>
<div class="paragraph"><p>trace will log its parameters. By default these will appear on both
stdout and in the run log file. Some formatting occurs to produce the
log message. The particular output format should not be relied upon.
(since Swift 0.4)</p></div>
</div>
<div class="sect2">
<h3 id="_writedata">9.4. writeData</h3>
<div class="paragraph"><p>writeData will write out data structures in the format described for
readData</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_swift_configuration_properties">10. Swift configuration properties</h2>
<div class="sectionbody">
<div class="paragraph"><p>Various aspects of the behavior of the Swift Engine can be configured
through properties. The Swift Engine recognizes a global, per
installation properties file which can found in etc/swift.properties
in the Swift installation directory and a user properties file which can
be created by each user in ~/.swift/swift.properties. The Swift Engine
will first load the global properties file. It will then try to load the
user properties file. If a user properties file is found, individual
properties explicitly set in that file will override the respective
properties in the global properties file. Furthermore, some of the
properties can be overridden directly using command line arguments to
the <strong>swift</strong> command.</p></div>
<div class="paragraph"><p>Swift properties are specified in the following format:</p></div>
<div class="paragraph"><p>&lt;name&gt;=&lt;value&gt;</p></div>
<div class="paragraph"><p>The value can contain variables which will be expanded when the
properties file is read. Expansion is performed when the name of the
variable is used inside the standard shell dereference construct:
configuration file:</p></div>
<div class="paragraph"><p>Swift Configuration Variables</p></div>
<div class="paragraph"><p>swift.home</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Points to the Swift installation directory ($SWIFT_HOME). In
general, this should not be set as Swift can find its own
installation directory, and incorrectly setting it may impair the
correct functionality of Swift.</tt></pre>
</div></div>
<div class="paragraph"><p>user.name</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>The name of the current logged in user.</tt></pre>
</div></div>
<div class="paragraph"><p>user.home</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>The user's home directory.</tt></pre>
</div></div>
<div class="paragraph"><p>The following is a list of valid Swift properties:</p></div>
<div class="paragraph"><p>Swift Properties</p></div>
<div class="paragraph"><p>caching.algorithm</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: LRU</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: LRU</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Swift caches files that are staged in on remote resources, and files
that are produced remotely by applications, such that they can be
re-used if needed without being transfered again. However, the
amount of remote file system space to be used for caching can be
limited using the swift:storagesize profile entry in the sites.xml file. Example:</tt></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;pool</span></span> <span style="color: #009900">handle</span><span style="color: #990000">=</span><span style="color: #FF0000">"example"</span> <span style="color: #009900">sysinfo</span><span style="color: #990000">=</span><span style="color: #FF0000">"INTEL32::LINUX"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;gridftp</span></span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"gsiftp://example.org"</span> <span style="color: #009900">storage</span><span style="color: #990000">=</span><span style="color: #FF0000">"/scratch/swift"</span> <span style="color: #009900">major</span><span style="color: #990000">=</span><span style="color: #FF0000">"2"</span> <span style="color: #009900">minor</span><span style="color: #990000">=</span><span style="color: #FF0000">"4"</span> <span style="color: #009900">patch</span><span style="color: #990000">=</span><span style="color: #FF0000">"3"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;jobmanager</span></span> <span style="color: #009900">universe</span><span style="color: #990000">=</span><span style="color: #FF0000">"vanilla"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"example.org/jobmanager-pbs"</span> <span style="color: #009900">major</span><span style="color: #990000">=</span><span style="color: #FF0000">"2"</span> <span style="color: #009900">minor</span><span style="color: #990000">=</span><span style="color: #FF0000">"4"</span> <span style="color: #009900">patch</span><span style="color: #990000">=</span><span style="color: #FF0000">"3"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;workdirectory&gt;</span></span>/scratch/swift<span style="font-weight: bold"><span style="color: #0000FF">&lt;/workdirectory&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"SWIFT"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"storagesize"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>20000000<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pool&gt;</span></span></tt></pre></div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The decision of which files to keep in the cache and which files to
remove is made considering the value of the caching.algorithm
property. Currently, the only available value for this property is
LRU, which would cause the least recently used files to be deleted
first.</tt></pre>
</div></div>
<div class="paragraph"><p>clustering.enabled</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Enables clustering.</tt></pre>
</div></div>
<div class="paragraph"><p>clustering.min.time</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 60</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Indicates the threshold wall time for clustering, in seconds. Jobs
that have a wall time smaller than the value of this property will
be considered for clustering.</tt></pre>
</div></div>
<div class="paragraph"><p>clustering.queue.delay</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 4</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This property indicates the interval, in seconds, at which the
clustering queue is processed.</tt></pre>
</div></div>
<div class="paragraph"><p>execution.retries</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: positive integers</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 2</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The number of time a job will be retried if it fails (giving a
maximum of 1 + execution.retries attempts at execution)</tt></pre>
</div></div>
<div class="paragraph"><p>foreach.max.threads</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: positive integers</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 1024</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Limits the number of concurrent iterations that each foreach
statement can have at one time. This conserves memory for swift
programs that have large numbers of iterations (which would
otherwise all be executed in parallel). (since Swift 0.9)</tt></pre>
</div></div>
<div class="paragraph"><p>ip.address</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;ipaddress&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: N/A</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The Globus GRAM service uses a callback mechanism to send
notifications about the status of submitted jobs. The callback
mechanism requires that the Swift client be reachable from the hosts
the GRAM services are running on. Normally, Swift can detect the
correct IP address of the client machine. However, in certain cases
(such as the client machine having more than one network interface)
the automatic detection mechanism is not reliable. In such cases,
the IP address of the Swift client machine can be specified using
this property. The value of this property must be a numeric address
without quotes.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This option is deprecated and the hostname property should be used
instead.</tt></pre>
</div></div>
<div class="paragraph"><p>kickstart.always.transfer</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This property controls when output from Kickstart is transfered back
to the submit site, if Kickstart is enabled. When set to false,
Kickstart output is only transfered for jobs that fail. If set to
true, Kickstart output is transfered after every job is completed
or failed.</tt></pre>
</div></div>
<div class="paragraph"><p>kickstart.enabled</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false, maybe</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: maybe</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This option allows controlling of when Swift uses Kickstart.
A value of false disables the use of Kickstart,
while a value of true enables the use of Kickstart, in which case
sites specified in the sites.xml file must have valid
gridlaunch attributes. The maybe value will enable the use of
Kickstart only on sites that have the gridlaunch attribute
specified.</tt></pre>
</div></div>
<div class="paragraph"><p>lazy.errors</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Swift can report application errors in two modes, depending on the
value of this property. If set to false, Swift will report the
first error encountered and immediately stop execution. If set to
true, Swift will attempt to run as much as possible from a
SwiftScript program before stopping execution and reporting all
errors encountered.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>When developing SwiftScript programs, using the default value of
false can make the program easier to debug. However in production
runs, using true will allow more of a SwiftScript program to be
run before Swift aborts execution.</tt></pre>
</div></div>
<div class="paragraph"><p>pgraph</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false, &lt;file&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Swift can generate a Graphviz &lt;http://www.graphviz.org/&gt; file
representing the structure of the SwiftScript program it has run. If
this property is set to true, Swift will save the provenance graph
in a file named by concatenating the program name and the instance
ID (e.g. helloworld-ht0adgi315l61.dot).</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>If set to false, no provenance graph will be generated. If a file
name is used, then the provenance graph will be saved in the
specified file.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The generated dot file can be rendered into a graphical form using
Graphviz &lt;http://www.graphviz.org/&gt;, for example with a command-line
such as:</tt></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ swift -pgraph graph1<span style="color: #990000">.</span>dot q1<span style="color: #990000">.</span>swift
$ dot -ograph<span style="color: #990000">.</span>png -Tpng graph1<span style="color: #990000">.</span>dot</tt></pre></div></div>
<div class="paragraph"><p>pgraph.graph.options</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;string&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: splines="compound", rankdir="TB"</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This property specifies a Graphviz &lt;http://www.graphviz.org&gt;
specific set of parameters for the graph.</tt></pre>
</div></div>
<div class="paragraph"><p>pgraph.node.options</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;string&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: color="seagreen", style="filled"</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Used to specify a set of Graphviz &lt;http://www.graphviz.org&gt; specific
properties for the nodes in the graph.</tt></pre>
</div></div>
<div class="paragraph"><p>provenance.log</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This property controls whether the log file will contain provenance
information enabling this will increase the size of log files,
sometimes significantly.</tt></pre>
</div></div>
<div class="paragraph"><p>replication.enabled</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Enables/disables replication. Replication is used to deal with jobs
sitting in batch queues for abnormally large amounts of time. If
replication is enabled and certain conditions are met, Swift creates
and submits replicas of jobs, and allows multiple instances of a job
to compete.</tt></pre>
</div></div>
<div class="paragraph"><p>replication.limit</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: positive integers</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 3</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The maximum number of replicas that Swift should attempt.</tt></pre>
</div></div>
<div class="paragraph"><p>sitedir.keep</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Indicates whether the working directory on the remote site should be
left intact even when a run completes successfully. This can be used
to inspect the site working directory for debugging purposes.</tt></pre>
</div></div>
<div class="paragraph"><p>sites.file</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;file&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: ${swift.home}/etc/sites.xml</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Points to the location of the site catalog, which contains a list of
all sites that Swift should use.</tt></pre>
</div></div>
<div class="paragraph"><p>status.mode</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: files, provider</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: files</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Controls how Swift will communicate the result code of running user
programs from workers to the submit side. In files mode, a file
indicating success or failure will be created on the site shared
filesystem. In provider mode, the execution provider job status
will be used.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>provider mode requires the underlying job execution system to
correctly return exit codes. In at least the cases of GRAM2, and
clusters used with any provider, exit codes are not returned, and so
files mode must be used in those cases. Otherwise, provider mode
can be used to reduce the amount of filesystem access. (since Swift
0.8)</tt></pre>
</div></div>
<div class="paragraph"><p>tc.file</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;file&gt;</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: ${swift.home}/etc/tc.data</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Points to the location of the transformation catalog file which
contains information about installed applications. Details about the
format of the transformation catalog can be found here
&lt;http://vds.uchicago.edu/vds/doc/userguide/html/H_TransformationCatalog.html&gt;.</tt></pre>
</div></div>
<div class="paragraph"><p>tcp.port.range</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;start&gt;,&lt;end&gt; where start and end are integers</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: none</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>A TCP port range can be specified to restrict the ports on which
GRAM callback services are started. This is likely needed if your
submit host is behind a firewall, in which case the firewall should
be configured to allow incoming connections on ports in the range.</tt></pre>
</div></div>
<div class="paragraph"><p>throttle.file.operations</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;, off</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 8</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Limits the total number of concurrent file operations that can
happen at any given time. File operations (like transfers) require
an exclusive connection to a site. These connections can be
expensive to establish. A large number of concurrent file operations
may cause Swift to attempt to establish many such expensive
connections to various sites. Limiting the number of concurrent file
operations causes Swift to use a small number of cached connections
and achieve better overall performance.</tt></pre>
</div></div>
<div class="paragraph"><p>throttle.host.submit</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;, off</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 2</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Limits the number of concurrent submissions for any of the sites
Swift will try to send jobs to. In other words it guarantees that no
more than the value of this throttle jobs sent to any site will be
concurrently in a state of being submitted.</tt></pre>
</div></div>
<div class="paragraph"><p>throttle.score.job.factor</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;, off</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 4</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The Swift scheduler has the ability to limit the number of
concurrent jobs allowed on a site based on the performance history
of that site. Each site is assigned a score (initially 1), which can
increase or decrease based on whether the site yields successful or
faulty job runs. The score for a site can take values in the (0.1,
100) interval. The number of allowed jobs is calculated using the
following formula:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>2 + score*throttle.score.job.factor</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This means a site will always be allowed at least two concurrent
jobs and at most 2 + 100*throttle.score.job.factor. With a default
of 4 this means at least 2 jobs and at most 402.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This parameter can also be set per site using the jobThrottle
profile key in a site catalog entry.</tt></pre>
</div></div>
<div class="paragraph"><p>throttle.submit</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;, off</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 4</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Limits the number of concurrent submissions for a run. This throttle
only limits the number of concurrent tasks (jobs) that are being
sent to sites, not the total number of concurrent jobs that can be
run. The submission stage in GRAM is one of the most CPU expensive
stages (due mostly to the mutual authentication and delegation).
Having too many concurrent submissions can overload either or both
the submit host CPU and the remote host/head node causing degraded
performance.</tt></pre>
</div></div>
<div class="paragraph"><p>throttle.transfers</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: &lt;int&gt;, off</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: 4</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Limits the total number of concurrent file transfers that can happen
at any given time. File transfers consume bandwidth. Too many
concurrent transfers can cause the network to be overloaded
preventing various other signaling traffic from flowing properly.</tt></pre>
</div></div>
<div class="paragraph"><p>ticker.disable</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>When set to true, suppresses the output progress ticker that Swift
sends to the console every few seconds during a run (since Swift 0.9)</tt></pre>
</div></div>
<div class="paragraph"><p>wrapper.invocation.mode</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: absolute, relative</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: absolute</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Determines if Swift remote wrappers will be executed by specifying
an absolute path, or a path relative to the job initial working
directory. In most cases, execution will be successful with either
option. However, some execution sites ignore the specified initial
working directory, and so absolute must be used. Conversely on
some sites, job directories appear in a different place on the
worker node file system than on the filesystem access node, with the
execution system handling translation of the job initial working
directory. In such cases, relative mode must be used. (since Swift
0.9)</tt></pre>
</div></div>
<div class="paragraph"><p>wrapper.parameter.mode</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Controls how Swift will supply parameters to the remote wrapper
script. args mode will pass parameters on the command line. Some
execution systems do not pass commandline parameters sufficiently
cleanly for Swift to operate correctly. files mode will pass
parameters through an additional input file (since Swift 0.95). This
provides a cleaner communication channel for parameters, at the
expense of transferring an additional file for each job invocation.</tt></pre>
</div></div>
<div class="paragraph"><p>wrapperlog.always.transfer</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>Valid values: true, false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Default value: false</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This property controls when output from the Swift remote wrapper is
transfered back to the submit site. When set to false, wrapper
logs are only transfered for jobs that fail. If set to true,
wrapper logs are transfered after every job is completed or failed.</tt></pre>
</div></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>sites.file=${vds.home}/etc/sites.xml
tc.file=${vds.home}/etc/tc.data
ip.address=192.168.0.1</tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_profiles">11. Profiles</h2>
<div class="sectionbody">
<div class="paragraph"><p>Profiles are configuration parameters than can be specified either for
sites or for transformation catalog entries. They influence the
behaviour of Swift towards that site (for example, by changing the load
Swift will place on that sites) or when running a particular procedure.</p></div>
<div class="paragraph"><p>Profile entries for a site are specified in the site catalog. Profile
entries for specific procedures are specified in the transformation
catalog.</p></div>
<div class="sect2">
<h3 id="_karajan_namespace">11.1. Karajan namespace</h3>
<div class="paragraph"><p>maxSubmitRate limits the maximum rate of job submission, in jobs per
second. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"karajan"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"maxSubmitRate"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>0.2<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>will limit job submission to 0.2 jobs per second (or equivalently, one
job every five seconds).</p></div>
<div class="paragraph"><p>jobThrottle allows the job throttle factor (see Swift property
throttle.score.job.factor to be
set per site.</p></div>
<div class="paragraph"><p>initialScore allows the initial score for rate limiting and site
selection to be set to a value other than 0.</p></div>
<div class="paragraph"><p>delayBase controls how much a site will be delayed when it performs
poorly. With each reduction in a sites score by 1, the delay between
execution attempts will increase by a factor of delayBase.</p></div>
<div class="paragraph"><p>status.mode allows the status.mode property to be set per-site instead
of for an entire run. See the Swift configuration properties section for
more information. (since Swift 0.8)</p></div>
</div>
<div class="sect2">
<h3 id="_swift_namespace">11.2. swift namespace</h3>
<div class="paragraph"><p>storagesize limits the amount of space that will be used on the remote
site for temporary files. When more than that amount of space is used,
the remote temporary file cache will be cleared using the algorithm
specified in the caching.algorithm property.</p></div>
<div class="paragraph"><p>wrapperInterpreter - The wrapper interpreter indicates the command
(executable) to be used to run the Swift wrapper script. The default is
"/bin/bash" on Unix sites and "cscript.exe" on Windows sites.</p></div>
<div class="paragraph"><p>wrapperInterpreterOptions - Allows specifying additional options to the
executable used to run the Swift wrapper. The defaults are no options on
Unix sites and "Nologo" on Windows sites.</p></div>
<div class="paragraph"><p>wrapperScript - Specifies the name of the wrapper script to be used on a
site. The defaults are "_swiftwrap" on Unix sites and "_swiftwrap.vbs"
on Windows sites. If you specify a custom wrapper script, it must be
present in the "libexec" directory of the Swift installation.</p></div>
<div class="paragraph"><p>cleanupCommand Indicates the command to be run at the end of a Swift
run to clean up the run directories on a remote site. Defaults are
"/bin/rm" on Unix sites and "cmd.exe" on Windows sites</p></div>
<div class="paragraph"><p>cleanupCommandOptions Specifies the options to be passed to the
cleanup command above. The options are passed in the argument list to
the cleanup command. After the options, the last argument is the
directory to be deleted. The default on Unix sites is "-rf". The default
on Windows sites is ["/C", "del", "/Q"].</p></div>
</div>
<div class="sect2">
<h3 id="_globus_namespace">11.3. Globus namespace</h3>
<div class="paragraph"><p>maxwalltime specifies a walltime limit for each job, in minutes.</p></div>
<div class="paragraph"><p>The following formats are recognized:</p></div>
<div class="ulist"><ul>
<li>
<p>
Minutes
</p>
</li>
<li>
<p>
Hours:Minutes
</p>
</li>
<li>
<p>
Hours:Minutes:Seconds
</p>
</li>
</ul></div>
<div class="paragraph"><p>Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">localhost</span>       echo    <span style="color: #990000">/</span>bin<span style="color: #990000">/</span>echo       <span style="color: #008080">INSTALLED</span>       INTEL32<span style="color: #990000">::</span><span style="color: #008080">LINUX</span>  GLOBUS<span style="color: #990000">::</span>maxwalltime<span style="color: #990000">=</span><span style="color: #FF0000">"00:20:00"</span></tt></pre></div></div>
<div class="paragraph"><p>When replication is enabled (see replication), then
walltime will also be enforced at the Swift client side: when a job has
been active for more than twice the maxwalltime, Swift will kill the job
and regard it as failed.</p></div>
<div class="paragraph"><p>When clustering is used, maxwalltime will be used to select which jobs
will be clustered together. More information on this is available in the
clustering section.</p></div>
<div class="paragraph"><p>When coasters as used, maxwalltime influences the default coaster
worker maxwalltime, and which jobs will be sent to which workers. More
information on this is available in the coasters section.</p></div>
<div class="paragraph"><p>queue is used by the PBS, GRAM2 and GRAM4 providers. This profile
entry specifies which queue jobs will be submitted to. The valid queue
names are site-specific.</p></div>
<div class="paragraph"><p>host_types specifies the types of host that are permissible for a job
to run on. The valid values are site-specific. This profile entry is
used by the GRAM2 and GRAM4 providers.</p></div>
<div class="paragraph"><p>condor_requirements allows a requirements string to be specified when
Condor is used as an LRM behind GRAM2. Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span>
<span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"globus"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"condor_requirements"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>Arch == "X86_64" || Arch="INTEL"<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>slots When using coasters, this parameter specifies the
maximum number of jobs/blocks that the coaster scheduler will have
running at any given time. The default is 20.</p></div>
<div class="paragraph"><p>workersPerNode - This parameter determines how many coaster workers are
started one each compute node. The default value is 1.</p></div>
<div class="paragraph"><p>nodeGranularity - When allocating a coaster worker block, this parameter
restricts the number of nodes in a block to a multiple of this value.
The total number of workers will then be a multiple of workersPerNode *
nodeGranularity. The default value is 1.</p></div>
<div class="paragraph"><p>allocationStepSize - Each time the coaster block scheduler computes a
schedule, it will attempt to allocate a number of slots from the number
of available slots (limited using the above slots profile). This
parameter specifies the maximum fraction of slots that are allocated in
one schedule. Default is 0.1.</p></div>
<div class="paragraph"><p>lowOverallocation - Overallocation is a function of the walltime of a
job which determines how long (time-wise) a worker job will be. For
example, if a number of 10s jobs are submitted to the coaster service,
and the overallocation for 10s jobs is 10, the coaster scheduler will
attempt to start worker jobs that have a walltime of 100s. The
overallocation is controlled by manipulating the end-points of an
overallocation function. The low endpoint, specified by this parameter,
is the overallocation for a 1s job. The high endpoint is the
overallocation for a (theoretical) job of infinite length. The
overallocation for job sizes in the [1s, +inf) interval is determined
using an exponential decay function: overallocation(walltime) = walltime
* (lowOverallocation - highOverallocation) * exp(-walltime *
overallocationDecayFactor) + highOverallocation The default value of
lowOverallocation is 10.</p></div>
<div class="paragraph"><p>highOverallocation - The high overallocation endpoint (as described
above). Default: 1</p></div>
<div class="paragraph"><p>overallocationDecayFactor - The decay factor for the overallocation
curve. Default 0.001 (1e-3).</p></div>
<div class="paragraph"><p>spread - When a large number of jobs is submitted to the a coaster
service, the work is divided into blocks. This parameter allows a rough
control of the relative sizes of those blocks. A value of 0 indicates
that all work should be divided equally between the blocks (and blocks
will therefore have equal sizes). A value of 1 indicates the largest
possible spread. The existence of the spread parameter is based on the
assumption that smaller overall jobs will generally spend less time in
the queue than larger jobs. By submitting blocks of different sizes,
submitted jobs may be finished quicker by smaller blocks. Default: 0.9.</p></div>
<div class="paragraph"><p>reserve - Reserve time is a time in the allocation of a worker that sits
at the end of the worker time and is useable only for critical
operations. For example, a job will not be submitted to a worker if it
overlaps its reserve time, but a job that (due to inaccurate walltime
specification) runs into the reserve time will not be killed (note that
once the worker exceeds its walltime, the queuing system will kill the
job anyway). Default 10 (s).</p></div>
<div class="paragraph"><p>maxnodes - Determines the maximum number of nodes that can be allocated
in one coaster block. Default: unlimited.</p></div>
<div class="paragraph"><p>maxtime - Indicates the maximum walltime that a coaster block can have.
Default: unlimited.</p></div>
<div class="paragraph"><p>remoteMonitorEnabled - If set to "true", the client side will get a
Swing window showing, graphically, the state of the coaster scheduler
(blocks, jobs, etc.). Default: false</p></div>
</div>
<div class="sect2">
<h3 id="_env_namespace">11.4. env namespace</h3>
<div class="paragraph"><p>Profile keys set in the env namespace will be set in the unix
environment of the executed job. Some environment variables influence
the worker-side behaviour of Swift:</p></div>
<div class="paragraph"><p>PATHPREFIX - set in env namespace profiles. This path is prefixed onto
the start of the PATH when jobs are executed. It can be more useful
than setting the PATH environment variable directly, because setting
PATH will cause the execution site&#8217;s default path to be lost.</p></div>
<div class="paragraph"><p>SWIFT_JOBDIR_PATH - set in env namespace profiles. If set, then Swift
will use the path specified here as a worker-node local temporary
directory to copy input files to before running a job. If unset, Swift
will keep input files on the site-shared filesystem. In some cases,
copying to a worker-node local directory can be much faster than having
applications access the site-shared filesystem directly.</p></div>
<div class="paragraph"><p>SWIFT_EXTRA_INFO - set in env namespace profiles. If set, then Swift
will execute the command specified in SWIFT_EXTRA_INFO on execution
sites immediately before each application execution, and will record the
stdout of that command in the wrapper info log file for that job. This
is intended to allow software version and other arbitrary information
about the remote site to be gathered and returned to the submit side.
(since Swift 0.9)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_site_catalog_sites_xml">12. The Site Catalog - sites.xml</h2>
<div class="sectionbody">
<div class="paragraph"><p>The site catalog lists details of each site that Swift can use. The
default file contains one entry for local execution, and a large number
of commented-out example entries for other sites.</p></div>
<div class="paragraph"><p>By default, the site catalog is stored in etc/sites.xml. This path can
be overridden with the sites.file configuration property, either in
the Swift configuration file or on the command line.</p></div>
<div class="paragraph"><p>The sites file is formatted as XML. It consists of &lt;pool&gt; elements,
one for each site that Swift will use.</p></div>
<div class="sect2">
<h3 id="_pool_element">12.1. Pool element</h3>
<div class="paragraph"><p>Each pool element must have a handle attribute, giving a symbolic
name for the site. This can be any name, but must correspond to entries
for that site in the transformation catalog.</p></div>
<div class="paragraph"><p>Optionally, the gridlaunch attribute can be used to specify the path
to kickstart on the site.</p></div>
<div class="paragraph"><p>Each pool must specify a file transfer method, an execution method and
a remote working directory. Optionally, profile settings can
be specified.</p></div>
</div>
<div class="sect2">
<h3 id="_file_transfer_method">12.2. File transfer method</h3>
<div class="paragraph"><p>Transfer methods are specified with either the &lt;gridftp&gt; element or
the &lt;filesystem&gt; element.</p></div>
<div class="paragraph"><p>To use gridftp or local filesystem copy, use the &lt;gridftp&gt; element:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;gridftp</span></span>  <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"gsiftp://evitable.ci.uchicago.edu"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The url attribute may specify a GridFTP server, using the gsiftp URI
scheme; or it may specify that filesystem copying will be used (which
assumes that the site has access to the same filesystem as the
submitting machine) using the URI local://localhost.</p></div>
<div class="paragraph"><p>Filesystem access using scp (the SSH copy protocol) can be specified
using the &lt;filesystem&gt; element:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;filesystem</span></span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"www11.i2u2.org"</span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"ssh"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>For additional ssh configuration information, see the ssh execution
provider documentation below.</p></div>
<div class="paragraph"><p>Filesystem access using CoG coasters can be also be
specified using the &lt;filesystem&gt; element. More detail about
configuring that can be found in the CoG coasters section.</p></div>
</div>
<div class="sect2">
<h3 id="_execution_method">12.3. Execution method</h3>
<div class="paragraph"><p>Execution methods may be specified either with the &lt;jobmanager&gt; or
&lt;execution&gt; element.</p></div>
<div class="paragraph"><p>The &lt;jobmanager&gt; element can be used to specify execution through
GRAM2. For example,</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;jobmanager</span></span> <span style="color: #009900">universe</span><span style="color: #990000">=</span><span style="color: #FF0000">"vanilla"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"evitable.ci.uchicago.edu/jobmanager-fork"</span> <span style="color: #009900">major</span><span style="color: #990000">=</span><span style="color: #FF0000">"2"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The universe attribute should always be set to vanilla. The url
attribute should specify the name of the GRAM2 gatekeeper host, and the
name of the jobmanager to use. The major attribute should always be set
to 2.</p></div>
<div class="paragraph"><p>The &lt;execution&gt; element can be used to specify execution through other
execution providers:</p></div>
<div class="paragraph"><p>To use GRAM4, specify the gt4 provider. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"gt4"</span> <span style="color: #009900">jobmanager</span><span style="color: #990000">=</span><span style="color: #FF0000">"PBS"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"tg-grid.uc.teragrid.org"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The url attribute should specify the GRAM4 submission site. The
jobmanager attribute should specify which GRAM4 jobmanager will be used.</p></div>
<div class="paragraph"><p>For local execution, the local provider should be used, like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"local"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"none"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>For PBS execution, the pbs provider should be used:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"pbs"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"none"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The GLOBUS::queue profile key can be used to
specify which PBS queue jobs will be submitted to.</p></div>
<div class="paragraph"><p>For execution through a local Condor installation, the condor provider
should be used. This provider can run jobs either in the default vanilla
universe, or can use Condor-G to run jobs on remote sites.</p></div>
<div class="paragraph"><p>When running locally, only the &lt;execution&gt; element needs to be specified:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"condor"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"none"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>When running with Condor-G, it is necessary to specify the Condor grid
universe and the contact string for the remote site. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"condor"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"globus"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"jobType"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>grid<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"globus"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"gridResource"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>gt2 belhaven-1.renci.org/jobmanager-fork<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>For execution through SSH, the ssh provider should be used:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"www11.i2u2.org"</span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"ssh"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>with configuration made in ~/.ssh/auth.defaults with the string
<em>www11.i2u2.org</em> changed to the appropriate host name:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>www11<span style="color: #990000">.</span>i2u2<span style="color: #990000">.</span>org<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">type</span></span><span style="color: #990000">=</span>key
www11<span style="color: #990000">.</span>i2u2<span style="color: #990000">.</span>org<span style="color: #990000">.</span><span style="color: #009900">username</span><span style="color: #990000">=</span>hategan
www11<span style="color: #990000">.</span>i2u2<span style="color: #990000">.</span>org<span style="color: #990000">.</span><span style="color: #009900">key</span><span style="color: #990000">=</span>/home/mike<span style="color: #990000">/.</span>ssh/i2u2portal
www11<span style="color: #990000">.</span>i2u2<span style="color: #990000">.</span>org<span style="color: #990000">.</span><span style="color: #009900">passphrase</span><span style="color: #990000">=</span>XXXX</tt></pre></div></div>
<div class="paragraph"><p>For execution using the CoG Coaster mechanism, the coaster
provider should be used:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"coaster"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"tg-grid.uc.teragrid.org"</span>
    <span style="color: #009900">jobmanager</span><span style="color: #990000">=</span><span style="color: #FF0000">"gt2:gt2:pbs"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>More details about configuration of coasters can be found in the section
on coasters.</p></div>
</div>
<div class="sect2">
<h3 id="_work_directory">12.4. Work directory</h3>
<div class="paragraph"><p>The workdirectory element specifies where on the site files can be
stored.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;workdirectory&gt;</span></span>/home/benc<span style="font-weight: bold"><span style="color: #0000FF">&lt;/workdirectory&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>This file must be accessible through the transfer mechanism specified in
the &lt;gridftp&gt; element and also mounted on all worker nodes that will
be used for execution. A shared cluster scratch filesystem is
appropriate for this.</p></div>
</div>
<div class="sect2">
<h3 id="_profiles_2">12.5. Profiles</h3>
<div class="paragraph"><p>Profile keys can be specified using the &lt;profile&gt; element.
For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"globus"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"queue"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>fast<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The site catalog format is an evolution of the VDS site catalog format
which is documented here
<a href="http://vds.uchicago.edu/vds/doc/userguide/html/H_SiteCatalog.html">http://vds.uchicago.edu/vds/doc/userguide/html/H_SiteCatalog.html</a>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_transformation_catalog_tc_data">13. The Transformation Catalog - tc.data</h2>
<div class="sectionbody">
<div class="paragraph"><p>The transformation catalog lists where application executables are
located on remote sites.</p></div>
<div class="paragraph"><p>By default, the site catalog is stored in etc/tc.data. This path can
be overridden with the tc.file configuration property, either in the
Swift configuration file or on the command line.</p></div>
<div class="paragraph"><p>The format is one line per executable per site, with fields separated by
tabs. Spaces cannot be used to separate fields.</p></div>
<div class="paragraph"><p>Some example entries:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>localhost  echo    /bin/echo       INSTALLED       INTEL32<span style="color: #990000">::</span>LINUX  null
TGUC       touch   /usr/bin/touch  INSTALLED       INTEL32<span style="color: #990000">::</span>LINUX  GLOBUS<span style="color: #990000">::</span><span style="color: #009900">maxwalltime</span><span style="color: #990000">=</span><span style="color: #FF0000">"0:1"</span></tt></pre></div></div>
<div class="paragraph"><p>The fields are: site, transformation name, executable path, installation
status, platform, and profile entrys.</p></div>
<div class="paragraph"><p>The site field should correspond to a site name listed in the sites catalog.</p></div>
<div class="paragraph"><p>The transformation name should correspond to the transformation name
used in a SwiftScript app procedure.</p></div>
<div class="paragraph"><p>The executable path should specify where the particular executable is
located on that site.</p></div>
<div class="paragraph"><p>The installation status and platform fields are not used. Set them to
INSTALLED and INTEL32::LINUX respectively.</p></div>
<div class="paragraph"><p>The profiles field should be set to null if no profile entries are to
be specified, or should contain the profile entries separated by
semicolons.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_build_options">14. Build options</h2>
<div class="sectionbody">
<div class="paragraph"><p>See the Swift download page
<a href="http://www.ci.uchicago.edu/swift/downloads/">http://www.ci.uchicago.edu/swift/downloads/</a> for instructions on
downloading and building Swift from source. When building, various build
options can be supplied on the ant commandline. These are summarised here:</p></div>
<div class="paragraph"><p>with-provider-condor - build with CoG condor provider</p></div>
<div class="paragraph"><p>with-provider-coaster - build with CoG coaster provider (see the
section on coasters). Since 0.8, coasters are always built,
and this option has no effect.</p></div>
<div class="paragraph"><p>with-provider-deef - build with Falkon provider deef. In order for
this option to work, it is necessary to check out the provider-deef code
in the cog/modules directory alongside swift:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd cog/modules
$ svn co https<span style="color: #990000">:</span>//svn<span style="color: #990000">.</span>ci<span style="color: #990000">.</span>uchicago<span style="color: #990000">.</span>edu/svn/vdl<span style="color: #993399">2</span>/provider-deef
$ cd <span style="color: #990000">..</span>/swift
$ ant -Dwith-provider-deef<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span> redist</tt></pre></div></div>
<div class="paragraph"><p>with-provider-wonky - build with provider-wonky, an execution provider
that provides delays and unreliability for the purposes of testing
Swift&#8217;s fault tolerance mechanisms. In order for this option to work, it
is necessary to check out the provider-wonky code in the |cog/modules|
directory alongside swift:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd cog/modules
$ svn co https<span style="color: #990000">:</span>//svn<span style="color: #990000">.</span>ci<span style="color: #990000">.</span>uchicago<span style="color: #990000">.</span>edu/svn/vdl<span style="color: #993399">2</span>/provider-wonky
$ cd <span style="color: #990000">..</span>/swift<span style="color: #990000">|*</span>
$ ant -Dwith-provider-wonky<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span> redist</tt></pre></div></div>
<div class="paragraph"><p>no-supporting - produces a distribution without supporting commands
such as grid-proxy-init. This is intended for when the Swift
distribution will be used in an environment where those commands are
already provided by other packages, where the Swift package should be
providing only Swift commands, and where the presence of commands such
as grid-proxy-init from the Swift distribution in the path will mask the
presence of those commands from their true distribution package such as
a Globus Toolkit package.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ ant -Dno-supporting<span style="color: #990000">=</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span> redist</tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_kickstart">15. Kickstart</h2>
<div class="sectionbody">
<div class="paragraph"><p>Kickstart is a tool that can be used to gather various information about
the remote execution environment for each job that Swift tries to run.</p></div>
<div class="paragraph"><p>For each job, Kickstart generates an XML invocation record. By default
this record is staged back to the submit host if the job fails.</p></div>
<div class="paragraph"><p>Before it can be used it must be installed on the remote site and the
sites file must be configured to point to kickstart.</p></div>
<div class="paragraph"><p>Kickstart can be downloaded as part of the Pegasus <em>worker package</em>
available from the worker packages section of the Pegasus download page
<a href="http://pegasus.isi.edu/code.php">http://pegasus.isi.edu/code.php</a>.</p></div>
<div class="paragraph"><p>Untar the relevant worker package somewhere where it is visible to all
of the worker nodes on the remote execution machine (such as in a shared
application filesystem).</p></div>
<div class="paragraph"><p>Now configure the gridlaunch attribute of the sites catalog to point to
that path, by adding a gridlaunch attribute to the pool element in
the site catalog:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;pool</span></span> <span style="color: #009900">handle</span><span style="color: #990000">=</span><span style="color: #FF0000">"example"</span> <span style="color: #009900">gridlaunch</span><span style="color: #990000">=</span><span style="color: #FF0000">"/usr/local/bin/kickstart"</span> <span style="color: #009900">sysinfo</span><span style="color: #990000">=</span><span style="color: #FF0000">"INTEL32::LINUX"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
...
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pool&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>There are various kickstat.* properties, which have sensible default
values. These are documented in the properties section.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_reliability_mechanisms">16. Reliability mechanisms</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section details reliabilty mechanisms in Swift: retries, restarts
and replication.</p></div>
<div class="sect2">
<h3 id="_retries">16.1. Retries</h3>
<div class="paragraph"><p>If an application procedure execution fails, Swift will attempt that
execution again repeatedly until it succeeds, up until the limit defined
in the execution.retries configuration property.</p></div>
<div class="paragraph"><p>Site selection will occur for retried jobs in the same way that it
happens for new jobs. Retried jobs may run on the same site or may run
on a different site.</p></div>
<div class="paragraph"><p>If the retry limit execution.retries is reached for an application
procedure, then that application procedure will fail. This will cause
the entire run to fail - either immediately (if the lazy.errors
property is false) or after all other possible work has been attempted
(if the lazy.errors property is true).</p></div>
</div>
<div class="sect2">
<h3 id="_restarts">16.2. Restarts</h3>
<div class="paragraph"><p>If a run fails, Swift can resume the program from the point of failure.
When a run fails, a restart log file will be left behind in a file named
using the unique job ID and a .rlog extension. This restart log can
then be passed to a subsequent Swift invocation using the -resume
parameter. Swift will resume execution, avoiding execution of
invocations that have previously completed successfully. The SwiftScript
source file and input data files should not be modified between runs.</p></div>
<div class="paragraph"><p>Every run creates a restart log file with a named composed of the file
name of the workflow being executed, an invocation ID, a numeric ID, and
the .rlog extension. For example, example.swift, when executed,
could produce the following restart log file:
example-ht0adgi315l61.0.rlog. Normally, if the run completes
successfully, the restart log file is deleted. If however the workflow
fails, swift can use the restart log file to continue execution from a
point before the failure occurred. In order to restart from a restart
log file, the -resume logfile argument can be used after the
SwiftScript program file name. Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ swift -resume example-ht0adgi315l61<span style="color: #990000">.</span><span style="color: #993399">0</span><span style="color: #990000">.</span>rlog example<span style="color: #990000">.</span>swift<span style="color: #990000">.</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_replication">16.3. Replication</h3>
<div class="paragraph"><p>When an execution job has been waiting in a site queue for a certain
period of time, Swift can resubmit replicas of that job (up to the limit
defined in the replication.limit configuration property). When any of
those jobs moves from queued to active state, all of the other replicas
will be cancelled.</p></div>
<div class="paragraph"><p>This is intended to deal with situations where some sites have a
substantially longer (sometimes effectively infinite) queue time than
other sites. Selecting those slower sites can cause a very large delay
in overall run time.</p></div>
<div class="paragraph"><p>Replication can be enabled by setting the replication.enabled
configuration property to true. The maximum number of replicas that
will be submitted for a job is controlled by the replication.limit
configuration property.</p></div>
<div class="paragraph"><p>When replication is enabled, Swift will also enforce the maxwalltime
profile setting for jobs as documented in the profiles section.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_clustering">17. Clustering</h2>
<div class="sectionbody">
<div class="paragraph"><p>Swift can group a number of short job submissions into a single larger
job submission to minimize overhead involved in launching jobs (for
example, caused by security negotiation and queuing delay). In general,
CoG coasters should be used in preference to the clustering
mechanism documented in this section.</p></div>
<div class="paragraph"><p>By default, clustering is disabled. It can be activated by setting the
clustering.enabled property to true.</p></div>
<div class="paragraph"><p>A job is eligible for clustering if the GLOBUS::maxwalltime profile
is specified in the tc.data entry for that job, and its value is
less than the value of the clustering.min.time property.</p></div>
<div class="paragraph"><p>Two or more jobs are considered compatible if they share the same site
and do not have conflicting profiles (e.g. different values for the same
environment variable).</p></div>
<div class="paragraph"><p>When a submitted job is eligible for clustering, it will be put in a
clustering queue rather than being submitted to a remote site. The
clustering queue is processed at intervals specified by the
clustering.queue.delay property. The
processing of the clustering queue consists of selecting compatible jobs
and grouping them into clusters whose maximum wall time does not exceed
twice the value of the clustering.min.time property.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_coasters">18. Coasters</h2>
<div class="sectionbody">
<div class="paragraph"><p>Coasters were introduced in Swift v0.6 as an experimental feature.</p></div>
<div class="paragraph"><p>In many applications, Swift performance can be greatly enhanced by the
use of CoG coasters. CoG coasters provide a low-overhead job submission
and file transfer mechanism suited for the execution of short jobs (on
the order of a few seconds) and the transfer of small files (on the
order of a few kilobytes) for which other grid protocols such as GRAM
and GridFTP are poorly suited.</p></div>
<div class="paragraph"><p>The coaster mechanism submits a head job using some other execution
mechanism such as GRAM, and for each worker node that will be used in a
remote cluster, it submits a worker job, again using some other
execution mechanism such as GRAM. Details on the design of the coaster
mechanism can be found here. <a href="http://wiki.cogkit.org/wiki/Coasters">http://wiki.cogkit.org/wiki/Coasters</a></p></div>
<div class="paragraph"><p>The head job manages file transfers and the dispatch of execution jobs
to workers. Much of the overhead associated with other grid protocols
(such as authentication and authorization, and allocation of worker
nodes by the site&#8217;s local resource manager) is reduced, because that
overhead is associated with the allocation of a coaster head or coaster
worker, rather than with every Swift-level procedure invocation;
potentially hundreds or thousands of Swift-level procedure invocations
can be run through a single worker.</p></div>
<div class="paragraph"><p>Coasters can be configured for use in two situations: job execution and
file transfer.</p></div>
<div class="paragraph"><p>To use for job execution, specify a sites.xml execution element like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;execution</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"coaster"</span> <span style="color: #009900">jobmanager</span><span style="color: #990000">=</span><span style="color: #FF0000">"gt2:gt2:pbs"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"grid.myhost.org"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The jobmanager string contains more detail than with other providers. It
contains either two or three colon separated fields: 1:the provider to
be use to execute the coaster head job - this provider will submit from
the Swift client side environment. Commonly this will be one of the GRAM
providers; 2: the provider to be used to execute coaster worker jobs.
This provider will be used to submit from the coaster head job
environment, so a local scheduler provider can sometimes be used instead
of GRAM. 3: optionally, the jobmanager to be used when submitting worker
job using the provider specified in field 2.</p></div>
<div class="paragraph"><p>To use for file transfer, specify a sites.xml filesystem element like this:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;filesystem</span></span> <span style="color: #009900">provider</span><span style="color: #990000">=</span><span style="color: #FF0000">"coaster"</span> <span style="color: #009900">url</span><span style="color: #990000">=</span><span style="color: #FF0000">"gt2://grid.myhost.org"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The url parameter should be a pseudo-URI formed with the URI scheme
being the name of the provider to use to submit the coaster head job,
and the hostname portion being the hostname to be used to execute the
coaster head job. Note that this provider and hostname will be used for
execution of a coaster head job, not for file transfer; so for example,
a GRAM endpoint should be specified here rather than a GridFTP endpoint.</p></div>
<div class="paragraph"><p>Coasters are affected by the following profile settings, which are
documented in the Globus namespace profile section:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">Profile key</th>
<th align="left" valign="top">Brief description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">slots</p></td>
<td align="left" valign="top"><p class="table">How many maximum LRM jobs/worker blocks are allowed</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">workersPerNode</p></td>
<td align="left" valign="top"><p class="table">How many coaster workers to run per execution node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">nodeGranularity</p></td>
<td align="left" valign="top"><p class="table">Each worker block uses a number of nodes that is a
multiple of this number</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">lowOverallocation</p></td>
<td align="left" valign="top"><p class="table">How many times larger than the job walltime should a
block&#8217;s walltime be if all jobs are 1s long</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">highOverallocation</p></td>
<td align="left" valign="top"><p class="table">How many times larger than the job walltime should a
block&#8217;s walltime be if all jobs are infinitely long</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">overallocationDecayFactor</p></td>
<td align="left" valign="top"><p class="table">How quickly should the overallocation curve
tend towards the highOverallocation as job walltimes get larger</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">spread</p></td>
<td align="left" valign="top"><p class="table">By how much should worker blocks vary in worker size</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">workersPerNode</p></td>
<td align="left" valign="top"><p class="table">How many coaster workers to run per execution node</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">reserve</p></td>
<td align="left" valign="top"><p class="table">How many seconds to reserve in a block&#8217;s walltime for
starting/shutdown operations</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">maxnodes</p></td>
<td align="left" valign="top"><p class="table">The maximum number of nodes allowed in a block</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">maxtime</p></td>
<td align="left" valign="top"><p class="table">The maximum number of walltime allowed for a block</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">remoteMonitorEnabled</p></td>
<td align="left" valign="top"><p class="table">If true, show a graphical display of the status of
the coaster service</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_tips_for_specific_user_communities">19. How-To Tips for Specific User Communities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_saving_logs_for_uchicago_ci_users">19.1. Saving Logs - for UChicago CI Users</h3>
<div class="paragraph"><p>If you have a UChicago Computation Institute account, run this command
in your submit directory after each run. It will copy all your logs and
kickstart records into a directory at the CI for reporting, usage
tracking, support and debugging.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rsync --ignore-existing <span style="color: #990000">*.</span>log <span style="color: #990000">*.</span>d login<span style="color: #990000">.</span>ci<span style="color: #990000">.</span>uchicago<span style="color: #990000">.</span>edu<span style="color: #990000">:</span>/disks/ci-gpfs/swift/swift-logs<span style="color: #990000">/</span> --verbose</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_specifying_teragrid_allocations">19.2. Specifying TeraGrid allocations</h3>
<div class="paragraph"><p>TeraGrid users with no default project or with several project
allocations can specify a project allocation using a profile key in the
site catalog entry for a TeraGrid site:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;profile</span></span> <span style="color: #009900">namespace</span><span style="color: #990000">=</span><span style="color: #FF0000">"globus"</span> <span style="color: #009900">key</span><span style="color: #990000">=</span><span style="color: #FF0000">"project"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>TG-CCR080002N<span style="font-weight: bold"><span style="color: #0000FF">&lt;/profile&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>More information on the TeraGrid allocations process can be found here
<a href="http://www.teragrid.org/userinfo/access/allocations.php">http://www.teragrid.org/userinfo/access/allocations.php</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_launching_mpi_jobs_from_swift">19.3. Launching MPI jobs from Swift</h3>
<div class="paragraph"><p>Here is an example of running a simple MPI program.</p></div>
<div class="paragraph"><p>In SwiftScript, we make an invocation that does not look any different
from any other invocation. In the below code, we do not have any input
files, and have two output files on stdout and stderr:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">type</span> file<span style="color: #990000">;</span>

<span style="color: #990000">(</span><span style="color: #008080">file</span> o<span style="color: #990000">,</span> <span style="color: #008080">file</span> e<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    app <span style="color: #FF0000">{</span>
        <span style="color: #008080">mpi</span> stdout<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>o<span style="color: #990000">)</span> stderr<span style="color: #990000">=</span>@<span style="font-weight: bold"><span style="color: #000000">filename</span></span><span style="color: #990000">(</span>e<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">file</span> mpiout <span style="color: #990000">&lt;</span><span style="color: #FF0000">"mpi.out"</span><span style="color: #990000">&gt;;</span>
<span style="color: #008080">file</span> mpierr <span style="color: #990000">&lt;</span><span style="color: #FF0000">"mpi.err"</span><span style="color: #990000">&gt;;</span>

<span style="color: #990000">(</span>mpiout<span style="color: #990000">,</span> mpierr<span style="color: #990000">)</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">p</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><p>Now we define how <em>mpi</em> will run in tc.data:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>tguc    mpi             /home/benc/mpi/mpi<span style="color: #990000">.</span>sh   INSTALLED       INTEL32<span style="color: #990000">::</span>LINUX GLOBUS<span style="color: #990000">::</span><span style="color: #009900">host_xcount</span><span style="color: #990000">=</span><span style="color: #993399">3</span></tt></pre></div></div>
<div class="paragraph"><p>mpi.sh is a wrapper script that launches the MPI program. It must be
installed on the remote site:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#!/bin/bash</span></span>
mpirun -np <span style="color: #993399">3</span> -machinefile <span style="color: #009900">$PBS_NODEFILE</span> /home/benc/mpi/a<span style="color: #990000">.</span>out</tt></pre></div></div>
<div class="paragraph"><p>Because of the way that Swift runs its server side code,
provider-specific MPI modes (such as GRAM jobType=mpi) should not be
used. Instead, the mpirun command should be explicitly invoked.</p></div>
</div>
<div class="sect2">
<h3 id="_running_on_windows">19.4. Running on Windows</h3>
<div class="paragraph"><p>Since 10/11/09, the development version of Swift has the ability to run
on a Windows machine, as well as the ability to submit jobs to a Windows
site (provided that an appropriate provider is used).</p></div>
<div class="paragraph"><p>In order to launch Swift on Windows, use the provided batch file
(swift.bat). In certain cases, when a large number of jar libraries are
present in the Swift lib directory and depending on the exact location
of the Swift installation, the classpath environment variable that the
Swift batch launcher tries to create may be larger than what Windows can
handle. In such a case, either install Swift in a directory closer to
the root of the disk (say, c:\swift) or remove non-essential jar files
from the Swift lib directory.</p></div>
<div class="paragraph"><p>Due to the large differences between Windows and Unix environments,
Swift must use environment specific tools to achieve some of its goals.
In particular, each Swift executable is launched using a wrapper script.
This script is a Bourne Shell script. On Windows machines, which have no
Bourne Shell interpreter installed by default, the Windows Scripting
Host is used instead, and the wrapper script is written in VBScript.
Similarly, when cleaning up after a run, the "/bin/rm" command available
in typical Unix environments must be replaced by the "del" shell command.</p></div>
<div class="paragraph"><p>It is important to note that in order to select the proper set of tools
to use, Swift must know when a site runs under Windows. To inform Swift
of this, specify the "sysinfo" attribute for the "pool" element in the
site catalog. For example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;pool</span></span> <span style="color: #009900">handle</span><span style="color: #990000">=</span><span style="color: #FF0000">"localhost"</span> <span style="color: #009900">sysinfo</span><span style="color: #990000">=</span><span style="color: #FF0000">"INTEL32::WINDOWS"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
...
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/pool&gt;</span></span></tt></pre></div></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-05-16 14:11:15 CDT
</div>
</div>
</body>
</html>
