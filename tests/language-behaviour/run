#!/bin/bash

echo Removing files from previous runs
rm -fv *.out *.xml *.kml *.dot *.log *.rlog

TESTS=*.swift

for testfn in $TESTS; do

  export t=$(basename $testfn .swift)
  export EXPECTEDS="$t.*.expected"

  echo Running test $t
  swift ${t}.swift

  echo expecting $EXPECTEDS

  for e in $EXPECTEDS; do

    if [ -f $e ]; then

      echo checking $e
      out=$(basename $e .expected)

      if [ "$?" -ne "0" ]; then echo "TEST FAILED"; exit; fi
      diff -q ${out} ${e}
      if [ "$?" -ne "0" ]; then echo "OUTPUT DIFFERS"; exit; fi

    else
      echo "$e does not exist"
    fi

  done

done

echo All language behaviour tests passed



