#!/bin/bash

# run this with vdlc on the path, with pwd set to the directory
# in which you found this script, so that it can find the working/ etc
# subdirectories.

pushd working
rm -v *.?ml
for a in *.dtm; do 
  echo Attempting vdlc known-good $a
  vdlc $a
  if [ "$?" -ne "0" ]; then echo "TEST FAILED"; exit; fi
  b=$(basename -s .swift $(basename -s .dtm $a)).xml
  diff -q $b ../working-base/$b
  if [ "$?" -ne "0" ]; then echo "OUTPUT DIFFERS"; exit; fi

done
popd

pushd not-working
rm -v *.?ml
for a in *.dtm *.swift; do

  echo Attempting vdlc known-bad $a
  vdlc $a
  if [ "$?" -eq "0" ]; then echo "TEST FAILED"; exit; fi

done
echo Finished all syntax tests
