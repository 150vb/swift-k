<project>
  <import file="sys.xml"/>
  <import file="scheduler.xml"/>
  <import file="rlog.xml"/>
  <import file="vdl.k"/>
  <element name="echo_batch" arguments="fa,sa">
    <vdl:typecheck argname="fa" var="{fa}" type="file" isArray="true"/>
    <vdl:typecheck argname="sa" var="{sa}" type="string" isArray="true"/>
    <set name="s">
      <vdl:new type="string" dbgname="s">
        <vdl:mapping descriptor="concurrent_mapper">
          <vdl:parameter name="prefix" value="s-badc7452-c636-4cfd-bc67-0956cd209187"/>
        </vdl:mapping>
      </vdl:new>
    </set>
    <parallel>
      <parallelFor name="$">
        <vdl:getarrayfieldvalue path="" var="{sa}"/>
          <set names="i, s">
            <each items="{$}"/>
          </set>

          <parallel>
            <echo>
              <parallel>
                <vdl:getfield var="{fa}">
                  <argument name="path">
                    <concat>
                      <string>[i]</string>
                    </concat>
                  </argument>
                </vdl:getfield>  
                <variable>s</variable>
              </parallel>
            </echo>
          </parallel>
      </parallelFor>
    </parallel>
    <vdl:closedataset var="{fa}"/>
  </element>

</project>
