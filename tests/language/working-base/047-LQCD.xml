<program xmlns="http://ci.uchicago.edu/swift/2007/07/swiftscript"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <types>
    <xs:schema targetNamespace="http://ci.uchicago.edu/swift/2007/07/swiftscript">
     <xs:simpleType name="file">
       <xs:restriction base="xs:string"/>
     </xs:simpleType>
    </xs:schema>
  </types>
  <procedure name="stageIn">

      <output 
    name="gauge" type="file"

     xsi:nil="true" />

      <input 
    name="input" type="file"

     xsi:nil="true" />

      <input 
    name="config" type="string"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>stageIn</executable>
        <stringConstant>-v</stringConstant><stringConstant>-i</stringConstant><function name="filename">
          <variableReference>input</variableReference></function><stringConstant>-c</stringConstant><variableReference>config</variableReference><stringConstant>-o</stringConstant><function name="filename">
          <variableReference>gauge</variableReference></function>  </application>
    </binding>
  </procedure>
  <procedure name="stagSolve">

      <output 
    name="output" type="file" isArray="true"

     xsi:nil="true" />

      <input 
    name="gauge" type="file"

     xsi:nil="true" />

      <input 
    name="mass" type="string"

     xsi:nil="true" />

      <input 
    name="source" type="string"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>stagSolve</executable>
        <stringConstant>-v</stringConstant><stringConstant>-g</stringConstant><function name="filename">
          <variableReference>gauge</variableReference></function><stringConstant>-m</stringConstant><variableReference>mass</variableReference><stringConstant>-s</stringConstant><variableReference>source</variableReference><stringConstant>-o</stringConstant><function name="filename">
          <arraySubscript>
           <variableReference>output</variableReference>
           <stringConstant>*</stringConstant>
          </arraySubscript></function>  </application>
    </binding>
  </procedure>
  <procedure name="cloverSolve">

      <output 
    name="output" type="file"

     xsi:nil="true" />

      <input 
    name="kappa" type="float"

     xsi:nil="true" />

      <input 
    name="cSW" type="float"

     xsi:nil="true" />

      <input 
    name="gauge" type="file"

     xsi:nil="true" />

      <input 
    name="source" type="string"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>cloverSolve</executable>
        <stringConstant>-v</stringConstant><stringConstant>-k</stringConstant><variableReference>kappa</variableReference><stringConstant>-c</stringConstant><variableReference>cSW</variableReference><stringConstant>-g</stringConstant><function name="filename">
          <variableReference>gauge</variableReference></function><stringConstant>-s</stringConstant><variableReference>source</variableReference><stringConstant>-o</stringConstant><function name="filename">
          <variableReference>output</variableReference></function>  </application>
    </binding>
  </procedure>
  <procedure name="cvt12x12">

      <output 
    name="output" type="file"

     xsi:nil="true" />

      <input 
    name="input" type="file"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>CVT12x12</executable>
        <stringConstant>-v</stringConstant><stringConstant>-i</stringConstant><function name="filename">
          <variableReference>input</variableReference></function><stringConstant>-o</stringConstant><function name="filename">
          <variableReference>output</variableReference></function>  </application>
    </binding>
  </procedure>
  <procedure name="archive">

      <output 
    name="output" type="file"

     xsi:nil="true" />

      <input 
    name="input" type="file"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>Archive</executable>
        <stringConstant>-v</stringConstant><stringConstant>-i</stringConstant><function name="filename">
          <variableReference>input</variableReference></function><stringConstant>-o</stringConstant><function name="filename">
          <variableReference>output</variableReference></function>  </application>
    </binding>
  </procedure>
  <procedure name="archiveStag">

      <output 
    name="output" type="file"

     xsi:nil="true" />

      <input 
    name="mass" type="string"

     xsi:nil="true" />

      <input 
    name="input" type="file" isArray="true"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>ArchiveStag</executable>
        <stringConstant>-v</stringConstant><stringConstant>-m</stringConstant><variableReference>mass</variableReference><stringConstant>-i</stringConstant><function name="filename">
          <arraySubscript>
           <variableReference>input</variableReference>
           <stringConstant>*</stringConstant>
          </arraySubscript></function><stringConstant>-o</stringConstant><function name="filename">
          <variableReference>output</variableReference></function>  </application>
    </binding>
  </procedure>
  <procedure name="twoPtHH">

      <output 
    name="sdo" type="file"

     xsi:nil="true" />

      <input 
    name="gauge" type="file"

     xsi:nil="true" />

      <input 
    name="antiQ" type="file"

     xsi:nil="true" />

      <input 
    name="Q0" type="file"

     xsi:nil="true" />

      <input 
    name="Q1" type="file"

     xsi:nil="true" />

      <input 
    name="Q2" type="file"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>TwoPtHH</executable>
        <stdout><function name="filename">
          <variableReference>sdo</variableReference></function></stdout><stringConstant>-v</stringConstant><stringConstant>-g</stringConstant><function name="filename">
          <variableReference>gauge</variableReference></function><stringConstant>-a</stringConstant><variableReference>antiQ</variableReference><stringConstant>-0</stringConstant><variableReference>Q0</variableReference><stringConstant>-1</stringConstant><variableReference>Q1</variableReference><stringConstant>-2</stringConstant><variableReference>Q2</variableReference>  </application>
    </binding>
  </procedure>
  <procedure name="twoPtSH">

      <output 
    name="sdo" type="file"

     xsi:nil="true" />

      <input 
    name="gauge" type="file"

     xsi:nil="true" />

      <input 
    name="stag" type="file"

     xsi:nil="true" />

      <input 
    name="antiQ" type="file"

     xsi:nil="true" />

      <input 
    name="Q0" type="file"

     xsi:nil="true" />

      <input 
    name="Q1" type="file"

     xsi:nil="true" />

      <input 
    name="Q2" type="file"

     xsi:nil="true" />
    <binding>
      <application>
        <executable>TwoPtSH</executable>
        <stdout><function name="filename">
          <variableReference>sdo</variableReference></function></stdout><stringConstant>-v</stringConstant><stringConstant>-g</stringConstant><function name="filename">
          <variableReference>gauge</variableReference></function><stringConstant>-s</stringConstant><variableReference>stag</variableReference><stringConstant>-a</stringConstant><variableReference>antiQ</variableReference><stringConstant>-0</stringConstant><variableReference>Q0</variableReference><stringConstant>-1</stringConstant><variableReference>Q1</variableReference><stringConstant>-2</stringConstant><variableReference>Q2</variableReference>  </application>
    </binding>
  </procedure>
  <variable name="confList" type="string" isArray="true">
    <array>
      <stringConstant>000102</stringConstant><stringConstant>000108</stringConstant><stringConstant>000114</stringConstant>
    </array>
  </variable>
  <variable name="kappaQ" type="float"><floatConstant>0.127</floatConstant></variable>
  <variable name="cSW" type="float"><floatConstant>1.75</floatConstant></variable>
  <variable name="mass" type="string"><stringConstant>0.005,0.007,0.01,0.02,0.03</stringConstant></variable>
  <variable name="fn" type="string" isArray="true">
    <array>
      <stringConstant>m0.005_000102 m0.007_000102 m0.01_000102 m0.02_000102 m0.03_000102</stringConstant><stringConstant>m0.005_000108 m0.007_000108 m0.01_000108 m0.02_000108 m0.03_000108</stringConstant><stringConstant>m0.005_000114 m0.007_000114 m0.01_000114 m0.02_000114 m0.03_000114</stringConstant>
    </array>
  </variable>
  <foreach var="config"  indexVar="i">
  <in><variableReference>conflist</variableReference></in>
  <body><variable name="source" type="string"><stringConstant>local,0,0,0,0</stringConstant></variable>
    <dataset name="template" type="file">
      <file name="foo"/>
    </dataset>
    <variable name="gauge" type="file" xsi:nil="true"/>
    <call proc="stageIn">
      <output><variableReference>gauge</variableReference></output>
      <input><variableReference>template</variableReference></input>
      <input><variableReference>config</variableReference></input>
    </call>
    <dataset name="stags" type="file" isArray="true">
      <mapping descriptor="fixed_array_mapper">
        <param name="files"><arraySubscript>
         <variableReference>fn</variableReference>
         <variableReference>i</variableReference>
        </arraySubscript></param>
      </mapping>
    </dataset>
    <call proc="stagSolve">
      <output><variableReference>stags</variableReference></output>
      <input><variableReference>gauge</variableReference></input>
      <input><variableReference>mass</variableReference></input>
      <input><variableReference>source</variableReference></input>
    </call>
    <dataset name="stagTar" type="file">
      <mapping descriptor="simple_mapper">
        <param name="suffix"><stringConstant>.tar</stringConstant></param>
      </mapping>
    </dataset>
    <call proc="archiveStag">
      <output><variableReference>stagTar</variableReference></output>
      <input><variableReference>mass</variableReference></input>
      <input><variableReference>stags</variableReference></input>
    </call>
    <variable name="clover0" type="file" xsi:nil="true"/>
    <call proc="cloverSolve">
      <output><variableReference>clover0</variableReference></output>
      <input><variableReference>kappaQ</variableReference></input>
      <input><variableReference>cSW</variableReference></input>
      <input><variableReference>gauge</variableReference></input>
      <input><variableReference>source</variableReference></input>
    </call>
    <variable name="q0" type="file" xsi:nil="true"/>
    <call proc="cvt12x12">
      <output><variableReference>q0</variableReference></output>
      <input><variableReference>clover0</variableReference></input>
    </call>
    <variable name="cvtArch0" type="file" xsi:nil="true"/>
    <call proc="archive">
      <output><variableReference>cvtArch0</variableReference></output>
      <input><variableReference>q0</variableReference></input>
    </call>
    <variable name="source1" type="string"><stringConstant>wavefunction,0,1S</stringConstant></variable>
    <variable name="clover1" type="file" xsi:nil="true"/>
    <call proc="cloverSolve">
      <output><variableReference>clover1</variableReference></output>
      <input><variableReference>kappaQ</variableReference></input>
      <input><variableReference>cSW</variableReference></input>
      <input><variableReference>gauge</variableReference></input>
      <input><variableReference>source1</variableReference></input>
    </call>
    <variable name="q1" type="file" xsi:nil="true"/>
    <call proc="cvt12x12">
      <output><variableReference>q1</variableReference></output>
      <input><variableReference>clover1</variableReference></input>
    </call>
    <variable name="cvtArch1" type="file" xsi:nil="true"/>
    <call proc="archive">
      <output><variableReference>cvtArch1</variableReference></output>
      <input><variableReference>q1</variableReference></input>
    </call>
    <variable name="source2" type="string"><stringConstant>wavefunction,0,2S</stringConstant></variable>
    <variable name="clover2" type="file" xsi:nil="true"/>
    <call proc="cloverSolve">
      <output><variableReference>clover2</variableReference></output>
      <input><variableReference>kappaQ</variableReference></input>
      <input><variableReference>cSW</variableReference></input>
      <input><variableReference>gauge</variableReference></input>
      <input><variableReference>source2</variableReference></input>
    </call>
    <variable name="q2" type="file" xsi:nil="true"/>
    <call proc="cvt12x12">
      <output><variableReference>q2</variableReference></output>
      <input><variableReference>clover2</variableReference></input>
    </call>
    <variable name="cvtArch2" type="file" xsi:nil="true"/>
    <call proc="archive">
      <output><variableReference>cvtArch2</variableReference></output>
      <input><variableReference>q2</variableReference></input>
    </call>
    <variable name="antiQ" type="file"><variableReference>q0</variableReference></variable>
    <variable name="pStdout" type="file" xsi:nil="true"/>
    <call proc="twoPtHH">
      <output><variableReference>pStdout</variableReference></output>
      <input><variableReference>gauge</variableReference></input>
      <input><variableReference>antiQ</variableReference></input>
      <input><variableReference>q0</variableReference></input>
      <input><variableReference>q1</variableReference></input>
      <input><variableReference>q2</variableReference></input>
    </call>
    <foreach var="stag" >
    <in><variableReference>stags</variableReference></in>
    <body><variable name="sStdout" type="file" xsi:nil="true"/>
      <call proc="twoPtSH">
        <output><variableReference>sStdout</variableReference></output>
        <input><variableReference>gauge</variableReference></input>
        <input><variableReference>stag</variableReference></input>
        <input><variableReference>antiQ</variableReference></input>
        <input><variableReference>q0</variableReference></input>
        <input><variableReference>q1</variableReference></input>
        <input><variableReference>q2</variableReference></input>
      </call></body>
    </foreach></body>
  </foreach>
</program>
